import{u as e,s as a,n as l,o as n,r as t,e as d,A as i,B as o,C as r,w as s,a as u,v as c,f as m,D as p,F as f,G as _,H as v,m as g,y as h,I as b,J as y,b as w,l as k,K as x,L as V}from"./vendor-element-plus-BAdGi-BR.js";import{_ as C,a as U}from"./fansMedal-53R_GX_t.js";import{q as B,T as S,aa as T,r as j,Y as D,t as O,v as q,S as I,I as L,J as z,L as R,u as K,bS as F,Q as H,h as A,ay as G,R as M,O as Q,P as E,aB as J,K as W,z as N,bT as P,bU as Y,bQ as $}from"./vendor-libs-B7kAgHVc.js";import{a as X,t as Z,c as ee}from"./index-d4Ui0gHI.js";import"./vendor-exceljs-C-8i3j8b.js";import{r as ae}from"./request-bkxqFAZj.js";import{u as le}from"./interval-CRta3I7C.js";import{u as ne}from"./theme-CFV9rJX7.js";import{u as te}from"./danmaku-CZvCi_hp.js";import"./vendor-vue-l4c-_Jld.js";const de=B({name:"lineHeader",props:{title:{type:String,required:!0}},setup:e=>()=>S("div",{class:"line-header"},[S("div",{class:"line-header-title"},[e.title])])}),ie={class:"obs-container"},oe={class:"obs-splitter",style:{"margin-top":"1rem"}},re={class:"css-editor"},se={class:"css-editor-preview"},ue={class:"danmaku-container"},ce={class:"danmaku-list"},me={class:"danmaku-list-item"},pe={class:"danmaku-sing"},fe={class:"danmaku-uname"},_e={class:"danmaku-fans"},ve=B({__name:"obsSetting",setup(c){const m=T({url:`${window.location.origin}/danmaku`}),p=j("/* 弹幕列表CSS */\n.danmaku-container {\n    height: 600px;\n    width: 800px;\n    background: transparent;\n    overflow: hidden;\n}\n.danmaku-list {\n  padding: 0;\n  margin-left: 1%;\n  list-style: none;\n  overflow-y: auto;\n}\n.danmaku-list-item {\n    width: 450px;\n    display: flex;\n    align-items: center;\n    height: 50px;\n    text-align: left;\n    color: #000;\n    font-size: 16px;\n    font-weight: bold;\n    overflow: hidden;\n}\n.danmaku-source-img {\n    margin: 1px;\n    height: 24px;\n}\n.danmaku-sing {\n    width: 200px;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    overflow: hidden;\n}\n\n.danmaku-uname {\n  width: 180px;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  margin-left: 1rem;\n}\n\n.fans-club-img {\n  margin-left: 10px;\n}\n\n.fans-club-member-img {\n  margin-left: 10px;\n}\n\n.fans-medal-container {\n  margin-left: 10px;\n}\n\n.danmaku-fans {\n  width: 200px;\n  margin: 0 auto;\n}\n\n.fans-club-container {\n  width: 200px;\n  display: flex;\n  align-items: center;\n}\n\n.fans-club-name-container {\n  display: flex;\n  align-items: center;\n  font-size: 10px;\n  border-radius: 15px;\n  width: 30%;\n}\n\n.fans-club-name-bg {\n  display: block;\n  height: 20px;\n  width: 50%;\n}\n\n.fans-club-name {\n  color: #fff;\n  font-weight: 500;\n  width: 100%;\n  margin-left: -12%;\n}\n/* 弹幕列表CSS END */"),f=j(Array()),_=()=>{X(m.url),u.success("拷贝成功")};return D(()=>{(()=>{for(let e=0;e<10;e++){const a=e%2==0?"bilibili":"douyin",l="bilibili"==a?0:e%3==0?1:2;f.value.push({uid:e,msg:"点歌弹幕",uname:"username",medal_level:e,medal_name:"粉丝团",guard_level:l,source:a,send_time:Date.now()})}})()}),(u,c)=>{const v=d,g=t,h=n,b=l,y=a,w=i,k=de,x=r,V=s,B=C,T=U,j=o,D=e;return q(),O(I,null,[S(D,null,{header:z(()=>[...c[2]||(c[2]=[R("span",null,"OBS设置",-1)])]),default:z(()=>[R("div",ie,[S(y,{model:K(m),"label-width":"auto"},{default:z(()=>[S(b,{label:"OBS地址",prop:"url"},{default:z(()=>[S(h,{modelValue:K(m).url,"onUpdate:modelValue":c[0]||(c[0]=e=>K(m).url=e),type:"text",disabled:""},{append:z(()=>[S(g,{type:"primary",onClick:_},{default:z(()=>[S(v,null,{default:z(()=>[S(K(F))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),S(b,null,{default:z(()=>[S(g,{type:"primary",onClick:_},{default:z(()=>[...c[3]||(c[3]=[H(" 复制地址 ",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),S(w,{title:"在OBS新建一个浏览器源，在地址栏输入上面复制的地址，即可实现与观众同步点歌板信息，如需使用自定义css样式，请到下方编辑，然后复制到OBS浏览器源中",closable:!1,type:"primary"}),R("div",oe,[S(j,null,{default:z(()=>[S(x,{resizable:!1},{default:z(()=>[R("div",re,[S(k,{title:"样式编辑器"}),S(h,{modelValue:K(p),"onUpdate:modelValue":c[1]||(c[1]=e=>A(p)?p.value=e:null),rows:20,type:"textarea",placeholder:"css样式在这里编辑"},null,8,["modelValue"])])]),_:1}),S(x,{resizable:!1},{default:z(()=>[R("div",se,[S(k,{title:"样式预览"}),R("div",ue,[R("div",ce,[(q(!0),O(I,null,G(K(f),e=>(q(),O("div",me,[R("div",pe,[null!=e.html&&e.html.length>0?(q(),L(V,{key:0,innerHTML:e.html,style:{display:"flex"}},null,8,["innerHTML"])):(q(),O(I,{key:1},[H(M(e.msg),1)],64))]),R("div",fe,M(e.uname),1),R("div",_e,[e.medal_level>0?(q(),O(I,{key:0},["bilibili"==e.source?(q(),L(B,{key:0,medal_name:e.medal_name,medal_level:e.medal_level,guard_level:e.guard_level},null,8,["medal_name","medal_level","guard_level"])):Q("",!0),"douyin"==e.source?(q(),L(T,{key:1,medal_name:e.medal_name,medal_level:e.medal_level,guard_level:e.guard_level},null,8,["medal_name","medal_level","guard_level"])):Q("",!0)],64)):Q("",!0)])]))),256))])])])]),_:1})]),_:1})])])]),_:1}),(q(),L(E("style"),null,{default:z(()=>[H(M(K(p)),1)]),_:1}))],64)}}}),ge=B({__name:"appSettingTab",setup(n,{expose:d}){const i=j(),o=j(!1),r=j(!1),s=le(),f=ne(),_=T({id:0,dark_mode:!1,check_update:!1,startup:!1,notification:!1,navSideTour:!1,collapse:!1});return J(()=>{const e=f.getDarkTheme();_.dark_mode=e}),d({initConfig:()=>{r.value=!0,ae.getGlobalConfig({}).then(e=>{const a=e.data;if(0!=a.code)u.warning(a.msg||"获取失败");else{const e=a.data.data;e&&Object.assign(_,e)}r.value=!1}).catch(e=>{u.error(e),r.value=!1})}}),(n,d)=>{const v=m,g=l,h=t,b=a,y=e,w=p,k=ve,x=c;return q(),O(I,null,[W((q(),L(y,null,{header:z(()=>[...d[5]||(d[5]=[R("div",{class:"card-header"},[R("span",null,"应用设置")],-1)])]),default:z(()=>[S(b,{model:K(_),ref_key:"refForm",ref:i,"label-width":"auto",inline:""},{default:z(()=>[S(g,{label:"黑暗模式",prop:"dark_mode"},{default:z(()=>[S(v,{modelValue:K(_).dark_mode,"onUpdate:modelValue":d[0]||(d[0]=e=>K(_).dark_mode=e),"inline-prompt":"",style:{"--el-switch-off-color":"#ff4949"},"active-icon":K(P),"inactive-icon":K(N)},null,8,["modelValue","active-icon","inactive-icon"])]),_:1}),S(g,{label:"桌面通知",prop:"notification"},{default:z(()=>[S(v,{modelValue:K(_).notification,"onUpdate:modelValue":d[1]||(d[1]=e=>K(_).notification=e),"inline-prompt":"",style:{"--el-switch-off-color":"#ff4949"},"active-icon":K(P),"inactive-icon":K(N)},null,8,["modelValue","active-icon","inactive-icon"])]),_:1}),S(g,{label:"自动检查更新",prop:"check_update"},{default:z(()=>[S(v,{modelValue:K(_).check_update,"onUpdate:modelValue":d[2]||(d[2]=e=>K(_).check_update=e),"inline-prompt":"",style:{"--el-switch-off-color":"#ff4949"},"active-icon":K(P),"inactive-icon":K(N)},null,8,["modelValue","active-icon","inactive-icon"])]),_:1}),S(g,{label:"开机启动",prop:"startup"},{default:z(()=>[S(v,{modelValue:K(_).startup,"onUpdate:modelValue":d[3]||(d[3]=e=>K(_).startup=e),"inline-prompt":"",style:{"--el-switch-off-color":"#ff4949"},"active-icon":K(P),"inactive-icon":K(N)},null,8,["modelValue","active-icon","inactive-icon"])]),_:1}),S(g,null,{default:z(()=>[W((q(),L(h,{type:"primary",onClick:d[4]||(d[4]=e=>(o.value=!0,void ae.addOrUpdateGlobalConfig({data:_}).then(e=>{const a=e.data;0!=a.code?u.warning(a.msg||"保存失败"):(_.id=a.data,u.success(a.msg||"保存成功"),Z(_.dark_mode),f.setDarkTheme(_.dark_mode),_.check_update?s.addInterval("check_update",ee,216e5):s.removeInterval("check_update")),o.value=!1}).catch(e=>{u.error(e),o.value=!1})))},{default:z(()=>[...d[6]||(d[6]=[H("保存",-1)])]),_:1})),[[x,K(o)]])]),_:1})]),_:1},8,["model"])]),_:1})),[[x,K(r)]]),S(w),S(k)],64)}}}),he=B({__name:"dyTab",setup(d){const i=j(),o=j(!1),r=j(!1),s=T({id:0,room_id:0,sing_prefix:"点歌",sing_cd:0,fans_level:1}),m=te(),p=()=>{"number"!=typeof s.room_id||s.room_id<1?u.warning("请输入正确的房间号"):0!=s.sing_prefix.length?"number"!=typeof s.sing_cd||s.sing_cd<0?u.warning("请输入正确的点歌cd"):"number"!=typeof s.fans_level||s.fans_level<0?u.warning("请输入正确的粉团等级"):(o.value=!0,ae.addOrUpdateDyConfig({data:s}).then(e=>{const a=e.data;0!=a.code?u.warning(a.msg):(u.success(a.msg),s.id=a.data,m.clearDanmakuList()),o.value=!1}).catch(e=>{u.error(e),o.value=!1})):u.warning("请输入正确的点歌指令")};return D(()=>{r.value=!0,ae.getDyConfig({}).then(e=>{const a=e.data;if(0!=a.code)u.warning(a.msg);else{if(!a.data.data)return void(r.value=!1);Object.assign(s,a.data.data)}r.value=!1}).catch(e=>{u.error(e),r.value=!1})}),(d,u)=>{const m=f,_=l,v=n,g=t,h=a,b=e,y=c;return q(),L(b,null,{header:z(()=>[...u[4]||(u[4]=[R("div",{class:"card-header"},[R("span",null,"抖音设置")],-1)])]),default:z(()=>[W((q(),L(h,{mode:K(s),ref_key:"refForm",ref:i,"label-width":"auto"},{default:z(()=>[S(_,{label:"房间号",prop:"room_id"},{default:z(()=>[S(m,{modelValue:K(s).room_id,"onUpdate:modelValue":u[0]||(u[0]=e=>K(s).room_id=e),min:1,controls:!1},null,8,["modelValue"])]),_:1}),S(_,{label:"点歌指令",prop:"sing_prefix"},{default:z(()=>[S(v,{modelValue:K(s).sing_prefix,"onUpdate:modelValue":u[1]||(u[1]=e=>K(s).sing_prefix=e),type:"text",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),S(_,{label:"点歌cd",prop:"sing_cd"},{default:z(()=>[S(m,{modelValue:K(s).sing_cd,"onUpdate:modelValue":u[2]||(u[2]=e=>K(s).sing_cd=e),placeholder:"点歌cd，单位：秒",min:0,controls:!1},null,8,["modelValue"])]),_:1}),S(_,{label:"粉团等级",prop:"fans_level"},{default:z(()=>[S(m,{modelValue:K(s).fans_level,"onUpdate:modelValue":u[3]||(u[3]=e=>K(s).fans_level=e),min:0,controls:!1},null,8,["modelValue"])]),_:1}),S(_,null,{default:z(()=>[W((q(),L(g,{type:"primary",onClick:p},{default:z(()=>[...u[5]||(u[5]=[H("保存",-1)])]),_:1})),[[y,K(o)]])]),_:1})]),_:1},8,["mode"])),[[y,K(r)]])]),_:1})}}}),be={class:"b-credential-card-header"},ye={class:"mb-4 flex items-center"},we={style:{height:"300px","padding-top":"1rem"}},ke={class:"qcode-image-container"},xe=["src"],Ve={key:0,class:"qcode-bage"},Ce=B({__name:"biliCredential",setup(a){const l=j(!1),n=j(!1),d=j(0),o=j(""),r=j(""),c=j(Array()),p=[{key:"uid",dataKey:"uid",title:"uid",width:200,cellRenderer:({cellData:e})=>S(s,null,{default:()=>[e,H(" ")]})},{key:"uname",dataKey:"uname",title:"昵称",width:300,cellRenderer:({cellData:e})=>S(s,null,{default:()=>[e,H(" ")]})},{key:"enable",dataKey:"enable",title:"是否启用",width:150,cellRenderer:({rowData:e})=>S(m,{modelValue:e.enable,"inline-prompt":!0,style:"--el-switch-off-color: #ff4949; --el-switch-on-color: #13ce66",activeText:"启用",inactiveText:"禁用",onChange:a=>{e.enable=a,b(a,e.id)}},{default:()=>[" "]})},{key:"operations",title:"操作",width:200,maxWidth:1020,minWidth:100,cellRenderer:({rowData:e})=>S(I,null,[S(t,{type:"success",icon:Y,loading:n.value,onClick:a=>x(e.id)},{default:()=>[H("刷新凭证")]}),S(t,{type:"danger",icon:$,onClick:a=>k(e.id)},{default:()=>[H("删除")]})])}],f=()=>{ae.getBiliCredntialList({}).then(e=>{const a=e.data;0!=a.code?u.warning(a.msg):c.value=a.data.rows}).catch(e=>{u.error(e)})},b=(e,a)=>{ae.UpdateBiliCredential({data:{id:a,enable:e}}).then(l=>{const n=l.data;if(0!=n.code)return u.warning(n.msg||"设置失败"),void y(a,!e);u.success(n.msg||"设置成功"),c.value.forEach((l,n,t)=>{l.id!=a&&(l.enable=!e)})}).catch(l=>{u.error(l),y(a,!e)})},y=(e,a)=>{const l=c.value.findIndex(a=>a.id===e);-1!==l&&(c.value[l].enable=a)},w=()=>{ae.getBiliCredentialCode({}).then(e=>{const a=e.data;0==a.code?(o.value=a.data.data,d.value=setInterval(V,1e3),l.value=!0):u.warning(a.msg)}).catch(e=>u.error(e))},k=e=>{h.confirm("是否删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>ae.deleteBiliCredential({id:e})).then(a=>{const l=a.data;if(0!=l.code)u.warning(l.msg);else{u.success(l.msg);const a=c.value.filter(a=>a.id!=e);c.value=a}}).catch(e=>{"string"==typeof e&&"cancel"==e||u.error(e)})},x=e=>{n.value=!0,ae.refreshBiliCredential({id:e}).then(e=>{const a=e.data;0!=a.code?u.warning(a.msg):u.success("success"),n.value=!1}).catch(e=>{u.error(e),n.value=!1})},V=()=>{ae.checkQrCode({}).then(e=>{const a=e.data;if(0==a.code){if("success"==a.msg&&(clearInterval(d.value),d.value=0,r.value="",u.success("登录成功"),f(),l.value=!1),"qr_state"==a.msg)switch(a.data.data){case"confirm":r.value="已扫码";break;case"timeout":r.value="二维码已过期";break;default:r.value=""}}else u.warning(a.msg||"二维码状态请求错误")}).catch(e=>u.error(e))},C=()=>{clearInterval(d.value),d.value=0};return D(()=>{f()}),(a,n)=>{const d=i,s=v,u=_,m=e,f=g;return q(),O(I,null,[S(m,null,{header:z(()=>[R("div",be,[n[1]||(n[1]=R("span",null,"账号设置",-1)),S(d,{title:"未登录账号无法获取到弹幕用户昵称等信息，如有需要可添加一个小号",type:"warning",closable:!1,style:{"margin-top":"1rem"}})])]),default:z(()=>[R("div",ye,[S(K(t),{type:"primary",onClick:w},{default:z(()=>[...n[2]||(n[2]=[H("新增",-1)])]),_:1})]),R("div",we,[S(u,null,{default:z(({width:e,height:a})=>[S(s,{columns:p,data:K(c),width:e,height:a,fixed:""},null,8,["data","width","height"])]),_:1})])]),_:1}),S(f,{modelValue:K(l),"onUpdate:modelValue":n[0]||(n[0]=e=>A(l)?l.value=e:null),title:"新增",width:"720",onClose:C,"destroy-on-close":""},{default:z(()=>[R("div",ke,[R("img",{src:K(o),alt:"qrcode",class:"qcode",referrerpolicy:"no-referrer"},null,8,xe),K(r).length>0?(q(),O("div",Ve,M(K(r)),1)):Q("",!0)])]),_:1},8,["modelValue"])],64)}}}),Ue=B({__name:"biliTab",setup(d){const i=j(),o=j(!1),r=T({id:0,room_id:0,modal_level:1,user_level:0,sing_prefix:"点歌",sing_cd:0}),s=te(),m=[{key:"普通用户",value:0},{key:"舰长",value:3},{key:"提督",value:2},{key:"总督",value:1}];return D(()=>{o.value=!0,ae.getBiliConfig({}).then(e=>{const a=e.data;if(0!=a.code)u.warning(a.msg);else{const e=a.data.data;e&&Object.assign(r,e)}o.value=!1}).catch(e=>{u.error(e),o.value=!1})}),(d,_)=>{const v=f,g=l,h=y,w=b,k=n,x=a,V=e,C=p,U=Ce,B=c;return W((q(),O("div",null,[S(V,null,{header:z(()=>[..._[6]||(_[6]=[R("div",{class:"card-header"},[R("span",null,"基础设置")],-1)])]),default:z(()=>[S(x,{model:K(r),ref_key:"refForm",ref:i,"label-width":"auto"},{default:z(()=>[S(g,{label:"房间号",prop:"room_id"},{default:z(()=>[S(v,{modelValue:K(r).room_id,"onUpdate:modelValue":_[0]||(_[0]=e=>K(r).room_id=e),placeholder:"B站直播间号",min:1,controls:!1},null,8,["modelValue"])]),_:1}),S(g,{label:"粉丝牌等级",prop:"modal_level"},{default:z(()=>[S(v,{modelValue:K(r).modal_level,"onUpdate:modelValue":_[1]||(_[1]=e=>K(r).modal_level=e),placeholder:"粉丝牌等级",min:0,controls:!1},null,8,["modelValue"])]),_:1}),S(g,{label:"用户等级",prop:"user_level"},{default:z(()=>[S(w,{modelValue:K(r).user_level,"onUpdate:modelValue":_[2]||(_[2]=e=>K(r).user_level=e)},{default:z(()=>[(q(),O(I,null,G(m,e=>S(h,{value:e.value},{default:z(()=>[H(M(e.key),1)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"])]),_:1}),S(g,{label:"点歌指令",prop:"sing_prefix"},{default:z(()=>[S(k,{modelValue:K(r).sing_prefix,"onUpdate:modelValue":_[3]||(_[3]=e=>K(r).sing_prefix=e),placeholder:"点歌指令",type:"text",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),S(g,{label:"点歌cd",prop:"sing_cd"},{default:z(()=>[S(v,{modelValue:K(r).sing_cd,"onUpdate:modelValue":_[4]||(_[4]=e=>K(r).sing_cd=e),placeholder:"点歌cd，单位：秒",min:0,controls:!1},null,8,["modelValue"])]),_:1}),S(g,null,{default:z(()=>[S(K(t),{type:"primary",onClick:_[5]||(_[5]=e=>{"number"!=typeof r.room_id||r.room_id<1?u.warning("请输入正确的房间号"):"number"!=typeof r.modal_level||r.modal_level<0?u.warning("请输入正确的粉丝牌等级"):0!=r.sing_prefix.length?"number"!=typeof r.sing_cd||r.sing_cd<0?u.warning("请输入正确的点歌cd"):ae.addOrUpdateBiliConfig({data:r}).then(e=>{const a=e.data;0!=a.code?u.warning(a.msg):(u.success(a.msg),r.id=a.data,s.clearDanmakuList())}).catch(e=>u.error(e)):u.warning("请输入正确的点歌指令")})},{default:z(()=>[..._[7]||(_[7]=[H("保存",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),S(C),S(U)])),[[B,K(o)]])}}}),Be=B({__name:"Settings",setup(e){const a=j("1"),l=j(),n=(e,a)=>{3==e.props.name&&l.value?.initConfig()};return(e,t)=>{const d=Ue,i=V,o=he,r=ge,s=x,u=k,c=w;return q(),L(c,{class:"settings-container"},{default:z(()=>[S(u,{class:"settings-main"},{default:z(()=>[S(s,{modelValue:K(a),"onUpdate:modelValue":t[0]||(t[0]=e=>A(a)?a.value=e:null),type:"border-card",class:"settings-tabs",onTabClick:n},{default:z(()=>[S(i,{label:"哔哩哔哩设置",name:"1"},{default:z(()=>[S(d)]),_:1}),S(i,{label:"抖音设置",name:"2",lazy:""},{default:z(()=>[S(o)]),_:1}),S(i,{label:"应用设置",name:"3"},{default:z(()=>[S(r,{ref_key:"appSettingRef",ref:l},null,512)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}}});export{Be as default};
