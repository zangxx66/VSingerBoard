import{m as e,n as a,o as l,p as s,q as t,r as o,s as i,a as n,v as r,e as u,t as d,b as c,l as m,u as p,w as _,x as f,y as g}from"./vendor-element-plus-BAdGi-BR.js";import{u as y}from"./danmaku-CZvCi_hp.js";import{q as b,r as v,aa as h,I as w,v as k,u as C,h as x,J as j,T as L,t as S,ay as V,S as D,Q as I,c as R,L as E,R as O,K as T,P as U,B as A,bL as B,bM as M,Z as $,Y as F,bN as H,O as q,bO as J,bP as N,bQ as P,bR as Q,a2 as W}from"./vendor-libs-B7kAgHVc.js";import{_ as K,a as Y}from"./fansMedal-53R_GX_t.js";import{_ as Z}from"./linkIcon-Bms7p550.js";import{b as z,a as G,d as X,g as ee}from"./index-d4Ui0gHI.js";import{e as ae}from"./vendor-exceljs-C-8i3j8b.js";import{u as le}from"./interval-CRta3I7C.js";import"./vendor-vue-l4c-_Jld.js";const se=b({__name:"addSingDialog",setup(r,{expose:u}){const d=v(!1),c=y(),m=h({uid:0,uname:"",msg:"",send_time:0,source:"douyin",medal_level:0,medal_name:"",guard_level:0}),p=[{key:"抖音",value:"douyin"},{key:"B站",value:"bilibili"}],_=()=>{m.uname="",m.msg="",m.source="douyin"};return u({openDialog:()=>{d.value=!0}}),(r,u)=>{const f=l,g=a,y=t,b=s,v=o,h=i,R=e;return k(),w(R,{modelValue:C(d),"onUpdate:modelValue":u[4]||(u[4]=e=>x(d)?d.value=e:null),title:"手动点歌",width:"720",onClose:_},{default:j(()=>[L(h,{model:C(m),"label-width":"auto"},{default:j(()=>[L(g,{label:"用户昵称",prop:"uname"},{default:j(()=>[L(f,{modelValue:C(m).uname,"onUpdate:modelValue":u[0]||(u[0]=e=>C(m).uname=e),placeholder:"用户昵称",type:"text"},null,8,["modelValue"])]),_:1}),L(g,{label:"点歌内容",prop:"msg"},{default:j(()=>[L(f,{modelValue:C(m).msg,"onUpdate:modelValue":u[1]||(u[1]=e=>C(m).msg=e),placeholder:"点歌内容",type:"text"},null,8,["modelValue"])]),_:1}),L(g,{label:"点歌平台",prop:"source"},{default:j(()=>[L(b,{modelValue:C(m).source,"onUpdate:modelValue":u[2]||(u[2]=e=>C(m).source=e),placeholder:"请选择点歌平台"},{default:j(()=>[(k(),S(D,null,V(p,e=>L(y,{label:e.key,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),L(g,null,{default:j(()=>[L(v,{type:"primary",onClick:u[3]||(u[3]=e=>{""!=m.msg?(c.pushDanmakuList([{...m}]),d.value=!1):n.error("点歌内容不能为空")})},{default:j(()=>[...u[5]||(u[5]=[I("保存",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),te={class:"platform-status-container"},oe=["src","alt"],ie=b({__name:"platformStatus",props:{platform:{},roomId:{},wsStatus:{}},setup(e){const a=e,l=v(!1),s=()=>{l.value=!0;try{"bilibili"==a.platform?window.pywebview.api.restart_bilibili_ws():window.pywebview.api.restart_douyin_ws(),n.success("刷新成功，请等待操作完成")}catch(e){n.error(e)}finally{setTimeout(()=>{l.value=!1},5e3)}},t={bilibili:new Map([[-1,{color:"#F56C6C",icon:A,message:"未配置或出现错误"}],[0,{color:"#E6A23C",icon:B,message:"初始化"}],[1,{color:"#E6A23C",icon:B,message:"连接建立中"}],[2,{color:"#67C23A",icon:M,message:"已连接"}],[3,{color:"#E6A23C",icon:B,message:"断开连接中"}],[4,{color:"#F56C6C",icon:A,message:"已断开"}],[5,{color:"#F56C6C",icon:A,message:"出现错误"}]]),douyin:new Map([[-1,{color:"#F56C6C",icon:A,message:"未配置或出现错误"}],[0,{color:"#E6A23C",icon:B,message:"未连接"}],[1,{color:"#67C23A",icon:M,message:"已连接"}],[2,{color:"#E6A23C",icon:B,message:"已断开"}],[3,{color:"#F56C6C",icon:A,message:"出现错误"}]])},i=R(()=>t[a.platform].get(a.wsStatus));return(a,t)=>{const n=u,c=o,m=d,p=r;return k(),S("div",te,[E("img",{src:`/assets/images/${e.platform}.png`,class:"source-img",alt:e.platform,width:"24"},null,8,oe),I("："+O(e.roomId)+"   ",1),L(m,{placement:"top"},{content:j(()=>[E("span",null,"当前状态："+O(C(i).message)+"，如有异常点击重新连接",1)]),default:j(()=>[T((k(),w(c,{text:"",onClick:s},{default:j(()=>[L(n,{color:C(i).color,class:"status-img"},{default:j(()=>[(k(),w(U(C(i).icon)))]),_:1},8,["color"])]),_:1})),[[p,C(l)]])]),_:1})])}}}),ne={class:"card-header"},re={class:"chat-infinite-list-item"},ue=["src","alt"],de={class:"chat-card-footer"},ce={class:"card-footer-right"},me=b({__name:"Home",setup(e){const a=v(),l=h({douyin_romm_id:0,bilibili_room_id:0,douyin_ws_status:-1,bilibili_ws_status:-1}),s=y(),t=le(),i=v(null);let r;const b=async()=>{const e=await window.pywebview.api.get_live_config();Object.assign(l,e)},x=()=>{},U=e=>{G(e),n.success("拷贝成功")},A=()=>{g.confirm("是否清空点歌列表","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{s.clearDanmakuList(),r("clear danmaku")}).catch(e=>{"string"==typeof e&&"cancel"==e||n.error(e)})},B=()=>{(async(e,a,l)=>{const s=new ae.Workbook,t=s.addWorksheet("Sheet1");t.columns=e,t.addRows(a);const o=await s.xlsx.writeBuffer(),i=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),n=window.URL.createObjectURL(i),r=document.createElement("a");r.href=n,r.download=l,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(n)})([{header:"日期",key:"date",width:50},{header:"昵称",key:"uname",width:50},{header:"歌名",key:"song",width:50},{header:"平台",key:"source",width:50}],oe.value.map(e=>({date:X(e.send_time),uname:e.uname,song:e.msg,source:"bilibili"==e.source?"B站":"抖音"})),`点歌列表_${ee()}`)},M=async()=>{const e=await window.pywebview.api.is_bundle()?8e3:5173,a=document.createElement("a");a.href=`http://127.0.0.1:${e}/danmaku`,a.target="_blank",a.click(),a.remove()},te=()=>{a.value&&a.value.openDialog()},oe=R(()=>s.getDanmakuList());return $(oe,async()=>{await W(),i.value&&i.value.scrollTo({behavior:"smooth",top:i.value.scrollHeight})}),F(()=>{const e=.9*window.innerHeight;document.querySelector(".chat-main").style.overflow="hidden";const a=.8*e;document.querySelector(".chat-infinite-list").style.height=`${a}px`,(()=>{const{send:e}=H("ws://127.0.0.1:8080",{autoReconnect:!0,autoClose:!0,heartbeat:{message:"heartbeat",interval:5e3,pongTimeout:1e4},onMessage:(e,a)=>{const l=JSON.parse(a.data);if("echo"!=l.type)if("del"==l.type)l.data.forEach(e=>{let a;if(a=e.song_name?oe.value.find(a=>a.uid==e.uid&&a.uname==e.uname):oe.value.find(a=>a.uid==e.uid&&a.uname==e.uname&&a.msg==e.song_name),a){const e=oe.value.indexOf(a);e>-1&&oe.value.splice(e,1)}});else if("add"==l.type){const e=l.data,a=e.filter(e=>"douyin"==e.source),t=e.filter(e=>"bilibili"==e.source),o=[...oe.value,...z(a,"douyin"),...z(t,"bilibili")];s.setDanmakuList(o)}}});r=e})(),t.addInterval("get_live_config",b,1e3)}),(e,t)=>{const n=Z,g=K,y=Y,b=_,v=u,h=d,R=o,$=ie,F=p,H=se,W=m,z=c,G=f;return k(),w(z,{class:"chat-container"},{default:j(()=>[L(W,{class:"chat-main"},{default:j(()=>[L(F,{class:"chat-card"},{header:j(()=>[E("div",ne,[E("span",null,[t[0]||(t[0]=I(" 点歌列表 ",-1)),L(n,{style:{cursor:"pointer"},onClick:M})])])]),footer:j(()=>[E("div",de,[L(R,{type:"primary",onClick:te},{default:j(()=>[t[1]||(t[1]=I(" 手动点歌 ",-1)),L(v,null,{default:j(()=>[L(C(N))]),_:1})]),_:1}),L(R,{type:"danger",disabled:0==C(oe).length,onClick:A},{default:j(()=>[t[2]||(t[2]=I(" 清空点歌列表 ",-1)),L(v,{class:"el-icon--right"},{default:j(()=>[L(C(P))]),_:1})]),_:1},8,["disabled"]),L(R,{type:"success",disabled:0==C(oe).length,onClick:B},{default:j(()=>[t[3]||(t[3]=I(" 导出点歌列表 ",-1)),L(v,{class:"el-icon--right"},{default:j(()=>[L(C(Q))]),_:1})]),_:1},8,["disabled"]),E("div",ce,[C(l).douyin_romm_id>0?(k(),w($,{key:0,platform:"douyin",roomId:C(l).douyin_romm_id,wsStatus:C(l).douyin_ws_status},null,8,["roomId","wsStatus"])):q("",!0),C(l).bilibili_room_id>0?(k(),w($,{key:1,platform:"bilibili",roomId:C(l).bilibili_room_id,wsStatus:C(l).bilibili_ws_status},null,8,["roomId","wsStatus"])):q("",!0)])])]),default:j(()=>[T((k(),S("div",{class:"chat-infinite-list",ref_key:"infiniteList",ref:i},[(k(!0),S(D,null,V(C(oe),e=>(k(),S("div",re,[E("img",{src:`/assets/images/${e.source}.png`,class:"source-img",alt:e.source,width:"24"},null,8,ue),L(b,{tag:"span",class:"chat-tag"},{default:j(()=>[e.medal_level>0?(k(),S(D,{key:0},["bilibili"==e.source?(k(),w(g,{key:0,medal_name:e.medal_name,medal_level:e.medal_level,guard_level:e.guard_level},null,8,["medal_name","medal_level","guard_level"])):q("",!0),"douyin"==e.source?(k(),w(y,{key:1,medal_name:e.medal_name,medal_level:e.medal_level,guard_level:e.guard_level},null,8,["medal_name","medal_level","guard_level"])):q("",!0)],64)):q("",!0),null!=e.html&&e.html.length>0?(k(),S(D,{key:1},[I(O(e.uname)+"； ",1),L(b,{innerHTML:e.html,title:"点击复制"+e.msg,style:{display:"flex",cursor:"pointer",width:"100%"},onClick:a=>U(e.msg)},null,8,["innerHTML","title","onClick"])],64)):(k(),S(D,{key:2},[I(O(e.uname)+"： ",1),L(b,{title:"点击复制"+e.msg,style:{display:"flex",cursor:"pointer",width:"100%"},onClick:a=>U(e.msg)},{default:j(()=>[I(O(e.msg),1)]),_:2},1032,["title","onClick"])],64))]),_:2},1024),L(h,{placement:"bottom"},{content:j(()=>[E("span",null,"移除点歌："+O(e.msg),1)]),default:j(()=>[L(b,{tag:"span",class:"chat-close",onClick:a=>(e=>{s.removeDanmakuList(e);const a=JSON.stringify(e);r(`delete${a}`)})(e)},{default:j(()=>[L(v,null,{default:j(()=>[L(C(J))]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]))),256))])),[[G,x]])]),_:1}),L(H,{ref_key:"singDialogRef",ref:a},null,512)]),_:1})]),_:1})}}});export{me as default};
