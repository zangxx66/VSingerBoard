const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/platformStatus-BUiqhxdC.js","assets/vendor-element-plus-CAbZ6VM0.js","assets/vendor-libs-DUytVOgY.js","assets/vendor-exceljs-BzIpynsW.js","assets/vendor-libs-CtmmCz1m.css","assets/vendor-element-plus-B-fPOo-g.css","assets/addSingDialog-BBFWkkal.js","assets/danmaku-HSbRWeUS.js","assets/vendor-vue-BEIf0qVf.js"])))=>i.map(i=>d[i]);
import{b as e,a,d as l,g as s,_ as t}from"./index-76T0Z4m6.js";import{b as i,l as n,m as o,n as d,o as r,e as u,p as c,q as m,a as _,r as f}from"./vendor-element-plus-CAbZ6VM0.js";import{q as p,r as v,ab as h,c as g,$ as b,_ as y,K as w,bK as k,L,aX as j,v as S,V as x,M as C,t as O,U as D,ay as R,O as T,Q as E,S as I,T as $,u as B,bL as H,bM as M,bN as U,bO as q,bP as N,a3 as P}from"./vendor-libs-DUytVOgY.js";import{e as V}from"./vendor-exceljs-BzIpynsW.js";import{u as A}from"./interval-pHlrBWSF.js";import{u as J}from"./danmaku-HSbRWeUS.js";import"./vendor-vue-BEIf0qVf.js";const K={class:"card-header"},W={class:"chat-infinite-list-item"},Q=["src","alt"],X={class:"chat-card-footer"},z={class:"card-footer-right"},F=p({__name:"Home",setup(p){const F=N(()=>t(()=>import("./platformStatus-BUiqhxdC.js"),__vite__mapDeps([0,1,2,3,4,5]))),G=N(()=>t(()=>import("./addSingDialog-BBFWkkal.js"),__vite__mapDeps([6,1,2,3,4,5,7,8]))),Y=v(),Z=h({douyin_romm_id:0,bilibili_room_id:0,douyin_ws_status:-1,bilibili_ws_status:-1}),ee=J(),ae=A(),le=v(null);let se;const te=async()=>{const e=await window.pywebview.api.get_live_config();Object.assign(Z,e)},ie=()=>{},ne=()=>{f.confirm("是否清空点歌列表","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{ee.clearDanmakuList(),se("clear danmaku")}).catch(e=>{"string"==typeof e&&"cancel"==e||_.error(e)})},oe=()=>{(async(e,a,l)=>{const s=new V.Workbook,t=s.addWorksheet("Sheet1");t.columns=e,t.addRows(a);const i=await s.xlsx.writeBuffer(),n=new Blob([i],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),o=window.URL.createObjectURL(n),d=document.createElement("a");d.href=o,d.download=l,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(o)})([{header:"日期",key:"date",width:50},{header:"昵称",key:"uname",width:50},{header:"歌名",key:"song",width:50},{header:"平台",key:"source",width:50}],ue.value.map(e=>({date:l(e.send_time),uname:e.uname,song:e.msg,source:"bilibili"==e.source?"B站":"抖音"})),`点歌列表_${s()}`)},de=async()=>{const e=await window.pywebview.api.is_bundle()?8e3:5173,a=document.createElement("a");a.href=`http://127.0.0.1:${e}/danmaku`,a.target="_blank",a.click(),a.remove()},re=()=>{Y.value&&Y.value.openDialog()},ue=g(()=>ee.getDanmakuList());return b(ue,async()=>{await P(),le.value&&le.value.scrollTo({behavior:"smooth",top:le.value.scrollHeight})}),y(()=>{const a=.9*window.innerHeight;document.querySelector(".chat-main").style.overflow="hidden";const l=.8*a;document.querySelector(".chat-infinite-list").style.height=`${l}px`,(()=>{const{send:a}=k("ws://127.0.0.1:8080",{autoReconnect:!0,autoClose:!0,heartbeat:{message:"heartbeat",interval:5e3,pongTimeout:1e4},onMessage:(a,l)=>{const s=JSON.parse(l.data);if("echo"!=s.type)if("del"==s.type)s.data.forEach(e=>{let a;if(a=e.song_name?ue.value.find(a=>a.uid==e.uid&&a.uname==e.uname):ue.value.find(a=>a.uid==e.uid&&a.uname==e.uname&&a.msg==e.song_name),a){const e=ue.value.indexOf(a);e>-1&&ue.value.splice(e,1)}});else if("add"==s.type){const a=s.data,l=a.filter(e=>"douyin"==e.source),t=a.filter(e=>"bilibili"==e.source),i=[...ue.value,...e(l,"douyin"),...e(t,"bilibili")];ee.setDanmakuList(i)}}});se=a})(),ae.addInterval("get_live_config",te,1e3)}),(e,l)=>{const s=j("link-icon"),t=j("fans-medal"),f=j("fans-club"),p=r,v=d,h=u,g=m,b=o,y=n,k=i,N=c;return S(),w(k,{class:"chat-container"},{default:L(()=>[x(y,{class:"chat-main"},{default:L(()=>[x(b,{class:"chat-card"},{header:L(()=>[T("div",K,[T("span",null,[l[0]||(l[0]=I(" 点歌列表 ",-1)),x(s,{style:{cursor:"pointer"},onClick:de})])])]),footer:L(()=>[T("div",X,[x(g,{type:"primary",onClick:re},{default:L(()=>[l[1]||(l[1]=I(" 手动点歌 ",-1)),x(h,null,{default:L(()=>[x(B(M))]),_:1})]),_:1}),x(g,{type:"danger",disabled:0==ue.value.length,onClick:ne},{default:L(()=>[l[2]||(l[2]=I(" 清空点歌列表 ",-1)),x(h,{class:"el-icon--right"},{default:L(()=>[x(B(U))]),_:1})]),_:1},8,["disabled"]),x(g,{type:"success",disabled:0==ue.value.length,onClick:oe},{default:L(()=>[l[3]||(l[3]=I(" 导出点歌列表 ",-1)),x(h,{class:"el-icon--right"},{default:L(()=>[x(B(q))]),_:1})]),_:1},8,["disabled"]),T("div",z,[Z.douyin_romm_id>0?(S(),w(B(F),{key:0,platform:"douyin",roomId:Z.douyin_romm_id,wsStatus:Z.douyin_ws_status},null,8,["roomId","wsStatus"])):E("",!0),Z.bilibili_room_id>0?(S(),w(B(F),{key:1,platform:"bilibili",roomId:Z.bilibili_room_id,wsStatus:Z.bilibili_ws_status},null,8,["roomId","wsStatus"])):E("",!0)])])]),default:L(()=>[C((S(),O("div",{class:"chat-infinite-list",ref_key:"infiniteList",ref:le},[(S(!0),O(D,null,R(ue.value,e=>(S(),O("div",W,[T("img",{src:`/assets/images/${e.source}.png`,class:"source-img",alt:e.source,width:"24"},null,8,Q),x(v,{placement:"bottom"},{content:L(()=>[T("span",null,"点击复制歌名："+$(e.msg),1)]),default:L(()=>[x(p,{tag:"span",class:"chat-tag",onClick:l=>{return s=e.msg,a(s),void _.success("拷贝成功");var s}},{default:L(()=>[e.medal_level>0?(S(),O(D,{key:0},["bilibili"==e.source?(S(),w(t,{key:0,medal_name:e.medal_name,medal_level:e.medal_level,guard_level:e.guard_level},null,8,["medal_name","medal_level","guard_level"])):E("",!0),"douyin"==e.source?(S(),w(f,{key:1,medal_name:e.medal_name,medal_level:e.medal_level,guard_level:e.guard_level},null,8,["medal_name","medal_level","guard_level"])):E("",!0)],64)):E("",!0),null!=e.html&&e.html.length>0?(S(),O(D,{key:1},[I($(e.uname)+"； ",1),x(p,{innerHTML:e.html,style:{display:"flex"}},null,8,["innerHTML"])],64)):(S(),O(D,{key:2},[I($(e.uname)+"： "+$(e.msg),1)],64))]),_:2},1032,["onClick"])]),_:2},1024),x(v,{placement:"bottom"},{content:L(()=>[T("span",null,"移除点歌："+$(e.msg),1)]),default:L(()=>[x(p,{tag:"span",class:"chat-close",onClick:a=>(e=>{ee.removeDanmakuList(e);const a=JSON.stringify(e);se(`delete${a}`)})(e)},{default:L(()=>[x(h,null,{default:L(()=>[x(B(H))]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]))),256))])),[[N,ie]])]),_:1}),x(B(G),{ref_key:"singDialogRef",ref:Y},null,512)]),_:1})]),_:1})}}});export{F as default};
