import{b as e,l as a,o as l,p as s}from"./vendor-element-plus-CAbZ6VM0.js";import{b as n}from"./index-NUBkmFdY.js";import"./vendor-exceljs-BzIpynsW.js";import{q as t,r as i,$ as d,_ as u,K as m,L as r,bK as o,V as v,M as c,t as _,U as f,ay as b,aX as p,v as g,O as k,S as y,T as h,Q as j,a3 as x}from"./vendor-libs-DUytVOgY.js";import"./vendor-vue-BEIf0qVf.js";const T={class:"danmaku-list-item"},L={class:"danmaku-sing"},M={class:"danmaku-uname"},O={class:"danmaku-fans"},H=t({__name:"Danmaku",setup(t){const H=i(Array()),S=i(null),w=()=>{};return d(H,async()=>{await x(),S.value&&S.value.scrollTo({behavior:"smooth",top:S.value.scrollHeight})}),u(()=>{document.title="点歌列表",o("ws://127.0.0.1:8080",{autoReconnect:!0,autoClose:!0,heartbeat:{message:"heartbeat",interval:5e3,pongTimeout:1e4},onMessage:(e,a)=>{if(!a.data.startsWith("Echo"))if("clear danmaku"==a.data)H.value=[];else if(a.data.startsWith("delete")){const e=JSON.parse(a.data.substring(6)),l=H.value.find(a=>a.uid==e.uid&&a.send_time==e.send_time);if(l){const e=H.value.indexOf(l);e>-1&&H.value.splice(e,1)}}else{const e=JSON.parse(a.data),l=e.filter(e=>"douyin"==e.source),s=e.filter(e=>"bilibili"==e.source);H.value=[...H.value,...n(l,"douyin"),...n(s,"bilibili")]}}})}),(n,t)=>{const i=l,d=p("fans-medal"),u=p("fans-club"),o=a,x=e,J=s;return g(),m(x,{class:"danmaku-container"},{default:r(()=>[v(o,null,{default:r(()=>[c((g(),_("div",{class:"danmaku-list",ref_key:"infiniteList",ref:S},[(g(!0),_(f,null,b(H.value,e=>(g(),_("div",T,[k("div",L,[null!=e.html&&e.html.length>0?(g(),m(i,{key:0,innerHTML:e.html,style:{display:"flex"}},null,8,["innerHTML"])):(g(),_(f,{key:1},[y(h(e.msg),1)],64))]),k("div",M,h(e.uname),1),k("div",O,[e.medal_level>0?(g(),_(f,{key:0},["bilibili"==e.source?(g(),m(d,{key:0,medal_name:e.medal_name,medal_level:e.medal_level,guard_level:e.guard_level},null,8,["medal_name","medal_level","guard_level"])):j("",!0),"douyin"==e.source?(g(),m(u,{key:1,medal_name:e.medal_name,medal_level:e.medal_level,guard_level:e.guard_level},null,8,["medal_name","medal_level","guard_level"])):j("",!0)],64)):j("",!0)])]))),256))])),[[J,w]])]),_:1})]),_:1})}}});export{H as default};
