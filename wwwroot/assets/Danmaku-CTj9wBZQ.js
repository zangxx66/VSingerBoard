import{b as e,l as a,o as l,p as s}from"./vendor-element-plus-CAbZ6VM0.js";import{b as n}from"./index-76T0Z4m6.js";import"./vendor-exceljs-BzIpynsW.js";import{q as i,r as u,$ as d,_ as t,K as m,L as o,bK as r,V as v,M as c,t as _,U as f,ay as p,aX as y,v as g,O as b,S as k,T as h,Q as j,a3 as x}from"./vendor-libs-DUytVOgY.js";import"./vendor-vue-BEIf0qVf.js";const T={class:"danmaku-list-item"},L={class:"danmaku-sing"},M={class:"danmaku-uname"},O={class:"danmaku-fans"},H=i({__name:"Danmaku",setup(i){const H=u(Array()),w=u(null),K=()=>{};return d(H,async()=>{await x(),w.value&&w.value.scrollTo({behavior:"smooth",top:w.value.scrollHeight})}),t(()=>{document.title="点歌列表",r("ws://127.0.0.1:8080",{autoReconnect:!0,autoClose:!0,heartbeat:{message:"heartbeat",interval:5e3,pongTimeout:1e4},onMessage:(e,a)=>{const l=JSON.parse(a.data);if("echo"!=l.type)if("clear"==l.type)H.value=[];else if("remove"==l.type){const e=l.data,a=H.value.find(a=>a.uid==e.uid&&a.send_time==e.send_time);if(a){const e=H.value.indexOf(a);e>-1&&H.value.splice(e,1)}}else if("del"==l.type)l.data.forEach(e=>{let a;if(a=e.song_name?H.value.find(a=>a.uid==e.uid&&a.uname==e.uname&&a.msg==e.song_name):H.value.find(a=>a.uid==e.uid&&a.uname==e.uname),a){const e=H.value.indexOf(a);e>-1&&H.value.splice(e,1)}});else{const e=l.data,a=e.filter(e=>"douyin"==e.source),s=e.filter(e=>"bilibili"==e.source);H.value=[...H.value,...n(a,"douyin"),...n(s,"bilibili")]}}})}),(n,i)=>{const u=l,d=y("fans-medal"),t=y("fans-club"),r=a,x=e,S=s;return g(),m(x,{class:"danmaku-container"},{default:o(()=>[v(r,null,{default:o(()=>[c((g(),_("div",{class:"danmaku-list",ref_key:"infiniteList",ref:w},[(g(!0),_(f,null,p(H.value,e=>(g(),_("div",T,[b("div",L,[null!=e.html&&e.html.length>0?(g(),m(u,{key:0,innerHTML:e.html,style:{display:"flex"}},null,8,["innerHTML"])):(g(),_(f,{key:1},[k(h(e.msg),1)],64))]),b("div",M,h(e.uname),1),b("div",O,[e.medal_level>0?(g(),_(f,{key:0},["bilibili"==e.source?(g(),m(d,{key:0,medal_name:e.medal_name,medal_level:e.medal_level,guard_level:e.guard_level},null,8,["medal_name","medal_level","guard_level"])):j("",!0),"douyin"==e.source?(g(),m(t,{key:1,medal_name:e.medal_name,medal_level:e.medal_level,guard_level:e.guard_level},null,8,["medal_name","medal_level","guard_level"])):j("",!0)],64)):j("",!0)])]))),256))])),[[S,K]])]),_:1})]),_:1})}}});export{H as default};
