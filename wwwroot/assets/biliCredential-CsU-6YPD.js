import{p as e,D as a,F as t,G as l,l as s,A as r,n,e as i,E as d,q as c}from"./vendor-element-plus-J1ABhGI2.js";import{q as o,r as u,_ as v,t as h,v as m,V as f,L as g,O as p,u as w,S as y,Q as b,T as C,U as _,bR as x,bL as k}from"./vendor-libs-BJ1SQKxe.js";import{r as B}from"./request-DpsVWM9s.js";import{_ as j}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./vendor-exceljs-BzIpynsW.js";const q={class:"card-header"},D={class:"mb-4 flex items-center"},I={style:{height:"300px","padding-top":"1rem"}},R={class:"avatar-image-container"},T=["src"],V={key:0,class:"code-bage"},K=j(o({__name:"biliCredential",setup(o){const j=u(!1),K=u(!1),L=u(0),U=u(""),A=u(""),E=u(Array()),Q=[{key:"uid",dataKey:"uid",title:"uid",width:200,cellRenderer:({cellData:e})=>f(n,null,{default:()=>[e,y(" ")]})},{key:"uname",dataKey:"uname",title:"昵称",width:300,cellRenderer:({cellData:e})=>f(n,null,{default:()=>[e,y(" ")]})},{key:"enable",dataKey:"enable",title:"是否启用",width:150,cellRenderer:({rowData:e})=>f(i,{modelValue:e.enable,"inline-prompt":!0,style:"--el-switch-off-color: #ff4949; --el-switch-on-color: #13ce66",activeText:"启用",inactiveText:"禁用",onChange:a=>{e.enable=a,F(a,e.id)}},{default:()=>[" "]})},{key:"operations",title:"操作",width:200,maxWidth:1020,minWidth:100,cellRenderer:({rowData:a})=>f(_,null,[f(e,{type:"success",icon:x,loading:K.value,onClick:e=>z(a.id)},{default:()=>[y("刷新")]}),f(e,{type:"danger",icon:k,onClick:e=>S(a.id)},{default:()=>[y("删除")]})])}],W=()=>{B.getBiliCredntialList({}).then(e=>{const a=e.data;0!=a.code?d.warning(a.msg):E.value=a.data.rows}).catch(e=>{d.error(e)})},F=(e,a)=>{B.UpdateBiliCredential({data:{id:a,enable:e}}).then(t=>{const l=t.data;if(0!=l.code)return d.warning(l.msg||"设置失败"),void G(a,!e);d.success(l.msg||"设置成功"),E.value.forEach((t,l,s)=>{t.id!=a&&(t.enable=!e)})}).catch(t=>{d.error(t),G(a,!e)})},G=(e,a)=>{const t=E.value.findIndex(a=>a.id===e);-1!==t&&(E.value[t].enable=a)},O=()=>{B.getBiliCredentialCode({}).then(e=>{const a=e.data;0==a.code?(U.value=a.data.data,L.value=setInterval(H,1e3),j.value=!0):d.warning(a.msg)}).catch(e=>d.error(e))},S=e=>{c.confirm("是否删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>B.deleteBiliCredential({id:e})).then(a=>{const t=a.data;if(0!=t.code)d.warning(t.msg);else{d.success(t.msg);const a=E.value.filter(a=>a.id!=e);E.value=a}}).catch(e=>{"string"==typeof e&&"cancel"==e||d.error(e)})},z=e=>{K.value=!0,B.refreshBiliCredential({id:e}).then(e=>{const a=e.data;0!=a.code?d.warning(a.msg):d.success("success"),K.value=!1}).catch(e=>{d.error(e),K.value=!1})},H=()=>{B.checkQrCode({}).then(e=>{const a=e.data;if(0==a.code){if("success"==a.msg&&(clearInterval(L.value),L.value=0,A.value="",d.success("登录成功"),W(),j.value=!1),"qr_state"==a.msg)switch(a.data.data){case"confirm":A.value="已扫码";break;case"timeout":A.value="二维码已过期";break;default:A.value=""}}else d.warning(a.msg||"二维码状态请求错误")}).catch(e=>d.error(e))},J=()=>{clearInterval(L.value),L.value=0};return v(()=>{W()}),(n,i)=>{const d=l,c=t,o=a,u=s,v=r;return m(),h(_,null,[f(u,null,{header:g(()=>[p("div",q,[i[1]||(i[1]=p("span",null,"账号设置",-1)),f(d,{title:"未登录账号无法获取到弹幕用户昵称等信息，如有需要可添加一个小号",type:"warning",closable:!1})])]),default:g(()=>[p("div",D,[f(w(e),{type:"primary",onClick:O},{default:g(()=>[...i[2]||(i[2]=[y("新增",-1)])]),_:1})]),p("div",I,[f(o,null,{default:g(({width:e,height:a})=>[f(c,{columns:Q,data:E.value,width:e,height:a,fixed:""},null,8,["data","width","height"])]),_:1})])]),_:1}),f(v,{modelValue:j.value,"onUpdate:modelValue":i[0]||(i[0]=e=>j.value=e),title:"新增",width:"720",onClose:J,"destroy-on-close":""},{default:g(()=>[p("div",R,[p("img",{src:U.value,alt:"qrcode",class:"avatar",referrerpolicy:"no-referrer"},null,8,T),A.value.length>0?(m(),h("div",V,C(A.value),1)):b("",!0)])]),_:1},8,["modelValue"])],64)}}}),[["__scopeId","data-v-512e28c3"]]);export{K as default};
