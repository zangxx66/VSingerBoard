import{w as e,x as a,y as l,A as i,t,p as r,B as n,C as s,D as d,F as o,G as c,r as u,g as p,a as v,n as w}from"./vendor-element-plus-qW3C2DUX.js";import{o as m,r as f,ap as _,Z as g,L as h,q as b,t as y,U as x,K as k,u as V,R as j,M as C,P as T,S as D,bF as R,bA as q,T as B}from"./vendor-libs-DrwAYO3L.js";import{a as I}from"./index-C5BYMrVs.js";import"./vendor-exceljs-BzIpynsW.js";import"./vendor-vue-Bh1BfAe7.js";const K={class:"card-header"},O={class:"mb-4 flex items-center"},S={style:{height:"300px"}},U={class:"avatar-image-container"},A=["src"],F={key:0,class:"code-bage"},J=I(m({__name:"biliTab",setup(m){const I=f(),J=f(!1),N=f(!1),E=f(!1),G=f(0),L=f(""),M=f(""),P=f(Array()),Z=_({id:0,room_id:0,modal_level:0,user_level:0,sing_prefix:"点歌",sing_cd:0}),z=[{key:"uid",dataKey:"uid",title:"uid",width:100,cellRenderer:({cellData:e})=>x(u,null,{default:()=>[e,j(" ")]})},{key:"uname",dataKey:"uname",title:"昵称",width:250,cellRenderer:({cellData:e})=>x(u,null,{default:()=>[e,j(" ")]})},{key:"enable",dataKey:"enable",title:"是否启用",width:150,cellRenderer:({rowData:e})=>x(p,{modelValue:e.enable,"inline-prompt":!0,style:"--el-switch-off-color: #ff4949",activeText:"启用",inactiveText:"禁用",onChange:a=>{e.enable=a,Q(a,e.id)}},{default:()=>[" "]})},{key:"operations",title:"操作",width:100,cellRenderer:({rowData:e})=>x(B,null,[x(t,{type:"primary",icon:R,loading:N.value,onClick:a=>Y(e.id)},{default:()=>[j("刷新")]}),x(t,{type:"danger",icon:q,onClick:a=>X(e.id)},{default:()=>[j("删除")]})])}],H=()=>{E.value=!0,window.pywebview.api.get_bili_config().then(e=>{if(0!=e.code)v.warning(e.msg);else if(e.data){const a=JSON.parse(e.data);Object.assign(Z,a)}return window.pywebview.api.get_bili_credential_list()}).then(e=>{0!=e.code?v.warning(e.msg):P.value=JSON.parse(e.data),E.value=!1}).catch(e=>{v.error(e),E.value=!1})},Q=(e,a)=>{P.value.forEach((l,i,t)=>{l.id!=a&&(l.enable=!e)})},W=()=>{window.pywebview.api.get_bili_credential_code().then(e=>{0==e.code?(L.value=e.data,G.value=setInterval($,1e3),J.value=!0):v.warning(e.msg)}).catch(e=>v.error(e))},X=e=>{w.confirm("是否删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>window.pywebview.api.delete_bili_credential(e)).then(a=>{if(0!=a.code)v.warning(a.msg);else{v.success(a.msg);const l=P.value.filter(a=>a.id!=e);P.value=l}}).catch(e=>{"string"==typeof e&&"cancel"==e||v.error(e)})},Y=e=>{N.value=!0,window.pywebview.api.refresh_bili_credential(e).then(e=>{0!=e.code?v.warning(e.msg):v.success("success"),N.value=!1}).catch(e=>{v.error(e),N.value=!1})},$=()=>{window.pywebview.api.check_qr_code().then(e=>{if(0==e.code){if("success"==e.msg&&(clearInterval(G.value),G.value=0,M.value="",v.success("登录成功"),window.pywebview.api.get_bili_credential_list().then(e=>{0!=e.code?v.warning(e.msg):P.value=JSON.parse(e.data)}),J.value=!1),"qr_state"==e.msg)switch(e.data){case"confirm":M.value="未确认登录";break;case"timeout":M.value="二维码已过期";break;default:M.value=""}}else v.warning(e.msg||"二维码状态请求错误")}).catch(e=>v.error(e))},ee=()=>{clearInterval(G.value),G.value=0};return g(()=>{H()}),(u,p)=>{const w=i,m=l,f=a,_=r,g=n,R=o,q=d,B=s,N=c,G=e;return h((y(),b("div",null,[x(_,null,{header:k(()=>[...p[4]||(p[4]=[C("div",{class:"card-header"},[C("span",null,"基础设置")],-1)])]),default:k(()=>[x(f,{model:Z,ref_key:"refForm",ref:I,"label-width":"auto"},{default:k(()=>[x(m,{label:"房间号",prop:"room_id"},{default:k(()=>[x(w,{modelValue:Z.room_id,"onUpdate:modelValue":p[0]||(p[0]=e=>Z.room_id=e),placeholder:"B站直播间号",type:"text",min:"1"},null,8,["modelValue"])]),_:1}),x(m,{label:"点歌指令",prop:"sing_prefix"},{default:k(()=>[x(w,{modelValue:Z.sing_prefix,"onUpdate:modelValue":p[1]||(p[1]=e=>Z.sing_prefix=e),placeholder:"点歌指令",type:"text"},null,8,["modelValue"])]),_:1}),x(m,null,{default:k(()=>[x(V(t),{type:"primary",onClick:p[2]||(p[2]=e=>{window.pywebview.api.add_or_update_bili_config(Z).then(e=>{0!=e.code?v.warning(e.msg):(window.pywebview.api.restart_bilibili_ws(),v.success(e.msg),H())}).catch(e=>v.error(e))})},{default:k(()=>[...p[5]||(p[5]=[j("保存",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),x(g),x(_,null,{header:k(()=>[C("div",K,[p[6]||(p[6]=C("span",null,"账号设置",-1)),x(R,{title:"未登录账号无法获取到弹幕用户昵称等信息，如有需要可添加一个小号",type:"warning",closable:!1})])]),default:k(()=>[C("div",O,[x(V(t),{type:"primary",onClick:W},{default:k(()=>[...p[7]||(p[7]=[j("新增",-1)])]),_:1})]),C("div",S,[x(B,null,{default:k(({width:e,height:a})=>[x(q,{columns:z,data:P.value,width:e,height:a,fixed:""},null,8,["data","width","height"])]),_:1})])]),_:1}),x(N,{modelValue:J.value,"onUpdate:modelValue":p[3]||(p[3]=e=>J.value=e),title:"新增",width:"720",onClose:ee,"destroy-on-close":""},{default:k(()=>[C("div",U,[C("img",{src:L.value,alt:"qrcode",class:"avatar",referrerpolicy:"no-referrer"},null,8,A),M.value.length>0?(y(),b("div",F,D(M.value),1)):T("",!0)])]),_:1},8,["modelValue"])])),[[G,E.value]])}}}),[["__scopeId","data-v-738f6bf4"]]);export{J as default};
