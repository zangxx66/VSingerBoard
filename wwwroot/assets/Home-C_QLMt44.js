const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/platformStatus-DaAY6y_D.js","assets/vendor-element-plus-J1ABhGI2.js","assets/vendor-libs-BJ1SQKxe.js","assets/vendor-exceljs-BzIpynsW.js","assets/vendor-libs-CtmmCz1m.css","assets/vendor-element-plus-DYTGbi7e.css","assets/_plugin-vue_export-helper-BCo6x5W8.js","assets/platformStatus-D3I3ycmA.css","assets/addSingDialog-kmT_qZps.js","assets/danmaku-CaxirQ34.js","assets/vendor-vue-aS4A03Y7.js","assets/fansMedal-D0KOGJVh.js","assets/fansMedal-BqDEV9G7.css"])))=>i.map(i=>d[i]);
import{a as e,g as a,_ as l}from"./index-PVAVDtve.js";import{a as s,k as t,l as i,m as o,n,d as r,o as d,p as u,E as c,q as m}from"./vendor-element-plus-J1ABhGI2.js";import{q as _,r as p,ab as f,c as v,$ as g,_ as h,K as b,v as y,bH as w,L as k,aR as j,V as L,M as x,t as C,U as R,aT as S,O as T,Q as D,u as E,bI as I,S as O,T as H,bJ as M,bK as $,bL as B,bM as U,bA as q,a3 as A}from"./vendor-libs-BJ1SQKxe.js";import{a as V}from"./tool-Dmzci1qF.js";import{e as P}from"./vendor-exceljs-BzIpynsW.js";import{u as W}from"./interval-CRvFp0eB.js";import{u as J}from"./danmaku-CaxirQ34.js";import{_ as K}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./vendor-vue-aS4A03Y7.js";const N={class:"card-header"},Q={class:"infinite-list-item"},z=["src","alt"],F={class:"card-footer"},G={class:"card-footer-right"},X=K(_({__name:"Home",setup(_){const K=I(()=>l(()=>import("./platformStatus-DaAY6y_D.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),X=I(()=>l(()=>import("./addSingDialog-kmT_qZps.js"),__vite__mapDeps([8,1,2,3,4,5,9,10]))),Y=I(()=>l(()=>import("./fansMedal-D0KOGJVh.js"),__vite__mapDeps([11,2,3,4,6,12]))),Z=p(),ee=f({douyin_romm_id:0,bilibili_room_id:0,douyin_ws_status:-1,bilibili_ws_status:-1}),ae=J(),le=W(),se=p(null),te=async()=>{const e=await window.pywebview.api.get_live_config();Object.assign(ee,e)},ie=()=>{},oe=()=>{m.confirm("是否清空点歌列表","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{ae.clearDanmakuList()}).catch(e=>{"string"==typeof e&&"cancel"==e||c.error(e)})},ne=()=>{(async(e,a,l)=>{const s=new P.Workbook,t=s.addWorksheet("Sheet1");t.columns=e,t.addRows(a);const i=await s.xlsx.writeBuffer(),o=new Blob([i],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),n=window.URL.createObjectURL(o),r=document.createElement("a");r.href=n,r.download=l,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(n)})([{header:"日期",key:"date",width:50},{header:"昵称",key:"uname",width:50},{header:"歌名",key:"song",width:50},{header:"平台",key:"source",width:50}],ue.value.map(a=>({date:e(a.send_time),uname:a.uname,song:a.msg,source:"bilibili"==a.source?"B站":"抖音"})),`点歌列表_${a()}`)},re=async()=>{const e=await window.pywebview.api.is_bundle()?8e3:5173,a=document.createElement("a");a.href=`http://127.0.0.1:${e}/danmaku`,a.target="_blank",a.click(),a.remove()},de=()=>{Z.value&&Z.value.openDialog()},ue=v(()=>ae.getDanmakuList());return g(ue,async()=>{await A(),se.value&&se.value.scrollTo({behavior:"smooth",top:se.value.scrollHeight})}),h(()=>{const e=window.innerHeight-100,a=document.querySelector(".chat-main");a.style.height=`${e}px`,a.style.overflow="hidden";const l=.7*e;document.querySelector(".infinite-list").style.height=`${l}px`,w("ws://127.0.0.1:8080",{autoReconnect:!0,autoClose:!0,heartbeat:{message:"heartbeat",interval:5e3,pongTimeout:1e4},onMessage:(e,a)=>{if(!a.data.startsWith("Echo")){const e=JSON.parse(a.data),l=e.filter(e=>"douyin"==e.source),s=e.filter(e=>"bilibili"==e.source),t=[...ue.value,...V(l,"douyin"),...V(s,"bilibili")];ae.setDanmakuList(t)}}}),le.addInterval("get_live_config",te,1e3)}),(e,a)=>{const l=j("link-icon"),m=j("fans-club"),_=n,p=o,f=r,v=u,g=i,h=t,w=s,I=d;return y(),b(w,{class:"chat-container"},{default:k(()=>[L(h,{class:"chat-main"},{default:k(()=>[L(g,{class:"chat-card"},{header:k(()=>[T("div",N,[T("span",null,[a[0]||(a[0]=O(" 点歌列表 ",-1)),L(l,{style:{cursor:"pointer"},onClick:re})])])]),footer:k(()=>[T("div",F,[L(v,{type:"primary",onClick:de},{default:k(()=>[a[1]||(a[1]=O(" 手动点歌 ",-1)),L(f,null,{default:k(()=>[L(E($))]),_:1})]),_:1}),L(v,{type:"danger",disabled:0==ue.value.length,onClick:oe},{default:k(()=>[a[2]||(a[2]=O(" 清空点歌列表 ",-1)),L(f,{class:"el-icon--right"},{default:k(()=>[L(E(B))]),_:1})]),_:1},8,["disabled"]),L(v,{type:"success",disabled:0==ue.value.length,onClick:ne},{default:k(()=>[a[3]||(a[3]=O(" 导出点歌列表 ",-1)),L(f,{class:"el-icon--right"},{default:k(()=>[L(E(U))]),_:1})]),_:1},8,["disabled"]),T("div",G,[ee.douyin_romm_id>0?(y(),b(E(K),{key:0,platform:"douyin",roomId:ee.douyin_romm_id,wsStatus:ee.douyin_ws_status},null,8,["roomId","wsStatus"])):D("",!0),ee.bilibili_room_id>0?(y(),b(E(K),{key:1,platform:"bilibili",roomId:ee.bilibili_room_id,wsStatus:ee.bilibili_ws_status},null,8,["roomId","wsStatus"])):D("",!0)])])]),default:k(()=>[x((y(),C("div",{class:"infinite-list",ref_key:"infiniteList",ref:se},[(y(!0),C(R,null,S(ue.value,e=>(y(),C("div",Q,[T("img",{src:`/assets/images/${e.source}.png`,class:"source-img",alt:e.source,width:"24"},null,8,z),L(p,{placement:"bottom"},{content:k(()=>[T("span",null,"点击复制歌名："+H(e.msg),1)]),default:k(()=>[L(_,{tag:"span",class:"chat-tag",onClick:a=>(e=>{const{copy:a}=q({source:e});a(e),c.success("拷贝成功")})(e.msg)},{default:k(()=>[e.medal_level>0?(y(),C(R,{key:0},["bilibili"==e.source?(y(),b(E(Y),{key:0,medal_name:e.medal_name,medal_level:e.medal_level,guard_level:e.guard_level},null,8,["medal_name","medal_level","guard_level"])):D("",!0),"douyin"==e.source?(y(),b(m,{key:1,medal_name:e.medal_name,medal_level:e.medal_level,guard_level:e.guard_level},null,8,["medal_name","medal_level","guard_level"])):D("",!0)],64)):D("",!0),null!=e.html&&e.html.length>0?(y(),C(R,{key:1},[O(H(e.uname)+"； ",1),L(_,{innerHTML:e.html,style:{display:"flex"}},null,8,["innerHTML"])],64)):(y(),C(R,{key:2},[O(H(e.uname)+"： "+H(e.msg),1)],64))]),_:2},1032,["onClick"])]),_:2},1024),L(p,{placement:"bottom"},{content:k(()=>[T("span",null,"移除点歌："+H(e.msg),1)]),default:k(()=>[L(_,{tag:"span",class:"chat-close",onClick:a=>{return l=e,void ae.removeDanmakuList(l);var l}},{default:k(()=>[L(f,null,{default:k(()=>[L(E(M))]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]))),256))])),[[I,ie]])]),_:1}),L(E(X),{ref_key:"singDialogRef",ref:Z},null,512)]),_:1})]),_:1})}}}),[["__scopeId","data-v-26131913"]]);export{X as default};
