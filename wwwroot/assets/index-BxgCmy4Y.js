import{t as e,i as a,j as l,G as t,H as s,I as i,c as n,h as d,E as r,J as o,d as c,e as u,b as g,n as p,s as m,o as y,p as h,K as _,L as f,q as v,M as w,N as k,v as b,C as x,D as C,F as V,O as j}from"./vendor-element-plus-ChNPy6BA.js";import{a as L,r as P}from"./index-BmqyJb8x.js";import"./vendor-exceljs-C-8i3j8b.js";import{o as S,r as U,Y as D,A as z,t as K,u as R,f as B,B as O,J as E,E as I,G as A,bg as $,c as G,M as H,y as J,C as M,I as T}from"./vendor-libs-Crij45JJ.js";import{i as q,e as F}from"./excel-CH2sLU4d.js";import"./vendor-vue-SbnYag36.js";const N=S({__name:"addPlaylistDialog",emits:["submit"],setup(o,{expose:c,emit:u}){const g=u,p=U(!1),m=U(!1),y=D({id:0,song_name:"",singer:"",is_sc:!1,sc_price:0,language:"",tag:"",create_time:0}),h=()=>{p.value=!1,y.id=0,y.song_name="",y.singer="",y.is_sc=!1,y.sc_price=0,y.language="",y.tag=""};return c({openDialog:e=>{e&&Object.assign(y,e),p.value=!0}}),(o,c)=>{const u=l,_=a,f=s,v=t,w=i,k=n,b=d,x=e;return K(),z(x,{modelValue:R(p),"onUpdate:modelValue":c[8]||(c[8]=e=>B(p)?p.value=e:null),title:"新增歌曲",width:"450","destroy-on-close":"","before-close":h},{default:O(()=>[E(b,{model:R(y),"label-width":"auto"},{default:O(()=>[E(_,{label:"歌名",prop:"song_name"},{default:O(()=>[E(u,{modelValue:R(y).song_name,"onUpdate:modelValue":c[0]||(c[0]=e=>R(y).song_name=e),type:"text"},null,8,["modelValue"])]),_:1}),E(_,{label:"歌手",prop:"singer"},{default:O(()=>[E(u,{modelValue:R(y).singer,"onUpdate:modelValue":c[1]||(c[1]=e=>R(y).singer=e),type:"text"},null,8,["modelValue"])]),_:1}),E(_,{label:"语种",prop:"language"},{default:O(()=>[E(u,{modelValue:R(y).language,"onUpdate:modelValue":c[2]||(c[2]=e=>R(y).language=e),type:"text"},null,8,["modelValue"])]),_:1}),E(_,{label:"标签",prop:"tag"},{default:O(()=>[E(u,{modelValue:R(y).tag,"onUpdate:modelValue":c[3]||(c[3]=e=>R(y).tag=e),type:"text"},null,8,["modelValue"])]),_:1}),E(_,{label:"是否SC歌曲",prop:"is_sc"},{default:O(()=>[E(v,{modelValue:R(y).is_sc,"onUpdate:modelValue":c[4]||(c[4]=e=>R(y).is_sc=e)},{default:O(()=>[E(f,{value:!0},{default:O(()=>[...c[9]||(c[9]=[A("是",-1)])]),_:1}),E(f,{value:!1},{default:O(()=>[...c[10]||(c[10]=[A("否",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),R(y).is_sc?(K(),z(_,{key:0,label:"SC价格",prop:"sc_price"},{default:O(()=>[E(w,{modelValue:R(y).sc_price,"onUpdate:modelValue":c[5]||(c[5]=e=>R(y).sc_price=e),min:30,controls:!1},null,8,["modelValue"])]),_:1})):I("",!0),E(_,null,{default:O(()=>[E(k,{loading:R(m),type:"primary",onClick:c[6]||(c[6]=e=>{y.song_name?y.singer?!y.is_sc||y.sc_price?(m.value=!0,y.create_time=L(),P.addOrUpdatePlaylist({data:y}).then(e=>{const a=e.data;if(0!=a.code)return r.warning(a.msg),void(m.value=!1);r.success(a.msg),y.id=a.data;const l={id:y.id,song_name:y.song_name,singer:y.singer,is_sc:y.is_sc,sc_price:y.sc_price,language:y.language,tag:y.tag,create_time:y.create_time};g("submit",l),m.value=!1,h()}).catch(e=>{r.error(e),m.value=!1})):r.warning("请输入SC价格"):r.warning("请输入歌手"):r.warning("请输入歌名")})},{default:O(()=>[...c[11]||(c[11]=[A("保存",-1)])]),_:1},8,["loading"]),E(k,{onClick:c[7]||(c[7]=e=>h())},{default:O(()=>[...c[12]||(c[12]=[A("取消",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),Y={style:{height:"40px",display:"flex"}},Q={class:"chat-infinite-list",ref:"playlistInfiniteList"},W={style:{display:"flex"}},X={style:{width:"50%"}},Z={style:{width:"50%","flex-direction":"row-reverse",display:"flex",gap:"10px"}},ee=S({__name:"index",setup(e){const{t:t}=o(),s=({value:e,intermediate:a=!1,ariaLabel:l,onChange:t})=>E(j,{onChange:t,modelValue:e,ariaLabel:l,indeterminate:a},null),i=U(!1),S=U(!1),B=U(!1),I=U(0),ee=U(Array()),ae=$("playlistDataCard"),le=$("playlistInfiniteList"),te=$("addPlaylistDialogRef"),se=D({keyword:"",page:1,size:20}),ie=[{header:"歌曲名",key:"song_name",width:50},{header:"歌手",key:"singer",width:50},{header:"语种",key:"language",width:25},{header:"标签",key:"tag",width:50},{header:"是否SC曲目",key:"is_sc",width:25},{header:"SC曲目价格",key:"sc_price",width:25}],ne=[{header:"歌曲名",key:"song_name",type:"string"},{header:"歌手",key:"singer",type:"string"},{header:"语种",key:"language",type:"string"},{header:"标签",key:"tag",type:"string"},{header:"是否SC曲目",key:"is_sc",type:"boolean"},{header:"SC曲目价格",key:"sc_price",type:"number"}],de=[{key:"selection",width:50,cellRenderer:({rowData:e})=>E(T,null,[E(s,{value:e.checked,ariaLabel:t("el.table.selectRowLabel"),onChange:a=>e.checked=a},null)]),headerCellRenderer:()=>{const e=R(ee),a=e.every(e=>e.checked),l=e.some(e=>e.checked);return E(T,null,[E(s,{value:a,intermediate:l&&!a,ariaLabel:t("el.table.selectAllLabel"),onChange:a=>ee.value=e.map(e=>(e.checked=Boolean(a),e))},null)])}},{key:"song_name",dataKey:"song_name",title:"歌名",width:200},{key:"singer",dataKey:"singer",title:"歌手",width:200},{key:"language",dataKey:"language",title:"语种",width:200},{key:"tag",dataKey:"tag",title:"标签",width:200},{key:"sc_price",dataKey:"sc_price",title:"SC曲目价格",width:200},{key:"operations",title:"操作",width:200,cellRenderer:({rowData:e})=>E(T,null,[E(n,{type:"success",icon:x,onClick:a=>re(e)},{default:()=>[A("编辑")]}),E(n,{type:"default",icon:C,onClick:a=>oe([e.id])},{default:()=>[A("删除")]})])}],re=e=>{te.value&&te.value.openDialog(e)},oe=e=>{V.confirm("是否删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>P.deletePlaylist({data:e})).then(a=>{const l=a.data;if(0!=l.code)return void r.warning(l.msg);r.success(l.msg);const t=new Set(e);ee.value=ee.value.filter(e=>!t.has(e.id))}).catch(e=>{"string"==typeof e&&"cancel"==e||r.error(e)})},ce=e=>{const a=ee.value.find(a=>a.id==e.id);a?Object.assign(a,e):ee.value.unshift(e)},ue=async(e,a)=>{if(B.value=!0,!e)return void(B.value=!1);const l=e.name.split(".");if("xlsx"!=l[l.length-1])return r.warning("请上传xlsx格式的表格"),void(B.value=!1);const t=await(e.raw?.arrayBuffer()),s=await q(ne,t);s.forEach(e=>{e.id=0,e.create_time=L()}),P.importPlaylist({data:s}).then(e=>{const a=e.data;0!=a.code?r.warning(a.msg):r.success(a.msg),B.value=!1,me()}).catch(e=>{r.error(e),B.value=!1})},ge=()=>{const e={};Object.assign(e,se),e.page=1,e.size=I.value,S.value=!0,P.getPlaylistList(e).then(e=>{const a=e.data;if(0!=a.code)return r.warning(a.msg),void(S.value=!1);const l=a.data.rows.map(e=>({song_name:e.song_name,singer:e.singer,is_sc:e.is_sc?"是":"否",sc_price:e.sc_price,language:e.language,tag:e.tag})),t=`歌单_${L()}`;F(ie,l,t),S.value=!1}).catch(e=>{r.error(e),S.value=!1})},pe=()=>{i.value=!0,P.getPlaylistList(se).then(e=>{const a=e.data;if(0!=a.code)return r.warning(a.msg),void(i.value=!1);I.value=a.data.total;const l=a.data.rows;l.forEach(e=>e.checked=!1),ee.value=l,i.value=!1}).catch(e=>{r.error(e),i.value=!1})},me=()=>{se.page=1,pe()},ye=G(()=>ee.value.filter(e=>e.checked).length>0);return H(()=>{const e=.9*window.innerHeight;ae.value?.$el.style.setProperty("overflow","hidden");const a=.6*e;le.value?.style.setProperty("height",`${a}px`),pe()}),(e,t)=>{const s=l,r=a,o=p,x=d,C=g,V=y,j=k,L=w,P=h,U=_,D=N,$=u,G=c,H=b;return K(),z(G,{class:"playlist-container"},{default:O(()=>[E($,{class:"playlist-main"},{default:O(()=>[E(C,{class:"playlist-card"},{header:O(()=>[...t[5]||(t[5]=[J("div",{class:"card-header"},[J("span",null,"查询")],-1)])]),default:O(()=>[E(x,{model:R(se),"label-width":"auto",inline:"",class:"inline-form"},{default:O(()=>[E(r,{label:"关键词",prop:"keyword"},{default:O(()=>[E(s,{modelValue:R(se).keyword,"onUpdate:modelValue":t[0]||(t[0]=e=>R(se).keyword=e),type:"text"},null,8,["modelValue"])]),_:1}),E(r,null,{default:O(()=>[E(R(n),{type:"primary",onClick:me},{default:O(()=>[E(o,{class:"el-icon--left"},{default:O(()=>[E(R(m))]),_:1}),t[6]||(t[6]=A(" 搜索 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),E(V),J("div",Y,[E(R(n),{type:"primary",onClick:t[1]||(t[1]=e=>re())},{default:O(()=>[...t[7]||(t[7]=[A("新增歌曲",-1)])]),_:1}),E(R(n),{type:"danger",onClick:t[2]||(t[2]=e=>(()=>{const e=ee.value.filter(e=>e.checked).map(e=>e.id);oe(e)})()),disabled:!R(ye)},{default:O(()=>[...t[8]||(t[8]=[A("全部删除",-1)])]),_:1},8,["disabled"])]),M((K(),z(C,{class:"playlist-data-card",ref:"playlistDataCard"},{default:O(()=>[J("div",Q,[E(L,null,{default:O(({width:e,height:a})=>[E(j,{columns:de,data:R(ee),width:e,height:a,fixed:""},null,8,["data","width","height"])]),_:1})],512)]),footer:O(()=>[J("div",W,[J("div",X,[E(P,{background:"",layout:"prev, pager, next",total:R(I),"page-size":R(se).size,"onUpdate:pageSize":t[3]||(t[3]=e=>R(se).size=e),"current-page":R(se).page,"onUpdate:currentPage":t[4]||(t[4]=e=>R(se).page=e),onChange:pe},null,8,["total","page-size","current-page"])]),J("div",Z,[E(U,{action:"#","auto-upload":!1,"show-file-list":!1,"on-change":ue,accept:".xlsx"},{trigger:O(()=>[E(R(n),{type:"success",loading:R(B)},{default:O(()=>[t[9]||(t[9]=A(" 导入歌单 ",-1)),E(o,{class:"el-icon--right"},{default:O(()=>[E(R(f))]),_:1})]),_:1},8,["loading"])]),_:1}),E(R(n),{onClick:ge,loading:R(S)},{default:O(()=>[t[10]||(t[10]=A(" 导出歌单 ",-1)),E(o,{class:"el-icon--right"},{default:O(()=>[E(R(v))]),_:1})]),_:1},8,["loading"])])])]),_:1})),[[H,R(i)]]),E(D,{onSubmit:ce,ref:"addPlaylistDialogRef"},null,512)]),_:1})]),_:1})}}});export{ee as default};
