import{i as D,n as k,a as F,t as V,g as M,d as R,r as N,b as U,o as j,c as q,e as $,f as g,w as _,h as P,E as T,j as z,k as m,l as K,m as W,p as b,F as X,q as Y,s as G,u as J,v as H,x as Q,y as Z,z as ee,A as I,_ as te}from"./index-BURHvijj.js";import{E as ne}from"./el-card-z_8omyjg.js";import{d as se,E as oe}from"./index-9NQJOfgh.js";import"./toNumber-9gyJ14Iw.js";var ie="Expected a function";function L(e,n,t){var s=!0,c=!0;if(typeof e!="function")throw new TypeError(ie);return D(t)&&(s="leading"in t?!!t.leading:s,c="trailing"in t?!!t.trailing:c),se(e,n,{leading:s,maxWait:n,trailing:c})}const O=e=>{let n=0,t=e;for(;t;)n+=t.offsetTop,t=t.offsetParent;return n},ae=(e,n)=>Math.abs(O(e)-O(n)),r="ElInfiniteScroll",ce=50,le=200,re=0,de={delay:{type:Number,default:le},distance:{type:Number,default:re},disabled:{type:Boolean,default:!1},immediate:{type:Boolean,default:!0}},x=(e,n)=>Object.entries(de).reduce((t,[s,c])=>{var u,l;const{type:f,default:d}=c,o=e.getAttribute(`infinite-scroll-${s}`);let i=(l=(u=n[o])!=null?u:o)!=null?l:d;return i=i==="false"?!1:i,i=f(i),t[s]=Number.isNaN(i)?d:i,t},{}),A=e=>{const{observer:n}=e[r];n&&(n.disconnect(),delete e[r].observer)},ue=(e,n)=>{const{container:t,containerEl:s,instance:c,observer:u,lastScrollTop:l}=e[r],{disabled:f,distance:d}=x(e,c),{clientHeight:o,scrollHeight:i,scrollTop:a}=s,h=a-l;if(e[r].lastScrollTop=a,u||f||h<0)return;let v=!1;if(t===e)v=i-(o+a)<=d;else{const{clientTop:w,scrollHeight:E}=e,y=ae(e,s);v=a+o>=y+w+E-d}v&&n.call(c)};function C(e,n){const{containerEl:t,instance:s}=e[r],{disabled:c}=x(e,s);c||t.clientHeight===0||(t.scrollHeight<=t.clientHeight?n.call(s):A(e))}const fe={async mounted(e,n){const{instance:t,value:s}=n;F(s)||V(r,"'v-infinite-scroll' binding value must be a function"),await k();const{delay:c,immediate:u}=x(e,t),l=M(e,!0),f=l===window?document.documentElement:l,d=L(ue.bind(null,e,s),c);if(l){if(e[r]={instance:t,container:l,containerEl:f,delay:c,cb:s,onScroll:d,lastScrollTop:f.scrollTop},u){const o=new MutationObserver(L(C.bind(null,e,s),ce));e[r].observer=o,o.observe(e,{childList:!0,subtree:!0}),C(e,s)}l.addEventListener("scroll",d)}},unmounted(e){if(!e[r])return;const{container:n,onScroll:t}=e[r];n?.removeEventListener("scroll",t),A(e)},async updated(e){if(!e[r])await k();else{const{containerEl:n,cb:t,observer:s}=e[r];n.clientHeight&&s&&C(e,t)}}},S=fe;S.install=e=>{e.directive("InfiniteScroll",S)};const _e=S,pe="/assets/images/bilibili.png",ge="/assets/images/douyin.png",me={class:"infinite-list"},ve={class:"infinite-list-item"},be={key:0,src:pe,class:"source-img",alt:"bilibili",width:"24"},he={key:1,src:ge,class:"source-img",alt:"douyin",width:"24"},we=R({__name:"Home",setup(e){const n=N(Array()),t=U({id:0,room_id:0,modal_level:0,user_level:0,sing_prefix:"点歌",sing_cd:0}),s=N(0),c=()=>{P.getBiliConfig({}).then(o=>{const i=o.data;if(i.code!=0)T.warning(i.msg);else{if(!i.data.data)return;const a=i.data.data;t.id=a.id,t.room_id=a.room_id,t.modal_level=a.modal_level,t.user_level=a.user_level,t.sing_prefix=a.sing_prefix,t.sing_cd=a.sing_cd,u()}}).catch(o=>T.error(o))},u=()=>{s.value=setInterval(async()=>{const o=await window.pywebview.api.get_danmu();o&&n.value.push(...o);const i=await window.pywebview.api.get_dy_danmu();i&&n.value.push(...i)},1e3)},l=()=>console.log("load"),f=o=>{window.pywebview.api.copy_to_clipboard(o),T.success("拷贝成功")},d=o=>{const i=n.value.filter(a=>a.uid!=o.uid&&a.source!=o.source);n.value=i};return j(()=>{const o=document.querySelector(".chat-main");o.style.height=window.innerHeight-100+"px",c()}),q(()=>{clearInterval(s.value),s.value=0}),(o,i)=>{const a=oe,h=Q,v=ne,w=K,E=z,y=_e;return g(),$(E,{class:"chat-container"},{default:_(()=>[m(w,{class:"chat-main"},{default:_(()=>[m(v,{class:"chat-card"},{header:_(()=>[...i[0]||(i[0]=[I("div",{class:"card-header"},[I("span",null,"点歌列表")],-1)])]),default:_(()=>[W((g(),b("div",me,[(g(!0),b(X,null,Y(n.value,p=>(g(),b("div",ve,[p.source=="bilibili"?(g(),b("img",be)):p.source=="douyin"?(g(),b("img",he)):G("",!0),m(a,{tag:"span",class:"chat-tag",onClick:B=>f(p.msg)},{default:_(()=>[J(H(p.uname)+"："+H(p.msg),1)]),_:2},1032,["onClick"]),m(a,{tag:"span",class:"chat-close",onClick:B=>d(p)},{default:_(()=>[m(h,null,{default:_(()=>[m(Z(ee))]),_:1})]),_:1},8,["onClick"])]))),256))])),[[y,l]])]),_:1})]),_:1})]),_:1})}}}),Se=te(we,[["__scopeId","data-v-d3d0d9ed"]]);export{Se as default};
