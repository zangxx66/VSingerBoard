import{q as e,H as a,I as t,J as l,m as s,B as n,o as r,f as i,a as d,r as c}from"./vendor-element-plus-CAbZ6VM0.js";import{q as o,r as u,_ as v,t as h,v as m,V as f,L as g,O as p,u as w,S as y,Q as b,T as C,U as k,bU as x,bN as q}from"./vendor-libs-DUytVOgY.js";import{r as B}from"./request-C2d-pRYf.js";import"./vendor-exceljs-BzIpynsW.js";const _={class:"card-header"},j={class:"mb-4 flex items-center"},I={style:{height:"300px","padding-top":"1rem"}},T={class:"qcode-image-container"},V=["src"],D={key:0,class:"qcode-bage"},R=o({__name:"biliCredential",setup(o){const R=u(!1),U=u(!1),K=u(0),L=u(""),Q=u(""),W=u(Array()),A=[{key:"uid",dataKey:"uid",title:"uid",width:200,cellRenderer:({cellData:e})=>f(r,null,{default:()=>[e,y(" ")]})},{key:"uname",dataKey:"uname",title:"昵称",width:300,cellRenderer:({cellData:e})=>f(r,null,{default:()=>[e,y(" ")]})},{key:"enable",dataKey:"enable",title:"是否启用",width:150,cellRenderer:({rowData:e})=>f(i,{modelValue:e.enable,"inline-prompt":!0,style:"--el-switch-off-color: #ff4949; --el-switch-on-color: #13ce66",activeText:"启用",inactiveText:"禁用",onChange:a=>{e.enable=a,H(a,e.id)}},{default:()=>[" "]})},{key:"operations",title:"操作",width:200,maxWidth:1020,minWidth:100,cellRenderer:({rowData:a})=>f(k,null,[f(e,{type:"success",icon:x,loading:U.value,onClick:e=>S(a.id)},{default:()=>[y("刷新凭证")]}),f(e,{type:"danger",icon:q,onClick:e=>O(a.id)},{default:()=>[y("删除")]})])}],E=()=>{B.getBiliCredntialList({}).then(e=>{const a=e.data;0!=a.code?d.warning(a.msg):W.value=a.data.rows}).catch(e=>{d.error(e)})},H=(e,a)=>{B.UpdateBiliCredential({data:{id:a,enable:e}}).then(t=>{const l=t.data;if(0!=l.code)return d.warning(l.msg||"设置失败"),void J(a,!e);d.success(l.msg||"设置成功"),W.value.forEach((t,l,s)=>{t.id!=a&&(t.enable=!e)})}).catch(t=>{d.error(t),J(a,!e)})},J=(e,a)=>{const t=W.value.findIndex(a=>a.id===e);-1!==t&&(W.value[t].enable=a)},N=()=>{B.getBiliCredentialCode({}).then(e=>{const a=e.data;0==a.code?(L.value=a.data.data,K.value=setInterval(z,1e3),R.value=!0):d.warning(a.msg)}).catch(e=>d.error(e))},O=e=>{c.confirm("是否删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>B.deleteBiliCredential({id:e})).then(a=>{const t=a.data;if(0!=t.code)d.warning(t.msg);else{d.success(t.msg);const a=W.value.filter(a=>a.id!=e);W.value=a}}).catch(e=>{"string"==typeof e&&"cancel"==e||d.error(e)})},S=e=>{U.value=!0,B.refreshBiliCredential({id:e}).then(e=>{const a=e.data;0!=a.code?d.warning(a.msg):d.success("success"),U.value=!1}).catch(e=>{d.error(e),U.value=!1})},z=()=>{B.checkQrCode({}).then(e=>{const a=e.data;if(0==a.code){if("success"==a.msg&&(clearInterval(K.value),K.value=0,Q.value="",d.success("登录成功"),E(),R.value=!1),"qr_state"==a.msg)switch(a.data.data){case"confirm":Q.value="已扫码";break;case"timeout":Q.value="二维码已过期";break;default:Q.value=""}}else d.warning(a.msg||"二维码状态请求错误")}).catch(e=>d.error(e))},F=()=>{clearInterval(K.value),K.value=0};return v(()=>{E()}),(r,i)=>{const d=l,c=t,o=a,u=s,v=n;return m(),h(k,null,[f(u,null,{header:g(()=>[p("div",_,[i[1]||(i[1]=p("span",null,"账号设置",-1)),f(d,{title:"未登录账号无法获取到弹幕用户昵称等信息，如有需要可添加一个小号",type:"warning",closable:!1})])]),default:g(()=>[p("div",j,[f(w(e),{type:"primary",onClick:N},{default:g(()=>[...i[2]||(i[2]=[y("新增",-1)])]),_:1})]),p("div",I,[f(o,null,{default:g(({width:e,height:a})=>[f(c,{columns:A,data:W.value,width:e,height:a,fixed:""},null,8,["data","width","height"])]),_:1})])]),_:1}),f(v,{modelValue:R.value,"onUpdate:modelValue":i[0]||(i[0]=e=>R.value=e),title:"新增",width:"720",onClose:F,"destroy-on-close":""},{default:g(()=>[p("div",T,[p("img",{src:L.value,alt:"qrcode",class:"qcode",referrerpolicy:"no-referrer"},null,8,V),Q.value.length>0?(m(),h("div",D,C(Q.value),1)):b("",!0)])]),_:1},8,["modelValue"])],64)}}});export{R as default};
