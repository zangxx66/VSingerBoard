import{b as e,l as a,w as l,x as s}from"./vendor-element-plus-BAdGi-BR.js";import{_ as n,a as i}from"./fansMedal-53R_GX_t.js";import{b as u}from"./index-d4Ui0gHI.js";import"./vendor-exceljs-C-8i3j8b.js";import{q as t,r as d,Z as m,Y as o,I as r,J as v,bN as c,T as _,K as f,t as p,S as y,ay as g,u as b,v as k,L as h,Q as j,R as x,O as T,a2 as L}from"./vendor-libs-B7kAgHVc.js";import"./vendor-vue-l4c-_Jld.js";const M={class:"danmaku-list-item"},O={class:"danmaku-sing"},w={class:"danmaku-uname"},H={class:"danmaku-fans"},J=t({__name:"Danmaku",setup(t){const J=d(Array()),N=d(null),R=()=>{};return m(J,async()=>{await L(),N.value&&N.value.scrollTo({behavior:"smooth",top:N.value.scrollHeight})}),o(()=>{document.title="点歌列表",c("ws://127.0.0.1:8080",{autoReconnect:!0,autoClose:!0,heartbeat:{message:"heartbeat",interval:5e3,pongTimeout:1e4},onMessage:(e,a)=>{const l=JSON.parse(a.data);if("echo"!=l.type)if("clear"==l.type)J.value=[];else if("remove"==l.type){const e=l.data,a=J.value.find(a=>a.uid==e.uid&&a.send_time==e.send_time);if(a){const e=J.value.indexOf(a);e>-1&&J.value.splice(e,1)}}else if("del"==l.type)l.data.forEach(e=>{let a;if(a=e.song_name?J.value.find(a=>a.uid==e.uid&&a.uname==e.uname&&a.msg==e.song_name):J.value.find(a=>a.uid==e.uid&&a.uname==e.uname),a){const e=J.value.indexOf(a);e>-1&&J.value.splice(e,1)}});else{const e=l.data,a=e.filter(e=>"douyin"==e.source),s=e.filter(e=>"bilibili"==e.source);J.value=[...J.value,...u(a,"douyin"),...u(s,"bilibili")]}}})}),(u,t)=>{const d=l,m=n,o=i,c=a,L=e,S=s;return k(),r(L,{class:"danmaku-container"},{default:v(()=>[_(c,null,{default:v(()=>[f((k(),p("div",{class:"danmaku-list",ref_key:"infiniteList",ref:N},[(k(!0),p(y,null,g(b(J),e=>(k(),p("div",M,[h("div",O,[null!=e.html&&e.html.length>0?(k(),r(d,{key:0,innerHTML:e.html,style:{display:"flex"}},null,8,["innerHTML"])):(k(),p(y,{key:1},[j(x(e.msg),1)],64))]),h("div",w,x(e.uname),1),h("div",H,[e.medal_level>0?(k(),p(y,{key:0},["bilibili"==e.source?(k(),r(m,{key:0,medal_name:e.medal_name,medal_level:e.medal_level,guard_level:e.guard_level},null,8,["medal_name","medal_level","guard_level"])):T("",!0),"douyin"==e.source?(k(),r(o,{key:1,medal_name:e.medal_name,medal_level:e.medal_level,guard_level:e.guard_level},null,8,["medal_name","medal_level","guard_level"])):T("",!0)],64)):T("",!0)])]))),256))])),[[S,R]])]),_:1})]),_:1})}}});export{J as default};
