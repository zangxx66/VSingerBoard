import{b as e,l as a,w as l,x as s}from"./vendor-element-plus-Bd9JbKVR.js";import{_ as t,a as n}from"./fansMedal-R1D7937B.js";import{b as i}from"./index-Bl6l-GlS.js";import"./vendor-exceljs-C-8i3j8b.js";import{q as d,r as m,Z as u,Y as r,I as o,J as v,bN as _,T as c,K as f,t as y,S as p,ay as g,u as b,v as k,L as h,Q as j,R as x,O as T,a2 as L}from"./vendor-libs-jc_y8n1R.js";import"./vendor-vue-k6REBtrB.js";const M={class:"danmaku-list-item"},w={class:"danmaku-sing"},H={class:"danmaku-uname"},J={class:"danmaku-fans"},N=d({__name:"Danmaku",setup(d){const N=m(Array()),O=m(null),R=()=>{};return u(N,async()=>{await L(),O.value&&O.value.scrollTo({behavior:"smooth",top:O.value.scrollHeight})}),r(()=>{document.title="点歌列表",_("ws://127.0.0.1:8080",{autoReconnect:!0,autoClose:!0,heartbeat:{message:'{"type":"echo","data":"heartbeat"}',interval:5e3,pongTimeout:1e4},onMessage:(e,a)=>{const l=JSON.parse(a.data);if("echo"!=l.type)if("clear"==l.type)N.value=[];else if("remove"==l.type)N.value=N.value.filter(e=>e.msg_id!=l.data);else if("del"==l.type){const e=l.data;N.value=N.value.filter(a=>!e.some(e=>e.msg_id===a.msg_id))}else if("add"==l.type){const e=l.data,a=e.filter(e=>"douyin"==e.source),s=e.filter(e=>"bilibili"==e.source);N.value=[...N.value,...i(a,"douyin"),...i(s,"bilibili")]}}})}),(i,d)=>{const m=l,u=t,r=n,_=a,L=e,S=s;return k(),o(L,{class:"danmaku-container"},{default:v(()=>[c(_,null,{default:v(()=>[f((k(),y("div",{class:"danmaku-list",ref_key:"infiniteList",ref:O},[(k(!0),y(p,null,g(b(N),e=>(k(),y("div",M,[h("div",w,[null!=e.html&&e.html.length>0?(k(),o(m,{key:0,innerHTML:e.html,style:{display:"flex"}},null,8,["innerHTML"])):(k(),y(p,{key:1},[j(x(e.msg),1)],64))]),h("div",H,x(e.uname),1),h("div",J,[e.medal_level>0?(k(),y(p,{key:0},["bilibili"==e.source?(k(),o(u,{key:0,medal_name:e.medal_name,medal_level:e.medal_level,guard_level:e.guard_level},null,8,["medal_name","medal_level","guard_level"])):T("",!0),"douyin"==e.source?(k(),o(r,{key:1,medal_name:e.medal_name,medal_level:e.medal_level,guard_level:e.guard_level},null,8,["medal_name","medal_level","guard_level"])):T("",!0)],64)):T("",!0)])]))),256))])),[[S,R]])]),_:1})]),_:1})}}});export{N as default};
