import{m as e,n as a,o as l,p as s,q as t,r as o,s as i,a as n,v as d,e as u,t as r,b as c,l as m,u as _,w as p,x as g,y as f}from"./vendor-element-plus-Bd9JbKVR.js";import{g as y,b,a as h,d as v}from"./index-Bl6l-GlS.js";import{e as w}from"./vendor-exceljs-C-8i3j8b.js";import{u as k}from"./danmaku-DPoJqm9q.js";import{q as C,r as L,aa as S,I as x,v as j,u as V,h as D,J as R,T,t as I,ay as U,S as A,Q as B,c as E,L as M,R as O,K as $,P as F,B as H,bL as q,bM as J,Z as N,Y as P,bN as Q,O as W,bO as K,bP as Y,bQ as Z,bR as z,bS as G,bT as X,a2 as ee}from"./vendor-libs-jc_y8n1R.js";import{_ as ae,a as le}from"./fansMedal-R1D7937B.js";import{_ as se}from"./linkIcon-BCNBZca-.js";import"./vendor-vue-k6REBtrB.js";const te=C({__name:"addSingDialog",setup(d,{expose:u}){const r=L(!1),c=k(),m=S({msg_id:0,uid:0,uname:"",msg:"",send_time:0,source:"douyin",medal_level:0,medal_name:"",guard_level:0}),_=[{key:"抖音",value:"douyin"},{key:"B站",value:"bilibili"}],p=()=>{m.uname="",m.msg="",m.source="douyin"};return u({openDialog:()=>{r.value=!0}}),(d,u)=>{const g=l,f=a,b=t,h=s,v=o,w=i,k=e;return j(),x(k,{modelValue:V(r),"onUpdate:modelValue":u[4]||(u[4]=e=>D(r)?r.value=e:null),title:"手动点歌",width:"720",onClose:p},{default:R(()=>[T(w,{model:V(m),"label-width":"auto"},{default:R(()=>[T(f,{label:"用户昵称",prop:"uname"},{default:R(()=>[T(g,{modelValue:V(m).uname,"onUpdate:modelValue":u[0]||(u[0]=e=>V(m).uname=e),placeholder:"用户昵称",type:"text"},null,8,["modelValue"])]),_:1}),T(f,{label:"点歌内容",prop:"msg"},{default:R(()=>[T(g,{modelValue:V(m).msg,"onUpdate:modelValue":u[1]||(u[1]=e=>V(m).msg=e),placeholder:"点歌内容",type:"text"},null,8,["modelValue"])]),_:1}),T(f,{label:"点歌平台",prop:"source"},{default:R(()=>[T(h,{modelValue:V(m).source,"onUpdate:modelValue":u[2]||(u[2]=e=>V(m).source=e),placeholder:"请选择点歌平台"},{default:R(()=>[(j(),I(A,null,U(_,e=>T(b,{label:e.key,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),T(f,null,{default:R(()=>[T(v,{type:"primary",onClick:u[3]||(u[3]=e=>{""!=m.msg?(m.msg_id=y(),m.send_time=y(),c.pushDanmakuList([{...m}]),r.value=!1):n.error("点歌内容不能为空")})},{default:R(()=>[...u[5]||(u[5]=[B("保存",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),oe={class:"platform-status-container"},ie=["src","alt"],ne=C({__name:"platformStatus",props:{platform:{},roomId:{},wsStatus:{}},setup(e){const a=e,l=L(!1),s=()=>{l.value=!0;try{"bilibili"==a.platform?window.pywebview.api.restart_bilibili_ws():window.pywebview.api.restart_douyin_ws(),n.success("刷新成功，请等待操作完成")}catch(e){n.error(e)}finally{setTimeout(()=>{l.value=!1},5e3)}},t={bilibili:new Map([[-1,{color:"#F56C6C",icon:H,message:"未配置或出现错误"}],[0,{color:"#E6A23C",icon:q,message:"初始化"}],[1,{color:"#E6A23C",icon:q,message:"连接建立中"}],[2,{color:"#67C23A",icon:J,message:"已连接"}],[3,{color:"#E6A23C",icon:q,message:"断开连接中"}],[4,{color:"#F56C6C",icon:H,message:"已断开"}],[5,{color:"#F56C6C",icon:H,message:"出现错误"}]]),douyin:new Map([[-1,{color:"#F56C6C",icon:H,message:"未配置或出现错误"}],[0,{color:"#E6A23C",icon:q,message:"未连接"}],[1,{color:"#67C23A",icon:J,message:"已连接"}],[2,{color:"#E6A23C",icon:q,message:"已断开"}],[3,{color:"#F56C6C",icon:H,message:"出现错误"}]])},i=E(()=>t[a.platform].get(a.wsStatus));return(a,t)=>{const n=u,c=o,m=r,_=d;return j(),I("div",oe,[M("img",{src:`/assets/images/${e.platform}.png`,class:"source-img",alt:e.platform,width:"24"},null,8,ie),B("："+O(e.roomId)+"   ",1),T(m,{placement:"top"},{content:R(()=>[M("span",null,"当前状态："+O(V(i).message)+"，如有异常点击重新连接",1)]),default:R(()=>[$((j(),x(c,{text:"",onClick:s},{default:R(()=>[T(n,{color:V(i).color,class:"status-img"},{default:R(()=>[(j(),x(F(V(i).icon)))]),_:1},8,["color"])]),_:1})),[[_,V(l)]])]),_:1})])}}}),de={class:"card-header"},ue={class:"chat-infinite-list-item"},re=["src","alt"],ce=["onClick"],me={class:"chat-close"},_e=["onClick"],pe={class:"chat-card-footer"},ge={class:"card-footer-right"},fe=C({__name:"Home",setup(e){const a=L(),l=S({douyin_romm_id:0,bilibili_room_id:0,douyin_ws_status:-1,bilibili_ws_status:-1}),s=k(),t=L(null);let i;const d=()=>{},C=()=>{f.confirm("是否清空点歌列表","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{s.clearDanmakuList(),i('{"type":"clear","data":""}')}).catch(e=>{"string"==typeof e&&"cancel"==e||n.error(e)})},D=()=>{(async(e,a,l)=>{const s=new w.Workbook,t=s.addWorksheet("Sheet1");t.columns=e,t.addRows(a);const o=await s.xlsx.writeBuffer(),i=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),n=window.URL.createObjectURL(i),d=document.createElement("a");d.href=n,d.download=l,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(n)})([{header:"日期",key:"date",width:50},{header:"昵称",key:"uname",width:50},{header:"歌名",key:"song",width:50},{header:"平台",key:"source",width:50}],q.value.map(e=>({date:v(e.send_time),uname:e.uname,song:e.msg,source:"bilibili"==e.source?"B站":"抖音"})),`点歌列表_${y()}`)},F=async()=>{const e=await window.pywebview.api.is_bundle()?8e3:5173,a=document.createElement("a");a.href=`http://127.0.0.1:${e}/danmaku`,a.target="_blank",a.click(),a.remove()},H=()=>{a.value&&a.value.openDialog()},q=E(()=>s.getDanmakuList());return N(q,async()=>{await ee(),t.value&&t.value.scrollTo({behavior:"smooth",top:t.value.scrollHeight})}),P(()=>{const e=.9*window.innerHeight;document.querySelector(".chat-main").style.overflow="hidden";const a=.8*e;document.querySelector(".chat-infinite-list").style.height=`${a}px`,(()=>{const{send:e}=Q("ws://127.0.0.1:8080",{autoReconnect:!0,autoClose:!0,heartbeat:{message:'{"type":"echo","data":"heartbeat"}',interval:5e3,pongTimeout:1e4},onMessage:(e,a)=>{const t=JSON.parse(a.data);if("echo"!=t.type)if("del"==t.type){const e=t.data,a=q.value.filter(a=>!e.some(e=>e.msg_id===a.msg_id));s.setDanmakuList(a)}else if("add"==t.type){const e=t.data,a=e.filter(e=>"douyin"==e.source),l=e.filter(e=>"bilibili"==e.source),o=[...q.value,...b(a,"douyin"),...b(l,"bilibili")];s.setDanmakuList(o)}else"live_config"==t.type?Object.assign(l,t.data):"bili_room_change"==t.type?l.bilibili_room_id=t.data:"bili_status_change"==t.type?l.bilibili_ws_status=t.data:"douyin_room_change"==t.type?l.douyin_romm_id=t.data:"douyin_status_change"==t.type&&(l.douyin_ws_status=t.data)}});i=e,e('{"type":"live_config","data":""}')})()}),(e,f)=>{const y=se,b=ae,v=le,w=p,k=u,L=r,S=o,E=ne,J=_,N=te,P=m,Q=c,ee=g;return j(),x(Q,{class:"chat-container"},{default:R(()=>[T(P,{class:"chat-main"},{default:R(()=>[T(J,{class:"chat-card"},{header:R(()=>[M("div",de,[M("span",null,[f[0]||(f[0]=B(" 点歌列表 ",-1)),T(y,{style:{cursor:"pointer"},onClick:F})])])]),footer:R(()=>[M("div",pe,[T(S,{type:"primary",onClick:H},{default:R(()=>[f[4]||(f[4]=B(" 手动点歌 ",-1)),T(k,null,{default:R(()=>[T(V(z))]),_:1})]),_:1}),T(S,{type:"danger",disabled:0==V(q).length,onClick:C},{default:R(()=>[f[5]||(f[5]=B(" 清空点歌列表 ",-1)),T(k,{class:"el-icon--right"},{default:R(()=>[T(V(G))]),_:1})]),_:1},8,["disabled"]),T(S,{type:"success",disabled:0==V(q).length,onClick:D},{default:R(()=>[f[6]||(f[6]=B(" 导出点歌列表 ",-1)),T(k,{class:"el-icon--right"},{default:R(()=>[T(V(X))]),_:1})]),_:1},8,["disabled"]),M("div",ge,[V(l).douyin_romm_id>0?(j(),x(E,{key:0,platform:"douyin",roomId:V(l).douyin_romm_id,wsStatus:V(l).douyin_ws_status},null,8,["roomId","wsStatus"])):W("",!0),V(l).bilibili_room_id>0?(j(),x(E,{key:1,platform:"bilibili",roomId:V(l).bilibili_room_id,wsStatus:V(l).bilibili_ws_status},null,8,["roomId","wsStatus"])):W("",!0)])])]),default:R(()=>[$((j(),I("div",{class:"chat-infinite-list",ref_key:"infiniteList",ref:t},[(j(!0),I(A,null,U(V(q),e=>(j(),I("div",ue,[M("img",{src:`/assets/images/${e.source}.png`,class:"source-img",alt:e.source,width:"24"},null,8,re),T(w,{tag:"span",class:"chat-tag"},{default:R(()=>[e.medal_level>0?(j(),I(A,{key:0},["bilibili"==e.source?(j(),x(b,{key:0,medal_name:e.medal_name,medal_level:e.medal_level,guard_level:e.guard_level},null,8,["medal_name","medal_level","guard_level"])):W("",!0),"douyin"==e.source?(j(),x(v,{key:1,medal_name:e.medal_name,medal_level:e.medal_level,guard_level:e.guard_level},null,8,["medal_name","medal_level","guard_level"])):W("",!0)],64)):W("",!0),null!=e.html&&e.html.length>0?(j(),I(A,{key:1},[B(O(e.uname)+"； ",1),T(w,{innerHTML:e.html},null,8,["innerHTML"])],64)):(j(),I(A,{key:2},[B(O(e.uname)+"： "+O(e.msg),1)],64))]),_:2},1024),0==e.status?(j(),x(L,{key:0,placement:"bottom"},{content:R(()=>[...f[1]||(f[1]=[M("span",null,"复制点歌",-1)])]),default:R(()=>[M("span",{class:"chat-close",onClick:a=>{return l=e.msg_id,t=e.msg,h(t),s.updateDanmakuStatus(l,1),void n.success("拷贝成功");var l,t}},[T(k,null,{default:R(()=>[T(V(K))]),_:1})],8,ce)]),_:2},1024)):W("",!0),1==e.status?(j(),x(L,{key:1,placement:"bottom"},{content:R(()=>[...f[2]||(f[2]=[M("span",null,"已复制",-1)])]),default:R(()=>[M("span",me,[T(k,null,{default:R(()=>[T(V(Y))]),_:1})])]),_:1})):W("",!0),T(L,{placement:"bottom"},{content:R(()=>[...f[3]||(f[3]=[M("span",null,"移除点歌",-1)])]),default:R(()=>[M("span",{class:"chat-close",onClick:a=>{return l=e,s.removeDanmakuList(l),void i(`{"type":"delete","data":${l.msg_id}}`);var l}},[T(k,null,{default:R(()=>[T(V(Z))]),_:1})],8,_e)]),_:2},1024)]))),256))])),[[ee,d]])]),_:1}),T(N,{ref_key:"singDialogRef",ref:a},null,512)]),_:1})]),_:1})}}});export{fe as default};
