import{w as e,x as a,y as l,r as t,n as s,s as i,A as r,B as n,C as d,D as o,o as c,g as u,a as m,l as g,E as v}from"./vendor-element-plus-e6HPG-4R.js";import{o as f,r as p,ap as h,Z as _,q as w,t as y,U as b,K as x,u as C,R as k,M as B,P as V,S as j,T,bx as D,bs as R}from"./vendor-libs-C0o6WDcM.js";import{r as U,a as I}from"./index-kVVbdc6B.js";import"./vendor-exceljs-BzIpynsW.js";import"./vendor-vue-Dc1K7n3v.js";const K={class:"card-header"},q={class:"mb-4 flex items-center"},A={style:{height:"300px"}},E={class:"avatar-image-container"},L=["src"],F={key:0,class:"code-bage"},M=I(f({__name:"biliTab",setup(f){const I=p(),M=p(!1),O=p(!1),P=p(0),Q=p(""),S=p(""),Z=p(Array()),z=h({id:0,room_id:0,modal_level:0,user_level:0,sing_prefix:"点歌",sing_cd:0}),G=[{key:"uid",dataKey:"uid",title:"uid",width:100,cellRenderer:({cellData:e})=>b(c,null,{default:()=>[e,k(" ")]})},{key:"uname",dataKey:"uname",title:"昵称",width:250,cellRenderer:({cellData:e})=>b(c,null,{default:()=>[e,k(" ")]})},{key:"enable",dataKey:"enable",title:"是否启用",width:150,cellRenderer:({rowData:e})=>b(u,{modelValue:e.enable,"inline-prompt":!0,style:"--el-switch-off-color: #ff4949",activeText:"启用",inactiveText:"禁用",onChange:a=>{e.enable=a,J(a,e.id)}},{default:()=>[" "]})},{key:"operations",title:"操作",width:100,cellRenderer:({rowData:e})=>b(T,null,[b(t,{type:"primary",icon:D,loading:O.value,onClick:a=>X(e.id)},{default:()=>[k("刷新")]}),b(t,{type:"danger",icon:R,onClick:a=>W(e.id)},{default:()=>[k("删除")]})])}],H=()=>{U.getBiliConfig({}).then(e=>{const a=e.data;if(0!=a.code)m.warning(a.msg);else{const e=a.data.data;if(e){const a=e;z.id=a.id,z.room_id=a.room_id,z.modal_level=a.modal_level,z.user_level=a.user_level,z.sing_prefix=a.sing_prefix,z.sing_cd=a.sing_cd}}return U.getBiliCredntialList({})}).then(e=>{const a=e.data;0!=a.code?m.warning(a.msg):Z.value=a.data.rows}).catch(e=>{m.error(e)})},J=(e,a)=>{Z.value.forEach((l,t,s)=>{l.id!=a&&(l.enable=!e)})},N=()=>{U.getBiliCredentialCode({}).then(e=>{const a=e.data;0==a.code?(Q.value=a.data.data,P.value=setInterval(Y,1e3),M.value=!0):m.warning(a.msg)}).catch(e=>m.error(e))},W=e=>{g.confirm("是否删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>U.deleteBiliCredential({id:e})).then(a=>{const l=a.data;if(0!=l.code)m.warning(l.msg);else{m.success(l.msg);const a=Z.value.filter(a=>a.id!=e);Z.value=a}}).catch(e=>{"string"==typeof e&&"cancel"==e||m.error(e)})},X=e=>{O.value=!0,U.refreshBiliCredential({id:e}).then(e=>{const a=e.data;0!=a.code?m.warning(a.msg):m.success("success"),O.value=!1}).catch(e=>{m.error(e),O.value=!1})},Y=()=>{U.checkQrCode({}).then(e=>{const a=e.data;if(0==a.code){if("success"==a.msg&&(clearInterval(P.value),P.value=0,S.value="",m.success("登录成功"),U.getBiliCredntialList({}).then(e=>{const a=e.data;0!=a.code?m.warning(a.msg):Z.value=a.data.rows}),M.value=!1),"qr_state"==a.msg)switch(a.data.data){case"confirm":S.value="未确认登录";break;case"timeout":S.value="二维码已过期";break;default:S.value=""}}else m.warning(a.msg||"二维码状态请求错误")}).catch(e=>m.error(e))},$=()=>{clearInterval(P.value),P.value=0},ee=async()=>{const e=await window.pywebview.api.get_bili_ws_status();let a="";a=-1==e?"哔哩哔哩未配置":e>=0&&e<=2?"哔哩哔哩已重新连接":"哔哩哔哩连接发生错误",v({title:"提示",message:a,type:e>=0&&e<=2?"success":"warning",position:"bottom-right"})};return _(()=>{H()}),(c,u)=>{const g=l,v=a,f=e,p=s,h=i,_=d,D=n,R=r,O=o;return y(),w(T,null,[b(p,null,{header:x(()=>[...u[4]||(u[4]=[B("div",{class:"card-header"},[B("span",null,"基础设置")],-1)])]),default:x(()=>[b(f,{model:z,ref_key:"refForm",ref:I,"label-width":"auto"},{default:x(()=>[b(v,{label:"房间号",prop:"room_id"},{default:x(()=>[b(g,{modelValue:z.room_id,"onUpdate:modelValue":u[0]||(u[0]=e=>z.room_id=e),placeholder:"B站直播间号",type:"text",min:"1"},null,8,["modelValue"])]),_:1}),b(v,{label:"点歌指令",prop:"sing_prefix"},{default:x(()=>[b(g,{modelValue:z.sing_prefix,"onUpdate:modelValue":u[1]||(u[1]=e=>z.sing_prefix=e),placeholder:"点歌指令",type:"text"},null,8,["modelValue"])]),_:1}),b(v,null,{default:x(()=>[b(C(t),{type:"primary",onClick:u[2]||(u[2]=e=>{U.addOrUpdateBiliConfig({data:z}).then(e=>{const a=e.data;0!=a.code?m.warning(a.msg):(m.success(a.msg),H(),ee())}).catch(e=>m.error(e))})},{default:x(()=>[...u[5]||(u[5]=[k("保存",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),b(h),b(p,null,{header:x(()=>[B("div",K,[u[6]||(u[6]=B("span",null,"账号设置",-1)),b(_,{title:"未登录账号无法获取到弹幕用户昵称等信息，如有需要可添加一个小号",type:"warning",closable:!1})])]),default:x(()=>[B("div",q,[b(C(t),{type:"primary",onClick:N},{default:x(()=>[...u[7]||(u[7]=[k("新增",-1)])]),_:1})]),B("div",A,[b(R,null,{default:x(({width:e,height:a})=>[b(D,{columns:G,data:Z.value,width:e,height:a,fixed:""},null,8,["data","width","height"])]),_:1})])]),_:1}),b(O,{modelValue:M.value,"onUpdate:modelValue":u[3]||(u[3]=e=>M.value=e),title:"新增",width:"720",onClose:$,"destroy-on-close":""},{default:x(()=>[B("div",E,[B("img",{src:Q.value,alt:"qrcode",class:"avatar",referrerpolicy:"no-referrer"},null,8,L),S.value.length>0?(y(),w("div",F,j(S.value),1)):V("",!0)])]),_:1},8,["modelValue"])],64)}}}),[["__scopeId","data-v-713ef53a"]]);export{M as default};
