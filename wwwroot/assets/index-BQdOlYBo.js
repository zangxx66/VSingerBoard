import{E as e,d as a,e as t,b as s,h as l,i as n,j as i,k as o,l as r,m as d,c as u,n as m,s as c,o as p,p as g,q as _,f as h,r as v,v as f}from"./vendor-element-plus-ChNPy6BA.js";import{r as y,p as b,t as w,g as k,a as x}from"./index-BmqyJb8x.js";import{e as V}from"./excel-CH2sLU4d.js";import{o as j,r as z,bg as C,Y as H,M as L,A as U,B as M,t as Y,J as D,C as $,u as B,q as I,I as P,ai as q,f as E,G as T,y as A,E as G,H as J}from"./vendor-libs-Crij45JJ.js";import"./vendor-vue-SbnYag36.js";import"./vendor-exceljs-C-8i3j8b.js";const O={class:"chat-infinite-list",ref:"chatInfiniteList"},R={class:"chat-infinite-list-item"},S=["src","alt"],X={tag:"span",class:"chat-tag"},F={style:{width:"15%"}},K={style:{display:"flex"}},N={style:{width:"50%"}},Q={style:{width:"50%","text-align":"right"}},W=j({__name:"index",setup(j){const W=z(!1),Z=z(!1),ee=z(0),ae=z(),te=z(),se=C("historyDataCard"),le=C("chatInfiniteList"),ne=H({uname:"",song_name:"",source:"all",start_time:0,end_time:0,page:1,size:20}),ie=[{key:"全部",value:"all"},{key:"抖音",value:"douyin"},{key:"B站",value:"bilibili"}],oe=e=>{if(!e)return ne.start_time=0,void(ne.end_time=0);ne.start_time=e[0],ne.end_time=k(e[1])},re=()=>{const a=[{header:"日期",key:"date",width:50},{header:"昵称",key:"uname",width:50},{header:"歌名",key:"song",width:50},{header:"平台",key:"source",width:50}],t={};Object.assign(t,ne),t.page=1,t.size=ee.value,Z.value=!0,y.getHistoryList(t).then(t=>{const s=t.data;if(0!=s.code)return e.warning(s.msg),void(Z.value=!1);const l=s.data.rows.map(e=>({date:w(e.create_time),uname:e.uname,song:e.song_name,source:"bilibili"==e.source?"B站":"抖音"})),n=`点歌历史记录_${x()}`;V(a,l,n),Z.value=!1}).catch(a=>{e.error(a),Z.value=!1})},de=()=>{W.value=!0,y.getHistoryList(ne).then(a=>{const t=a.data;if(0!=t.code)return e.warning(t.msg),void(W.value=!1);ee.value=t.data.total;const s=t.data.rows,l=s.map(e=>({msg_id:e.id,uid:e.uid,uname:e.uname,msg:e.song_name,send_time:e.create_time,source:e.source,medal_name:"",medal_level:0,guard_level:0})),n=b(l);te.value=s.map((e,a)=>({...e,song_name:n[a].html||e.song_name,create_time_str:w(e.create_time)})),W.value=!1}).catch(a=>{e.error(a),W.value=!1})},ue=()=>{ne.page=1,de()};return L(()=>{const e=.9*window.innerHeight;se.value?.$el.style.setProperty("overflow","hidden");const a=.6*e;le.value?.style.setProperty("height",`${a}px`),de()}),(e,y)=>{const b=i,w=n,k=r,x=o,V=d,j=m,z=u,C=l,H=s,L=p,se=h,le=v,me=g,ce=t,pe=a,ge=f;return Y(),U(pe,{class:"history-container"},{default:M(()=>[D(ce,{class:"history-main"},{default:M(()=>[D(H,{class:"history-card"},{header:M(()=>[...y[6]||(y[6]=[A("div",{class:"card-header"},[A("span",null,"查询")],-1)])]),default:M(()=>[D(C,{model:B(ne),"label-width":"auto",inline:"",class:"inline-form"},{default:M(()=>[D(w,{label:"歌名",prop:"song_name"},{default:M(()=>[D(b,{modelValue:B(ne).song_name,"onUpdate:modelValue":y[0]||(y[0]=e=>B(ne).song_name=e),type:"text"},null,8,["modelValue"])]),_:1}),D(w,{label:"昵称",prop:"uname"},{default:M(()=>[D(b,{modelValue:B(ne).uname,"onUpdate:modelValue":y[1]||(y[1]=e=>B(ne).uname=e),type:"text"},null,8,["modelValue"])]),_:1}),D(w,{label:"点歌平台",prop:"source"},{default:M(()=>[D(x,{modelValue:B(ne).source,"onUpdate:modelValue":y[2]||(y[2]=e=>B(ne).source=e),placeholder:"请选择点歌平台"},{default:M(()=>[(Y(),I(P,null,q(ie,e=>D(k,{label:e.key,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),D(w,{label:"时间范围",prop:"dateRange",style:{width:"350px"}},{default:M(()=>[D(V,{modelValue:B(ae),"onUpdate:modelValue":y[3]||(y[3]=e=>E(ae)?ae.value=e:null),type:"daterange","value-format":"X",format:"YYYY-MM-DD",onChange:oe},null,8,["modelValue"])]),_:1}),D(w,null,{default:M(()=>[D(z,{type:"primary",onClick:ue},{default:M(()=>[D(j,{class:"el-icon--left"},{default:M(()=>[D(B(c))]),_:1}),y[7]||(y[7]=T(" 搜索 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),D(L),$((Y(),U(H,{class:"history-data-card",ref:"historyDataCard"},{default:M(()=>[A("div",O,[(Y(!0),I(P,null,q(B(te),e=>(Y(),I("div",R,[A("img",{src:`/assets/images/${e.source}.png`,class:"source-img",alt:e.source,width:"24"},null,8,S),A("text",X,[T(J(e.uname)+"：",1),D(se,{style:{display:"flex"},innerHTML:e.song_name},null,8,["innerHTML"])]),A("span",F,J(e.create_time_str),1)]))),256)),0==B(te)?.length?(Y(),U(le,{key:0,description:"没有数据"})):G("",!0)],512)]),footer:M(()=>[A("div",K,[A("div",N,[D(me,{background:"",layout:"prev, pager, next",total:B(ee),"page-size":B(ne).size,"onUpdate:pageSize":y[4]||(y[4]=e=>B(ne).size=e),"current-page":B(ne).page,"onUpdate:currentPage":y[5]||(y[5]=e=>B(ne).page=e),onChange:de},null,8,["total","page-size","current-page"])]),A("div",Q,[D(z,{type:"success",disabled:0==B(te)?.length,onClick:re,loading:B(Z)},{default:M(()=>[y[8]||(y[8]=T(" 导出历史记录 ",-1)),D(j,{class:"el-icon--right"},{default:M(()=>[D(B(_))]),_:1})]),_:1},8,["disabled","loading"])])])]),_:1})),[[ge,B(W)]])]),_:1})]),_:1})}}});export{W as default};
