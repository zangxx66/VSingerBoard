import{X as D,L as k,Y as F,J as V,d as M,r as N,j as U,o as R,M as $,G as j,l as p,P as _,n as m,U as P,Z as q,k as b,Q as X,$ as Y,q as G,a0 as J,a1 as I,a2 as K,v as Q,a3 as W,F as L,T as Z,a4 as T,a5 as z}from"./index-Csm1QA7T.js";import{E as ee,r as te}from"./request-C8K2WuSa.js";import{d as ne,g as se,E as oe}from"./index-CH9Pwysp.js";var ae="Expected a function";function O(e,n,t){var s=!0,c=!0;if(typeof e!="function")throw new TypeError(ae);return D(t)&&(s="leading"in t?!!t.leading:s,c="trailing"in t?!!t.trailing:c),ne(e,n,{leading:s,maxWait:n,trailing:c})}const B=e=>{let n=0,t=e;for(;t;)n+=t.offsetTop,t=t.offsetParent;return n},ie=(e,n)=>Math.abs(B(e)-B(n)),r="ElInfiniteScroll",ce=50,le=200,re=0,de={delay:{type:Number,default:le},distance:{type:Number,default:re},disabled:{type:Boolean,default:!1},immediate:{type:Boolean,default:!0}},x=(e,n)=>Object.entries(de).reduce((t,[s,c])=>{var u,l;const{type:f,default:d}=c,a=e.getAttribute(`infinite-scroll-${s}`);let o=(l=(u=n[a])!=null?u:a)!=null?l:d;return o=o==="false"?!1:o,o=f(o),t[s]=Number.isNaN(o)?d:o,t},{}),H=e=>{const{observer:n}=e[r];n&&(n.disconnect(),delete e[r].observer)},ue=(e,n)=>{const{container:t,containerEl:s,instance:c,observer:u,lastScrollTop:l}=e[r],{disabled:f,distance:d}=x(e,c),{clientHeight:a,scrollHeight:o,scrollTop:i}=s,h=i-l;if(e[r].lastScrollTop=i,u||f||h<0)return;let v=!1;if(t===e)v=o-(a+i)<=d;else{const{clientTop:E,scrollHeight:w}=e,y=ie(e,s);v=i+a>=y+E+w-d}v&&n.call(c)};function C(e,n){const{containerEl:t,instance:s}=e[r],{disabled:c}=x(e,s);c||t.clientHeight===0||(t.scrollHeight<=t.clientHeight?n.call(s):H(e))}const fe={async mounted(e,n){const{instance:t,value:s}=n;F(s)||V(r,"'v-infinite-scroll' binding value must be a function"),await k();const{delay:c,immediate:u}=x(e,t),l=se(e,!0),f=l===window?document.documentElement:l,d=O(ue.bind(null,e,s),c);if(l){if(e[r]={instance:t,container:l,containerEl:f,delay:c,cb:s,onScroll:d,lastScrollTop:f.scrollTop},u){const a=new MutationObserver(O(C.bind(null,e,s),ce));e[r].observer=a,a.observe(e,{childList:!0,subtree:!0}),C(e,s)}l.addEventListener("scroll",d)}},unmounted(e){if(!e[r])return;const{container:n,onScroll:t}=e[r];n?.removeEventListener("scroll",t),H(e)},async updated(e){if(!e[r])await k();else{const{containerEl:n,cb:t,observer:s}=e[r];n.clientHeight&&s&&C(e,t)}}},S=fe;S.install=e=>{e.directive("InfiniteScroll",S)};const _e=S,ge="/assets/images/bilibili.png",pe="/assets/images/douyin.png",me={class:"infinite-list"},ve={class:"infinite-list-item"},be={key:0,src:ge,class:"source-img",alt:"bilibili",width:"24"},he={key:1,src:pe,class:"source-img",alt:"douyin",width:"24"},Ee=M({__name:"chat",setup(e){const n=N(Array()),t=U({id:0,room_id:0,modal_level:0,user_level:0,sing_prefix:"点歌",sing_cd:0}),s=N(0),c=()=>{te.getBiliConfig({}).then(a=>{const o=a.data;if(o.code!=0)T.warning(o.msg);else{if(!o.data.data)return;const i=o.data.data;t.id=i.id,t.room_id=i.room_id,t.modal_level=i.modal_level,t.user_level=i.user_level,t.sing_prefix=i.sing_prefix,t.sing_cd=i.sing_cd,u()}}).catch(a=>T.error(a))},u=()=>{s.value=setInterval(async()=>{const a=await window.pywebview.api.get_danmu();a&&n.value.push(...a);const o=await window.pywebview.api.get_dy_danmu();o&&n.value.push(...o)},1e3)},l=()=>console.log("load"),f=a=>{window.pywebview.api.copy_to_clipboard(a),T.success("拷贝成功")},d=a=>{const o=n.value.filter(i=>i.uid!=a.uid&&i.source!=a.source);n.value=o};return R(()=>{c()}),$(()=>{clearInterval(s.value),s.value=0}),(a,o)=>{const i=oe,h=K,v=ee,E=P,w=Z,y=_e;return p(),j(w,{class:"chat-container"},{default:_(()=>[m(E,{class:"chat-main"},{default:_(()=>[m(v,{class:"chat-card"},{header:_(()=>[...o[0]||(o[0]=[L("div",{class:"card-header"},[L("span",null,"点歌列表")],-1)])]),default:_(()=>[q((p(),b("div",me,[(p(!0),b(X,null,Y(n.value,g=>(p(),b("div",ve,[g.source=="bilibili"?(p(),b("img",be)):g.source=="douyin"?(p(),b("img",he)):G("",!0),m(i,{tag:"span",class:"chat-tag",onClick:A=>f(g.msg)},{default:_(()=>[J(I(g.uname)+"："+I(g.msg),1)]),_:2},1032,["onClick"]),m(i,{tag:"span",class:"chat-close",onClick:A=>d(g)},{default:_(()=>[m(h,null,{default:_(()=>[m(Q(W))]),_:1})]),_:1},8,["onClick"])]))),256))])),[[y,l]])]),_:1})]),_:1})]),_:1})}}}),Ce=z(Ee,[["__scopeId","data-v-d60bc999"]]);export{Ce as default};
