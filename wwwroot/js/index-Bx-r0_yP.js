import{a as e,b as a,c as l,d as s,e as t,f as o,g as i,E as n,h as r,v as u,i as m,j as d,w as c,k as _,l as p,m as g,n as f,o as h,p as y,q as v,r as b,s as k,t as w,u as C,x as j,y as x,z as V}from"./vendor-element-plus-HZbGYrKl.js";import{u as D}from"./danmaku-CRfawzi8.js";import{g as L,t as E}from"./times-Cw5rdMqO.js";import{n as A,r as T,a1 as $,q as F,t as H,u as M,a as U,D as B,L as S,x as q,ao as I,K as R,I as z,c as J,y as O,J as G,E as K,H as N,ba as P,U as Y,Y as Q,V as W,G as X}from"./vendor-libs-7289s0cb.js";import{_ as Z,a as ee}from"./fans-medal-DxOaCeZc.js";import{_ as ae}from"./line-header.vue_vue_type_script_setup_true_lang-Be3zGABY.js";import{_ as le}from"./link-icon-BIizdxOZ.js";import{w as se}from"./vendor-vue-Cl2YAQzn.js";import{c as te,p as oe}from"./tool-uNj5llJ9.js";import{e as ie}from"./excel-g-lxlBLo.js";import{b as ne}from"./route-block-B_A1xBdJ.js";import"./vendor-exceljs-C-8i3j8b.js";import"./request-BsWu63JD.js";const re=A({__name:"add-sing-dialog",setup(r,{expose:u}){const m=T(!1),d=D(),c=$({msg_id:0,uid:0,uname:"",msg:"",send_time:0,source:"douyin",medal_level:0,medal_name:"",guard_level:0}),_=[{key:"抖音",value:"douyin"},{key:"B站",value:"bilibili"}],p=()=>{c.uname="",c.msg="",c.source="douyin"};return u({openDialog:()=>{m.value=!0}}),(r,u)=>{const g=l,f=a,h=t,y=s,v=o,b=i,k=e;return H(),F(k,{modelValue:M(m),"onUpdate:modelValue":u[4]||(u[4]=e=>U(m)?m.value=e:null),title:"手动点歌",width:"480","destroy-on-close":"",onClose:p},{default:B(()=>[S(b,{model:M(c),"label-width":"auto"},{default:B(()=>[S(f,{label:"用户昵称",prop:"uname"},{default:B(()=>[S(g,{modelValue:M(c).uname,"onUpdate:modelValue":u[0]||(u[0]=e=>M(c).uname=e),placeholder:"用户昵称",type:"text"},null,8,["modelValue"])]),_:1}),S(f,{label:"点歌内容",prop:"msg"},{default:B(()=>[S(g,{modelValue:M(c).msg,"onUpdate:modelValue":u[1]||(u[1]=e=>M(c).msg=e),placeholder:"点歌内容",type:"text"},null,8,["modelValue"])]),_:1}),S(f,{label:"点歌平台",prop:"source"},{default:B(()=>[S(y,{modelValue:M(c).source,"onUpdate:modelValue":u[2]||(u[2]=e=>M(c).source=e),placeholder:"请选择点歌平台"},{default:B(()=>[(H(),q(R,null,I(_,(e,a)=>S(h,{key:a,label:e.key,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),S(f,null,{default:B(()=>[S(v,{type:"primary",onClick:u[3]||(u[3]=e=>{""!=c.msg?(c.msg_id=L(),c.send_time=L(),d.pushDanmakuList([{...c}]),m.value=!1):n.error("点歌内容不能为空")})},{default:B(()=>[...u[5]||(u[5]=[z("保存",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),ue={class:"platform-status-container"},me=["src","alt"],de=A({__name:"platform-status",props:{platform:{},roomId:{},wsStatus:{}},setup(e){const a=e,l=T(!1),s=()=>{l.value=!0;try{"bilibili"==a.platform?window.pywebview.api.restart_bilibili_ws():window.pywebview.api.restart_douyin_ws(),n.success("刷新成功，请等待操作完成")}catch(e){"string"==typeof e?n.error(e):e instanceof Error&&n.error(e.message)}finally{setTimeout(()=>{l.value=!1},5e3)}},t={bilibili:new Map([[-1,{color:"#F56C6C",icon:r,message:"未配置或出现错误"}],[0,{color:"#E6A23C",icon:c,message:"初始化"}],[1,{color:"#E6A23C",icon:c,message:"连接建立中"}],[2,{color:"#67C23A",icon:_,message:"已连接"}],[3,{color:"#E6A23C",icon:c,message:"断开连接中"}],[4,{color:"#F56C6C",icon:r,message:"已断开"}],[5,{color:"#F56C6C",icon:r,message:"出现错误"}]]),douyin:new Map([[-1,{color:"#F56C6C",icon:r,message:"未配置或出现错误"}],[0,{color:"#E6A23C",icon:c,message:"未连接"}],[1,{color:"#67C23A",icon:_,message:"已连接"}],[2,{color:"#E6A23C",icon:c,message:"已断开"}],[3,{color:"#F56C6C",icon:r,message:"出现错误"}]])},i=J(()=>t[a.platform].get(a.wsStatus)||{color:"#F56C6C",icon:r,message:"未配置或出现错误"});return(a,t)=>{const n=m,r=o,c=d,_=u;return H(),q("div",ue,[O("img",{src:`/images/${e.platform}.png`,class:"source-img",alt:e.platform,width:"24"},null,8,me),z("："+G(e.roomId)+"   ",1),S(c,{placement:"top"},{content:B(()=>[O("span",null,"当前状态："+G(M(i).message)+"，如有异常点击重新连接",1)]),default:B(()=>[K((H(),F(r,{text:"",onClick:s},{default:B(()=>[S(n,{color:M(i).color,class:"status-img"},{default:B(()=>[(H(),F(N(M(i).icon)))]),_:1},8,["color"])]),_:1})),[[_,M(l)]])]),_:1})])}}}),ce={class:"card-header"},_e=["src","alt"],pe=["onClick"],ge={class:"chat-close"},fe=["onClick"],he={class:"chat-card-footer"},ye={class:"card-footer-right"},ve=A({name:"home",__name:"index",setup(e){const a=$({douyin_romm_id:0,bilibili_room_id:0,douyin_ws_status:-1,bilibili_ws_status:-1}),l=D(),s=T(),t=P("chat-main"),i=P("singDialogRef"),r=T("0px"),{send:u}=se("ws://127.0.0.1:8080",{autoReconnect:!0,autoClose:!0,heartbeat:{message:'{"type":"echo","data":"heartbeat"}',interval:5e3,pongTimeout:1e4},onMessage:(e,a)=>{const l=JSON.parse(a.data),s=A[l.type];s&&s(l.data)}});u('{"type":"live_config","data":""}');const c=()=>{V.confirm("是否清空点歌列表","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{l.clearDanmakuList(),u('{"type":"clear","data":""}')}).catch(e=>{"string"==typeof e&&"cancel"==e||n.error(e)})},_=()=>{const e=N.value.map(e=>({date:E(e.send_time),uname:e.uname,song:e.msg,source:"bilibili"==e.source?"B站":"抖音"})),a=`点歌列表_${L()}`;ie([{header:"日期",key:"date",width:50},{header:"昵称",key:"uname",width:50},{header:"歌名",key:"song",width:50},{header:"平台",key:"source",width:50}],e,a)},A={echo:()=>{},del:e=>{const a=N.value.filter(a=>!e.some(e=>e.msg_id===a.msg_id));l.setDanmakuList(a)},add:e=>{const a=[...N.value,...oe(e)];l.setDanmakuList(a)},live_config:e=>{Object.assign(a,e)},bili_room_change:e=>{a.bilibili_room_id=e},bili_status_change:e=>{a.bilibili_ws_status=e},douyin_room_change:e=>{a.douyin_romm_id=e},douyin_status_change:e=>{a.douyin_ws_status=e}},U=async()=>{const e=document.createElement("a");e.href="http://127.0.0.1:8000/danmaku",e.target="_blank",e.click(),e.remove()},K=()=>{i.value&&i.value.openDialog()},N=J(()=>l.getDanmakuList());return Y(N,async()=>{await Q(),s.value&&s.value.scrollTo({behavior:"smooth",top:s.value.$el.scrollHeight})}),W(()=>{const e=.9*window.innerHeight-40;t.value?.$el.style.setProperty("overflow","hidden");const a=.8*e;r.value=`${a}px`}),(e,s)=>{const t=le,V=ae,D=Z,L=ee,E=h,A=m,T=d,$=k,J=f,P=o,Y=de,Q=g,W=re,se=p,oe=x;return H(),F(oe,{class:"chat-container"},{default:B(()=>[S(se,{ref:"chat-main",class:"chat-main"},{default:B(()=>[S(Q,{class:"chat-card"},{header:B(()=>[O("div",ce,[S(V,{class:"flex items-center",title:"点歌列表"},{suffix:B(()=>[S(t,{class:"cursor-pointer color-white",onClick:U})]),_:1})])]),footer:B(()=>[O("div",he,[S(P,{type:"primary",onClick:K},{default:B(()=>[s[3]||(s[3]=z(" 手动点歌 ",-1)),S(A,null,{default:B(()=>[S(M(w))]),_:1})]),_:1}),S(P,{type:"danger",disabled:0==M(N).length,onClick:c},{default:B(()=>[s[4]||(s[4]=z(" 清空点歌列表 ",-1)),S(A,{class:"el-icon--right"},{default:B(()=>[S(M(C))]),_:1})]),_:1},8,["disabled"]),S(P,{type:"success",disabled:0==M(N).length,onClick:_},{default:B(()=>[s[5]||(s[5]=z(" 导出点歌列表 ",-1)),S(A,{class:"el-icon--right"},{default:B(()=>[S(M(j))]),_:1})]),_:1},8,["disabled"]),O("div",ye,[M(a).douyin_romm_id>0?(H(),F(Y,{key:0,platform:"douyin","room-id":M(a).douyin_romm_id,"ws-status":M(a).douyin_ws_status},null,8,["room-id","ws-status"])):X("",!0),M(a).bilibili_room_id>0?(H(),F(Y,{key:1,platform:"bilibili","room-id":M(a).bilibili_room_id,"ws-status":M(a).bilibili_ws_status},null,8,["room-id","ws-status"])):X("",!0)])])]),default:B(()=>[S(J,{ref:"infiniteList",class:"chat-infinite-list",noresize:"",height:M(r)},{default:B(()=>[(H(!0),q(R,null,I(M(N),(e,a)=>(H(),q("div",{key:a,class:"chat-infinite-list-item"},[O("img",{src:`/images/${e.source}.png`,class:"source-img",alt:e.source,width:"24"},null,8,_e),S(E,{tag:"span",class:"chat-tag"},{default:B(()=>[e.medal_level>0?(H(),q(R,{key:0},["bilibili"==e.source?(H(),F(D,{key:0,"medal-name":e.medal_name,"medal-level":e.medal_level,"guard-level":e.guard_level},null,8,["medal-name","medal-level","guard-level"])):X("",!0),"douyin"==e.source?(H(),F(L,{key:1,"medal-name":e.medal_name,"medal-level":e.medal_level,"guard-level":e.guard_level},null,8,["medal-name","medal-level","guard-level"])):X("",!0)],64)):X("",!0),null!=e.html&&e.html.length>0?(H(),q(R,{key:1},[z(G(e.uname)+"； ",1),S(E,{style:{display:"flex"},innerHTML:e.html},null,8,["innerHTML"])],64)):(H(),q(R,{key:2},[z(G(e.uname)+"： "+G(e.msg),1)],64))]),_:2},1024),0==e.status?(H(),F(T,{key:0,placement:"bottom"},{content:B(()=>[...s[0]||(s[0]=[O("span",null,"复制点歌",-1)])]),default:B(()=>[O("span",{class:"chat-close",onClick:a=>{return s=e.msg_id,t=e.msg,te(t),l.updateDanmakuStatus(s,1),void n.success("拷贝成功");var s,t}},[S(A,null,{default:B(()=>[S(M(y))]),_:1})],8,pe)]),_:2},1024)):X("",!0),1==e.status?(H(),F(T,{key:1,placement:"bottom"},{content:B(()=>[...s[1]||(s[1]=[O("span",null,"已复制",-1)])]),default:B(()=>[O("span",ge,[S(A,null,{default:B(()=>[S(M(v))]),_:1})])]),_:1})):X("",!0),S(T,{placement:"bottom"},{content:B(()=>[...s[2]||(s[2]=[O("span",null,"移除点歌",-1)])]),default:B(()=>[O("span",{class:"chat-close",onClick:a=>{return s=e,l.removeDanmakuList(s),void u(`{"type":"delete","data":${s.msg_id}}`);var s}},[S(A,null,{default:B(()=>[S(M(b))]),_:1})],8,fe)]),_:2},1024)]))),128)),S($,{right:100,bottom:100,target:".chat-infinite-list > div"})]),_:1},8,["height"])]),_:1}),S(W,{ref_key:"singDialogRef",ref:i},null,512)]),_:1},512)]),_:1})}}});"function"==typeof ne&&ne(ve);export{ve as default};
