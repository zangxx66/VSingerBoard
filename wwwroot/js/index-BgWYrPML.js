import{a as e,b as a,c as l,d as s,e as t,f as o,g as i,E as n,h as r,v as u,i as m,j as d,w as c,k as _,l as p,m as g,n as f,o as y,p as h,q as v,r as b,s as k,t as w,u as C,x as j,y as x}from"./vendor-element-plus-BNN58Tgt.js";import{u as V}from"./danmaku-CdFxaPOn.js";import{g as D,t as L}from"./times-X7rBhlB4.js";import{n as E,r as A,a1 as T,q as $,t as F,u as H,a as M,D as U,L as B,x as S,ao as q,K as I,I as R,c as J,y as O,J as z,E as G,H as K,ba as N,U as P,V as Y,G as Q,Y as W}from"./vendor-libs-DLrArELd.js";import{_ as X,a as Z}from"./fans-medal-BtFGd3rB.js";import{_ as ee}from"./link-icon-sufAlEF8.js";import{v as ae}from"./vendor-vue-D3OeNkI5.js";import{p as le,c as se}from"./tool-7CWFlNCe.js";import{e as te}from"./excel-g-lxlBLo.js";import{b as oe}from"./route-block-B_A1xBdJ.js";import"./vendor-exceljs-C-8i3j8b.js";import"./request-BRje5s3q.js";const ie=E({__name:"add-sing-dialog",setup(r,{expose:u}){const m=A(!1),d=V(),c=T({msg_id:0,uid:0,uname:"",msg:"",send_time:0,source:"douyin",medal_level:0,medal_name:"",guard_level:0}),_=[{key:"抖音",value:"douyin"},{key:"B站",value:"bilibili"}],p=()=>{c.uname="",c.msg="",c.source="douyin"};return u({openDialog:()=>{m.value=!0}}),(r,u)=>{const g=l,f=a,y=t,h=s,v=o,b=i,k=e;return F(),$(k,{modelValue:H(m),"onUpdate:modelValue":u[4]||(u[4]=e=>M(m)?m.value=e:null),title:"手动点歌",width:"480",onClose:p},{default:U(()=>[B(b,{model:H(c),"label-width":"auto"},{default:U(()=>[B(f,{label:"用户昵称",prop:"uname"},{default:U(()=>[B(g,{modelValue:H(c).uname,"onUpdate:modelValue":u[0]||(u[0]=e=>H(c).uname=e),placeholder:"用户昵称",type:"text"},null,8,["modelValue"])]),_:1}),B(f,{label:"点歌内容",prop:"msg"},{default:U(()=>[B(g,{modelValue:H(c).msg,"onUpdate:modelValue":u[1]||(u[1]=e=>H(c).msg=e),placeholder:"点歌内容",type:"text"},null,8,["modelValue"])]),_:1}),B(f,{label:"点歌平台",prop:"source"},{default:U(()=>[B(h,{modelValue:H(c).source,"onUpdate:modelValue":u[2]||(u[2]=e=>H(c).source=e),placeholder:"请选择点歌平台"},{default:U(()=>[(F(),S(I,null,q(_,(e,a)=>B(y,{key:a,label:e.key,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),B(f,null,{default:U(()=>[B(v,{type:"primary",onClick:u[3]||(u[3]=e=>{""!=c.msg?(c.msg_id=D(),c.send_time=D(),d.pushDanmakuList([{...c}]),m.value=!1):n.error("点歌内容不能为空")})},{default:U(()=>[...u[5]||(u[5]=[R("保存",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),ne={class:"platform-status-container"},re=["src","alt"],ue=E({__name:"platform-status",props:{platform:{},roomId:{},wsStatus:{}},setup(e){const a=e,l=A(!1),s=()=>{l.value=!0;try{"bilibili"==a.platform?window.pywebview.api.restart_bilibili_ws():window.pywebview.api.restart_douyin_ws(),n.success("刷新成功，请等待操作完成")}catch(e){"string"==typeof e?n.error(e):e instanceof Error&&n.error(e.message)}finally{setTimeout(()=>{l.value=!1},5e3)}},t={bilibili:new Map([[-1,{color:"#F56C6C",icon:r,message:"未配置或出现错误"}],[0,{color:"#E6A23C",icon:c,message:"初始化"}],[1,{color:"#E6A23C",icon:c,message:"连接建立中"}],[2,{color:"#67C23A",icon:_,message:"已连接"}],[3,{color:"#E6A23C",icon:c,message:"断开连接中"}],[4,{color:"#F56C6C",icon:r,message:"已断开"}],[5,{color:"#F56C6C",icon:r,message:"出现错误"}]]),douyin:new Map([[-1,{color:"#F56C6C",icon:r,message:"未配置或出现错误"}],[0,{color:"#E6A23C",icon:c,message:"未连接"}],[1,{color:"#67C23A",icon:_,message:"已连接"}],[2,{color:"#E6A23C",icon:c,message:"已断开"}],[3,{color:"#F56C6C",icon:r,message:"出现错误"}]])},i=J(()=>t[a.platform].get(a.wsStatus)||{color:"#F56C6C",icon:r,message:"未配置或出现错误"});return(a,t)=>{const n=m,r=o,c=d,_=u;return F(),S("div",ne,[O("img",{src:`/images/${e.platform}.png`,class:"source-img",alt:e.platform,width:"24"},null,8,re),R("："+z(e.roomId)+"   ",1),B(c,{placement:"top"},{content:U(()=>[O("span",null,"当前状态："+z(H(i).message)+"，如有异常点击重新连接",1)]),default:U(()=>[G((F(),$(r,{text:"",onClick:s},{default:U(()=>[B(n,{color:H(i).color,class:"status-img"},{default:U(()=>[(F(),$(K(H(i).icon)))]),_:1},8,["color"])]),_:1})),[[_,H(l)]])]),_:1})])}}}),me={class:"card-header"},de=["src","alt"],ce=["onClick"],_e={class:"chat-close"},pe=["onClick"],ge={class:"chat-card-footer"},fe={class:"card-footer-right"},ye=E({name:"home",__name:"index",setup(e){const a=T({douyin_romm_id:0,bilibili_room_id:0,douyin_ws_status:-1,bilibili_ws_status:-1}),l=V(),s=A(),t=N("chat-main"),i=N("singDialogRef"),r=A("0px"),{send:u}=ae("ws://127.0.0.1:8080",{autoReconnect:!0,autoClose:!0,heartbeat:{message:'{"type":"echo","data":"heartbeat"}',interval:5e3,pongTimeout:1e4},onMessage:(e,a)=>{const l=JSON.parse(a.data),s=E[l.type];s&&s(l.data)}});u('{"type":"live_config","data":""}');const c=()=>{j.confirm("是否清空点歌列表","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{l.clearDanmakuList(),u('{"type":"clear","data":""}')}).catch(e=>{"string"==typeof e&&"cancel"==e||n.error(e)})},_=()=>{const e=K.value.map(e=>({date:L(e.send_time),uname:e.uname,song:e.msg,source:"bilibili"==e.source?"B站":"抖音"})),a=`点歌列表_${D()}`;te([{header:"日期",key:"date",width:50},{header:"昵称",key:"uname",width:50},{header:"歌名",key:"song",width:50},{header:"平台",key:"source",width:50}],e,a)},E={echo:()=>{},del:e=>{const a=K.value.filter(a=>!e.some(e=>e.msg_id===a.msg_id));l.setDanmakuList(a)},add:e=>{const a=[...K.value,...le(e)];l.setDanmakuList(a)},live_config:e=>{Object.assign(a,e)},bili_room_change:e=>{a.bilibili_room_id=e},bili_status_change:e=>{a.bilibili_ws_status=e},douyin_room_change:e=>{a.douyin_romm_id=e},douyin_status_change:e=>{a.douyin_ws_status=e}},M=async()=>{const e=document.createElement("a");e.href="http://127.0.0.1:8000/danmaku",e.target="_blank",e.click(),e.remove()},G=()=>{i.value&&i.value.openDialog()},K=J(()=>l.getDanmakuList());return P(K,async()=>{await W(),s.value&&s.value.scrollTo({behavior:"smooth",top:s.value.$el.scrollHeight})}),Y(()=>{const e=.9*window.innerHeight-40;t.value?.$el.style.setProperty("overflow","hidden");const a=.8*e;r.value=`${a}px`}),(e,s)=>{const t=ee,j=X,V=Z,D=y,L=m,E=d,A=f,T=o,J=ue,N=g,P=ie,Y=p,W=x;return F(),$(W,{class:"chat-container"},{default:U(()=>[B(Y,{ref:"chat-main",class:"chat-main"},{default:U(()=>[B(N,{class:"chat-card"},{header:U(()=>[O("div",me,[O("span",null,[s[0]||(s[0]=R(" 点歌列表 ",-1)),B(t,{style:{cursor:"pointer"},onClick:M})])])]),footer:U(()=>[O("div",ge,[B(T,{type:"primary",onClick:G},{default:U(()=>[s[4]||(s[4]=R(" 手动点歌 ",-1)),B(L,null,{default:U(()=>[B(H(k))]),_:1})]),_:1}),B(T,{type:"danger",disabled:0==H(K).length,onClick:c},{default:U(()=>[s[5]||(s[5]=R(" 清空点歌列表 ",-1)),B(L,{class:"el-icon--right"},{default:U(()=>[B(H(w))]),_:1})]),_:1},8,["disabled"]),B(T,{type:"success",disabled:0==H(K).length,onClick:_},{default:U(()=>[s[6]||(s[6]=R(" 导出点歌列表 ",-1)),B(L,{class:"el-icon--right"},{default:U(()=>[B(H(C))]),_:1})]),_:1},8,["disabled"]),O("div",fe,[H(a).douyin_romm_id>0?(F(),$(J,{key:0,platform:"douyin","room-id":H(a).douyin_romm_id,"ws-status":H(a).douyin_ws_status},null,8,["room-id","ws-status"])):Q("",!0),H(a).bilibili_room_id>0?(F(),$(J,{key:1,platform:"bilibili","room-id":H(a).bilibili_room_id,"ws-status":H(a).bilibili_ws_status},null,8,["room-id","ws-status"])):Q("",!0)])])]),default:U(()=>[B(A,{ref:"infiniteList",class:"chat-infinite-list",noresize:"",height:H(r)},{default:U(()=>[(F(!0),S(I,null,q(H(K),(e,a)=>(F(),S("div",{key:a,class:"chat-infinite-list-item"},[O("img",{src:`/images/${e.source}.png`,class:"source-img",alt:e.source,width:"24"},null,8,de),B(D,{tag:"span",class:"chat-tag"},{default:U(()=>[e.medal_level>0?(F(),S(I,{key:0},["bilibili"==e.source?(F(),$(j,{key:0,"medal-name":e.medal_name,"medal-level":e.medal_level,"guard-level":e.guard_level},null,8,["medal-name","medal-level","guard-level"])):Q("",!0),"douyin"==e.source?(F(),$(V,{key:1,"medal-name":e.medal_name,"medal-level":e.medal_level,"guard-level":e.guard_level},null,8,["medal-name","medal-level","guard-level"])):Q("",!0)],64)):Q("",!0),null!=e.html&&e.html.length>0?(F(),S(I,{key:1},[R(z(e.uname)+"； ",1),B(D,{style:{display:"flex"},innerHTML:e.html},null,8,["innerHTML"])],64)):(F(),S(I,{key:2},[R(z(e.uname)+"： "+z(e.msg),1)],64))]),_:2},1024),0==e.status?(F(),$(E,{key:0,placement:"bottom"},{content:U(()=>[...s[1]||(s[1]=[O("span",null,"复制点歌",-1)])]),default:U(()=>[O("span",{class:"chat-close",onClick:a=>{return s=e.msg_id,t=e.msg,se(t),l.updateDanmakuStatus(s,1),void n.success("拷贝成功");var s,t}},[B(L,null,{default:U(()=>[B(H(h))]),_:1})],8,ce)]),_:2},1024)):Q("",!0),1==e.status?(F(),$(E,{key:1,placement:"bottom"},{content:U(()=>[...s[2]||(s[2]=[O("span",null,"已复制",-1)])]),default:U(()=>[O("span",_e,[B(L,null,{default:U(()=>[B(H(v))]),_:1})])]),_:1})):Q("",!0),B(E,{placement:"bottom"},{content:U(()=>[...s[3]||(s[3]=[O("span",null,"移除点歌",-1)])]),default:U(()=>[O("span",{class:"chat-close",onClick:a=>{return s=e,l.removeDanmakuList(s),void u(`{"type":"delete","data":${s.msg_id}}`);var s}},[B(L,null,{default:U(()=>[B(H(b))]),_:1})],8,pe)]),_:2},1024)]))),128))]),_:1},8,["height"])]),_:1}),B(P,{ref_key:"singDialogRef",ref:i},null,512)]),_:1},512)]),_:1})}}});"function"==typeof oe&&oe(ye);export{ye as default};
