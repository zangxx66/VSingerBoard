import{V as e,W as a,X as t,Y as l,Z as n,_ as o,E as s,$ as r,a0 as i,a1 as u,i as d,a2 as c,a3 as m,l as p,a4 as f,a5 as v,T as h,U as g,a6 as _,a7 as y,y as k}from"./vendor-element-plus-HZbGYrKl.js";import{n as b,r as x,c as w,L as N,a1 as T,bd as S,ba as C,U as j,V as R,q as V,am as $,t as E,D,$ as I,u as L,x as U,K as q,ao as A,H as F,I as H,J as M,G as z,a as O,y as W,bh as Y,Y as B,b8 as G}from"./vendor-libs-7289s0cb.js";import{u as J}from"./theme-Bpk-E46z.js";import{z as K,A as X}from"./vendor-vue-Cl2YAQzn.js";import{u as Z,t as P}from"./dark-CHiul9fV.js";import{e as Q}from"./request-BsWu63JD.js";import{c as ee,d as ae}from"./tool-uNj5llJ9.js";import"./vendor-exceljs-C-8i3j8b.js";const te={style:{"vertical-align":"middle","margin-left":"4px"}},le=((e,a)=>{const t=e.__vccOpts||e;for(const[l,n]of a)t[l]=n;return t})(b({name:"defaultLayout",__name:"default",setup(b){const le=J(),ne=K(),oe=X(),se={shadow:"always"},re={alignCenter:!0,draggable:!0,overflow:!1,transition:"el-fade-in"},ie={offset:70,plain:!0},ue=x("/"),de=x("0"),ce=x([]),me=w(()=>ce.value.map(e=>e.componentName).filter(Boolean)),pe=[{title:"点歌板",icon:N(e,null,null),routerName:"/",ref:"homeRef"},{title:"点歌记录",icon:N(a,null,null),routerName:"/history",ref:"historyRef"},{title:"歌单管理",icon:N(t,null,null),routerName:"/playlist",ref:"playlistRef"},{title:"更新日志",icon:N(l,null,null),routerName:"/changelog"},{title:"设置",icon:N(n,null,null),routerName:"/settings",ref:"settingsRef"},{title:"关于",icon:N(o,null,null),routerName:"/about"}],fe=T({id:0,dark_mode:!1,check_update:!1,startup:!1,notification:!1,navSideTour:!1,collapse:!1}),{data:ve,isFetching:he}=Z(),ge=S({mutationFn:async e=>await Q({data:e}),onSuccess:e=>{0!=e.code?s.warning(e.msg||"请求异常"):fe.id=e.data},onError:e=>{s.error(e.message)}}),_e=x(!1),ye=x(),ke=x(),be=x(),xe=x(),we=C("mainRef"),Ne=()=>{fe.navSideTour=!0,ge.mutate(fe),_e.value=!1},Te=async()=>{await B(),fe.navSideTour||(fe.navSideTour=!0,ge.mutate(fe),_e.value=!1)},Se=e=>{const a=pe.findIndex(a=>a.routerName==e);de.value=a.toString()},Ce=e=>{const a=e.toString(),t=pe.find(e=>e.routerName==a)?.title||ne.path;let l=ce.value.find(e=>e.name===a);l||(l={name:a,title:t,path:a,closable:"/"!==a,componentName:"/"==a?"home":a.replaceAll("/","")},ce.value.push(l)),ue.value=a,oe.push({path:a}),Se(a)},je=e=>{const a=ce.value,t=e.toString();let l=ue.value;l===t&&a.forEach((e,n)=>{if(e.name===t){const e=a[n+1]||a[n-1];l=e?e.name:"/"}}),ce.value=a.filter(e=>e.name!==t),ue.value=l,oe.push({path:l}),Se(l)},Re=async e=>{e.preventDefault();const a=window.getSelection()?.toString(),t=document.activeElement,l=t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement;let n=!1;const o=await window.pywebview.api.check_clipboard();o&&o.length>0&&(n=!0);const r=[{label:"拷贝",disabled:!a,onClick:()=>{a&&(ee(a),s.success("拷贝成功"))}},{label:"粘贴",disabled:!l||!n,onClick:()=>{ae(t)}}];G.showContextMenu({x:e.x,y:e.y,theme:De.value?"mac dark":"mac",zIndex:9999,minWidth:230,items:r})},Ve=()=>{fe.dark_mode=!fe.dark_mode,ge.mutate(fe),P(fe.dark_mode),le.setDarkTheme(fe.dark_mode)},$e=w(()=>({left:fe.collapse?"64px":"200px"})),Ee=w(()=>({width:fe.collapse?"64px":"200px"})),De=w(()=>le.getDarkTheme());return j(he,()=>{ve.value&&(()=>{const e=ve.value;e?(Object.assign(fe,e),P(e.dark_mode),le.setDarkTheme(e.dark_mode),e.navSideTour||(_e.value=!0)):_e.value=!0})()},{once:!0}),R(()=>{const e=pe.find(e=>e.routerName==ne.path)?.title||ne.name;ce.value.push({name:ne.path,title:e,path:ne.path,closable:"/"!==ne.path,componentName:ne.name}),ue.value=ne.path}),(a,t)=>{const l=d,n=u,o=i,s=r,b=g,x=h,w=$("router-view"),T=y,S=_,C=f,j=p,R=k;return E(),V(R,{class:"layout-container-demo"},{default:D(()=>[N(s,{style:I(L(Ee))},{default:D(()=>[N(o,{"default-active":L(de),collapse:L(fe).collapse,class:"layout-aside-menu"},{default:D(()=>[(E(),U(q,null,A(pe,(e,a)=>N(n,{key:a,ref_for:!0,ref:e.ref||void 0,index:a.toString(),onClick:a=>(e=>{if(ne.path==e)return fe.collapse=!fe.collapse,void ge.mutate(fe);Ce(e)})(e.routerName)},{title:D(()=>[H(M(e.title),1)]),default:D(()=>[N(l,null,{default:D(()=>[(E(),V(F(e.icon)))]),_:2},1024)]),_:2},1032,["index","onClick"])),64)),N(n,{ref_key:"themeRef",ref:xe,index:(pe.length+1).toString(),onClick:Ve},{default:D(()=>[L(De)?z("",!0):(E(),V(l,{key:0},{default:D(()=>[N(L(c))]),_:1})),L(De)?(E(),V(l,{key:1},{default:D(()=>[N(L(m))]),_:1})):z("",!0)]),_:1},8,["index"])]),_:1},8,["default-active","collapse"])]),_:1},8,["style"]),N(j,{ref_key:"mainRef",ref:we,style:I(L($e)),onContextmenu:Re},{default:D(()=>[N(C,{locale:L(v),card:se,dialog:re,message:ie},{default:D(()=>[N(x,{modelValue:L(ue),"onUpdate:modelValue":t[0]||(t[0]=e=>O(ue)?ue.value=e:null),type:"card",closable:"",onTabRemove:je,onTabChange:Ce},{default:D(()=>[(E(!0),U(q,null,A(L(ce),a=>(E(),V(b,{key:a.name,name:a.name,closable:a.closable},{label:D(()=>[W("span",null,[N(l,{style:{"vertical-align":"middle"}},{default:D(()=>{return[(E(),V(F((t=a.path,pe.find(e=>e.routerName==t)?.icon||N(e,null,null)))))];var t}),_:2},1024),W("span",te,M(a.title),1)])]),_:2},1032,["name","closable"]))),128))]),_:1},8,["modelValue"]),N(w,null,{default:D(({Component:e})=>[(E(),V(Y,{include:L(me)},[(E(),V(F(e)))],1032,["include"]))]),_:1}),N(S,{modelValue:L(_e),"onUpdate:modelValue":t[1]||(t[1]=e=>O(_e)?_e.value=e:null),"target-area-clickable":!1,"close-on-press-escape":!1,onClose:Te,onFinish:Ne},{default:D(()=>[N(T,{title:"提示",description:"欢迎使用点歌姬"}),N(T,{title:"提示",description:"这里是点歌，可以查看抖和破站的点歌列表",placement:"right",target:L(ye)?.$el},null,8,["target"]),N(T,{title:"提示",description:"这里是历史记录，可以查看历史点歌",placement:"right",target:L(ke)?.$el},null,8,["target"]),N(T,{title:"提示",description:"这里是设置，可以设置抖和破站的直播间监听",placement:"right",target:L(be)?.$el},null,8,["target"]),N(T,{title:"提示",description:"这是主题开关，可以切换主题",placement:"right",target:L(xe)?.$el},null,8,["target"]),N(T,{title:"提示",description:"这里是主界面",placement:"left",target:L(we)?.$el},null,8,["target"])]),_:1},8,["modelValue"])]),_:1},8,["locale"])]),_:1},8,["style"])]),_:1})}}}),[["__scopeId","data-v-4148e8a6"]]);export{le as default};
