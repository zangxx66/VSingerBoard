import{L as e,y as a,A as l,B as t,W as s,X as i,Y as n,r as d,E as r,Z as o,u,j as c,F as g,G as p,v as m,H as y,_ as h,$ as _,I as f,a0 as v,a1 as w,k,d as b,Q as x,R as V,S as C,a2 as L}from"./vendor-element-plus-C1FTue0a.js";import{b as S,r as j}from"./index-MkrUeJyj.js";import"./vendor-exceljs-C-8i3j8b.js";import{n as P,r as U,a1 as D,q as z,u as R,a as K,D as B,L as E,G as I,I as O,t as $,be as A,c as G,V as H,y as T,E as q,K as F}from"./vendor-libs-HLQpMz2o.js";import{i as Q,e as W}from"./excel-CH2sLU4d.js";import"./vendor-vue-J6GVTi4e.js";const X=P({__name:"addPlaylistDialog",emits:["submit"],setup(o,{expose:u,emit:c}){const g=c,p=U(!1),m=U(!1),y=D({id:0,song_name:"",singer:"",is_sc:!1,sc_price:0,language:"",tag:"",create_time:0}),h=()=>{p.value=!1,y.id=0,y.song_name="",y.singer="",y.is_sc=!1,y.sc_price=0,y.language="",y.tag=""};return u({openDialog:e=>{e&&Object.assign(y,e),p.value=!0}}),(o,u)=>{const c=t,_=l,f=i,v=s,w=n,k=d,b=a,x=e;return $(),z(x,{modelValue:R(p),"onUpdate:modelValue":u[8]||(u[8]=e=>K(p)?p.value=e:null),title:"新增歌曲",width:"450","destroy-on-close":"","before-close":h},{default:B(()=>[E(b,{model:R(y),"label-width":"auto"},{default:B(()=>[E(_,{label:"歌名",prop:"song_name"},{default:B(()=>[E(c,{modelValue:R(y).song_name,"onUpdate:modelValue":u[0]||(u[0]=e=>R(y).song_name=e),type:"text"},null,8,["modelValue"])]),_:1}),E(_,{label:"歌手",prop:"singer"},{default:B(()=>[E(c,{modelValue:R(y).singer,"onUpdate:modelValue":u[1]||(u[1]=e=>R(y).singer=e),type:"text"},null,8,["modelValue"])]),_:1}),E(_,{label:"语种",prop:"language"},{default:B(()=>[E(c,{modelValue:R(y).language,"onUpdate:modelValue":u[2]||(u[2]=e=>R(y).language=e),type:"text"},null,8,["modelValue"])]),_:1}),E(_,{label:"标签",prop:"tag"},{default:B(()=>[E(c,{modelValue:R(y).tag,"onUpdate:modelValue":u[3]||(u[3]=e=>R(y).tag=e),type:"text"},null,8,["modelValue"])]),_:1}),E(_,{label:"是否SC歌曲",prop:"is_sc"},{default:B(()=>[E(v,{modelValue:R(y).is_sc,"onUpdate:modelValue":u[4]||(u[4]=e=>R(y).is_sc=e)},{default:B(()=>[E(f,{value:!0},{default:B(()=>[...u[9]||(u[9]=[O("是",-1)])]),_:1}),E(f,{value:!1},{default:B(()=>[...u[10]||(u[10]=[O("否",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),R(y).is_sc?($(),z(_,{key:0,label:"SC价格",prop:"sc_price"},{default:B(()=>[E(w,{modelValue:R(y).sc_price,"onUpdate:modelValue":u[5]||(u[5]=e=>R(y).sc_price=e),min:30,controls:!1},null,8,["modelValue"])]),_:1})):I("",!0),E(_,null,{default:B(()=>[E(k,{loading:R(m),type:"primary",onClick:u[6]||(u[6]=e=>{y.song_name?y.singer?!y.is_sc||y.sc_price?(m.value=!0,y.create_time=S(),j.addOrUpdatePlaylist({data:y}).then(e=>{if(0!=e.code)return r.warning(e.msg),void(m.value=!1);r.success(e.msg),y.id=e.data;const a={id:y.id,song_name:y.song_name,singer:y.singer,is_sc:y.is_sc,sc_price:y.sc_price,language:y.language,tag:y.tag,create_time:y.create_time};g("submit",a),m.value=!1,h()}).catch(e=>{r.error(e),m.value=!1})):r.warning("请输入SC价格"):r.warning("请输入歌手"):r.warning("请输入歌名")})},{default:B(()=>[...u[11]||(u[11]=[O("保存",-1)])]),_:1},8,["loading"]),E(k,{onClick:u[7]||(u[7]=e=>h())},{default:B(()=>[...u[12]||(u[12]=[O("取消",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),Y={style:{height:"40px",display:"flex"}},Z={class:"chat-infinite-list",ref:"playlistInfiniteList"},J={style:{display:"flex"}},M={style:{width:"50%"}},N={style:{width:"50%","flex-direction":"row-reverse",display:"flex",gap:"10px"}},ee=P({__name:"index",setup(e){const{t:s}=o(),i=({value:e,intermediate:a=!1,ariaLabel:l,onChange:t})=>E(L,{onChange:t,modelValue:e,ariaLabel:l,indeterminate:a},null),n=U(!1),P=U(!1),K=U(!1),I=U(0),ee=U(Array()),ae=A("playlistDataCard"),le=A("playlistInfiniteList"),te=A("addPlaylistDialogRef"),se=D({keyword:"",page:1,size:20}),ie=[{header:"歌曲名",key:"song_name",width:50},{header:"歌手",key:"singer",width:50},{header:"语种",key:"language",width:25},{header:"标签",key:"tag",width:50},{header:"是否SC曲目",key:"is_sc",width:25},{header:"SC曲目价格",key:"sc_price",width:25}],ne=[{header:"歌曲名",key:"song_name",type:"string"},{header:"歌手",key:"singer",type:"string"},{header:"语种",key:"language",type:"string"},{header:"标签",key:"tag",type:"string"},{header:"是否SC曲目",key:"is_sc",type:"boolean"},{header:"SC曲目价格",key:"sc_price",type:"number"}],de=[{key:"selection",width:50,cellRenderer:({rowData:e})=>E(F,null,[E(i,{value:e.checked,ariaLabel:s("el.table.selectRowLabel"),onChange:a=>e.checked=a},null)]),headerCellRenderer:()=>{const e=R(ee),a=e.every(e=>e.checked),l=e.some(e=>e.checked);return E(F,null,[E(i,{value:a,intermediate:l&&!a,ariaLabel:s("el.table.selectAllLabel"),onChange:a=>ee.value=e.map(e=>(e.checked=Boolean(a),e))},null)])}},{key:"song_name",dataKey:"song_name",title:"歌名",width:200},{key:"singer",dataKey:"singer",title:"歌手",width:200},{key:"language",dataKey:"language",title:"语种",width:200},{key:"tag",dataKey:"tag",title:"标签",width:200},{key:"sc_price",dataKey:"sc_price",title:"SC曲目价格",width:200},{key:"operations",title:"操作",width:200,cellRenderer:({rowData:e})=>E(F,null,[E(d,{type:"success",icon:x,onClick:a=>re(e)},{default:()=>[O("编辑")]}),E(d,{type:"default",icon:V,onClick:a=>oe([e.id])},{default:()=>[O("删除")]})])}],re=e=>{te.value&&te.value.openDialog(e)},oe=e=>{C.confirm("是否删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>j.deletePlaylist({data:e})).then(a=>{if(0!=a.code)return void r.warning(a.msg);r.success(a.msg);const l=new Set(e);ee.value=ee.value.filter(e=>!l.has(e.id))}).catch(e=>{"string"==typeof e&&"cancel"==e||r.error(e)})},ue=e=>{const a=ee.value.find(a=>a.id==e.id);a?Object.assign(a,e):ee.value.unshift(e)},ce=async(e,a)=>{if(K.value=!0,!e)return void(K.value=!1);const l=e.name.split(".");if("xlsx"!=l[l.length-1])return r.warning("请上传xlsx格式的表格"),void(K.value=!1);const t=await(e.raw?.arrayBuffer()),s=await Q(ne,t);s.forEach(e=>{e.id=0,e.create_time=S()}),j.importPlaylist({data:s}).then(e=>{0!=e.code?r.warning(e.msg):r.success(e.msg),K.value=!1,me()}).catch(e=>{r.error(e),K.value=!1})},ge=()=>{const e={};Object.assign(e,se),e.page=1,e.size=I.value,P.value=!0,j.getPlaylistList(e).then(e=>{if(0!=e.code)return r.warning(e.msg),void(P.value=!1);const a=e.data.rows.map(e=>({song_name:e.song_name,singer:e.singer,is_sc:e.is_sc?"是":"否",sc_price:e.sc_price,language:e.language,tag:e.tag})),l=`歌单_${S()}`;W(ie,a,l),P.value=!1}).catch(e=>{r.error(e),P.value=!1})},pe=()=>{n.value=!0,j.getPlaylistList(se).then(e=>{if(0!=e.code)return r.warning(e.msg),void(n.value=!1);I.value=e.data.total;const a=e.data.rows;a.forEach(e=>e.checked=!1),ee.value=a,n.value=!1}).catch(e=>{r.error(e),n.value=!1})},me=()=>{se.page=1,pe()},ye=G(()=>ee.value.filter(e=>e.checked).length>0);return H(()=>{const e=.9*window.innerHeight;ae.value?.$el.style.setProperty("overflow","hidden");const a=.6*e;le.value?.style.setProperty("height",`${a}px`),pe()}),(e,s)=>{const i=t,r=l,o=c,x=a,V=u,C=p,L=w,S=v,j=y,U=h,D=X,A=k,G=b,H=m;return $(),z(G,{class:"playlist-container"},{default:B(()=>[E(A,{class:"playlist-main"},{default:B(()=>[E(V,{class:"playlist-card"},{header:B(()=>[...s[5]||(s[5]=[T("div",{class:"card-header"},[T("span",null,"查询")],-1)])]),default:B(()=>[E(x,{model:R(se),"label-width":"auto",inline:"",class:"inline-form"},{default:B(()=>[E(r,{label:"关键词",prop:"keyword"},{default:B(()=>[E(i,{modelValue:R(se).keyword,"onUpdate:modelValue":s[0]||(s[0]=e=>R(se).keyword=e),type:"text"},null,8,["modelValue"])]),_:1}),E(r,null,{default:B(()=>[E(R(d),{type:"primary",onClick:me},{default:B(()=>[E(o,{class:"el-icon--left"},{default:B(()=>[E(R(g))]),_:1}),s[6]||(s[6]=O(" 搜索 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),E(C),T("div",Y,[E(R(d),{type:"primary",onClick:s[1]||(s[1]=e=>re())},{default:B(()=>[...s[7]||(s[7]=[O("新增歌曲",-1)])]),_:1}),E(R(d),{type:"danger",onClick:s[2]||(s[2]=e=>(()=>{const e=ee.value.filter(e=>e.checked).map(e=>e.id);oe(e)})()),disabled:!R(ye)},{default:B(()=>[...s[8]||(s[8]=[O("全部删除",-1)])]),_:1},8,["disabled"])]),q(($(),z(V,{class:"playlist-data-card",ref:"playlistDataCard"},{default:B(()=>[T("div",Z,[E(S,null,{default:B(({width:e,height:a})=>[E(L,{columns:de,data:R(ee),width:e,height:a,fixed:""},null,8,["data","width","height"])]),_:1})],512)]),footer:B(()=>[T("div",J,[T("div",M,[E(j,{background:"",layout:"prev, pager, next",total:R(I),"page-size":R(se).size,"onUpdate:pageSize":s[3]||(s[3]=e=>R(se).size=e),"current-page":R(se).page,"onUpdate:currentPage":s[4]||(s[4]=e=>R(se).page=e),onChange:pe},null,8,["total","page-size","current-page"])]),T("div",N,[E(U,{action:"#","auto-upload":!1,"show-file-list":!1,"on-change":ce,accept:".xlsx"},{trigger:B(()=>[E(R(d),{type:"success",loading:R(K)},{default:B(()=>[s[9]||(s[9]=O(" 导入歌单 ",-1)),E(o,{class:"el-icon--right"},{default:B(()=>[E(R(_))]),_:1})]),_:1},8,["loading"])]),_:1}),E(R(d),{onClick:ge,loading:R(P)},{default:B(()=>[s[10]||(s[10]=O(" 导出歌单 ",-1)),E(o,{class:"el-icon--right"},{default:B(()=>[E(R(f))]),_:1})]),_:1},8,["loading"])])])]),_:1})),[[H,R(n)]]),E(D,{onSubmit:ue,ref:"addPlaylistDialogRef"},null,512)]),_:1})]),_:1})}}});export{ee as default};
