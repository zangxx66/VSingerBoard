import{t as e,i as a,j as l,G as t,H as s,I as i,c as n,h as d,E as r,J as o,d as c,e as u,b as g,n as p,s as m,o as y,p as h,K as _,L as f,q as v,M as w,N as k,v as b,C as x,D as V,F as C,O as L}from"./vendor-element-plus-DfIrH9Kr.js";import{a as j,r as D}from"./index-CqzKlsTq.js";import"./vendor-exceljs-C-8i3j8b.js";import{n as P,r as S,a1 as U,q as z,t as K,u as R,a as O,D as B,L as E,G as I,I as $,bf as q,c as A,V as G,y as H,E as T,K as F}from"./vendor-libs-DGcKXZQv.js";import{i as J,e as M}from"./excel-CH2sLU4d.js";import"./vendor-vue-lxJqvpcP.js";const N=P({__name:"addPlaylistDialog",emits:["submit"],setup(o,{expose:c,emit:u}){const g=u,p=S(!1),m=S(!1),y=U({id:0,song_name:"",singer:"",is_sc:!1,sc_price:0,language:"",tag:"",create_time:0}),h=()=>{p.value=!1,y.id=0,y.song_name="",y.singer="",y.is_sc=!1,y.sc_price=0,y.language="",y.tag=""};return c({openDialog:e=>{e&&Object.assign(y,e),p.value=!0}}),(o,c)=>{const u=l,_=a,f=s,v=t,w=i,k=n,b=d,x=e;return K(),z(x,{modelValue:R(p),"onUpdate:modelValue":c[8]||(c[8]=e=>O(p)?p.value=e:null),title:"新增歌曲",width:"450","destroy-on-close":"","before-close":h},{default:B(()=>[E(b,{model:R(y),"label-width":"auto"},{default:B(()=>[E(_,{label:"歌名",prop:"song_name"},{default:B(()=>[E(u,{modelValue:R(y).song_name,"onUpdate:modelValue":c[0]||(c[0]=e=>R(y).song_name=e),type:"text"},null,8,["modelValue"])]),_:1}),E(_,{label:"歌手",prop:"singer"},{default:B(()=>[E(u,{modelValue:R(y).singer,"onUpdate:modelValue":c[1]||(c[1]=e=>R(y).singer=e),type:"text"},null,8,["modelValue"])]),_:1}),E(_,{label:"语种",prop:"language"},{default:B(()=>[E(u,{modelValue:R(y).language,"onUpdate:modelValue":c[2]||(c[2]=e=>R(y).language=e),type:"text"},null,8,["modelValue"])]),_:1}),E(_,{label:"标签",prop:"tag"},{default:B(()=>[E(u,{modelValue:R(y).tag,"onUpdate:modelValue":c[3]||(c[3]=e=>R(y).tag=e),type:"text"},null,8,["modelValue"])]),_:1}),E(_,{label:"是否SC歌曲",prop:"is_sc"},{default:B(()=>[E(v,{modelValue:R(y).is_sc,"onUpdate:modelValue":c[4]||(c[4]=e=>R(y).is_sc=e)},{default:B(()=>[E(f,{value:!0},{default:B(()=>[...c[9]||(c[9]=[$("是",-1)])]),_:1}),E(f,{value:!1},{default:B(()=>[...c[10]||(c[10]=[$("否",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),R(y).is_sc?(K(),z(_,{key:0,label:"SC价格",prop:"sc_price"},{default:B(()=>[E(w,{modelValue:R(y).sc_price,"onUpdate:modelValue":c[5]||(c[5]=e=>R(y).sc_price=e),min:30,controls:!1},null,8,["modelValue"])]),_:1})):I("",!0),E(_,null,{default:B(()=>[E(k,{loading:R(m),type:"primary",onClick:c[6]||(c[6]=e=>{y.song_name?y.singer?!y.is_sc||y.sc_price?(m.value=!0,y.create_time=j(),D.addOrUpdatePlaylist({data:y}).then(e=>{const a=e.data;if(0!=a.code)return r.warning(a.msg),void(m.value=!1);r.success(a.msg),y.id=a.data;const l={id:y.id,song_name:y.song_name,singer:y.singer,is_sc:y.is_sc,sc_price:y.sc_price,language:y.language,tag:y.tag,create_time:y.create_time};g("submit",l),m.value=!1,h()}).catch(e=>{r.error(e),m.value=!1})):r.warning("请输入SC价格"):r.warning("请输入歌手"):r.warning("请输入歌名")})},{default:B(()=>[...c[11]||(c[11]=[$("保存",-1)])]),_:1},8,["loading"]),E(k,{onClick:c[7]||(c[7]=e=>h())},{default:B(()=>[...c[12]||(c[12]=[$("取消",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),Q={style:{height:"40px",display:"flex"}},W={class:"chat-infinite-list",ref:"playlistInfiniteList"},X={style:{display:"flex"}},Y={style:{width:"50%"}},Z={style:{width:"50%","flex-direction":"row-reverse",display:"flex",gap:"10px"}},ee=P({__name:"index",setup(e){const{t:t}=o(),s=({value:e,intermediate:a=!1,ariaLabel:l,onChange:t})=>E(L,{onChange:t,modelValue:e,ariaLabel:l,indeterminate:a},null),i=S(!1),P=S(!1),O=S(!1),I=S(0),ee=S(Array()),ae=q("playlistDataCard"),le=q("playlistInfiniteList"),te=q("addPlaylistDialogRef"),se=U({keyword:"",page:1,size:20}),ie=[{header:"歌曲名",key:"song_name",width:50},{header:"歌手",key:"singer",width:50},{header:"语种",key:"language",width:25},{header:"标签",key:"tag",width:50},{header:"是否SC曲目",key:"is_sc",width:25},{header:"SC曲目价格",key:"sc_price",width:25}],ne=[{header:"歌曲名",key:"song_name",type:"string"},{header:"歌手",key:"singer",type:"string"},{header:"语种",key:"language",type:"string"},{header:"标签",key:"tag",type:"string"},{header:"是否SC曲目",key:"is_sc",type:"boolean"},{header:"SC曲目价格",key:"sc_price",type:"number"}],de=[{key:"selection",width:50,cellRenderer:({rowData:e})=>E(F,null,[E(s,{value:e.checked,ariaLabel:t("el.table.selectRowLabel"),onChange:a=>e.checked=a},null)]),headerCellRenderer:()=>{const e=R(ee),a=e.every(e=>e.checked),l=e.some(e=>e.checked);return E(F,null,[E(s,{value:a,intermediate:l&&!a,ariaLabel:t("el.table.selectAllLabel"),onChange:a=>ee.value=e.map(e=>(e.checked=Boolean(a),e))},null)])}},{key:"song_name",dataKey:"song_name",title:"歌名",width:200},{key:"singer",dataKey:"singer",title:"歌手",width:200},{key:"language",dataKey:"language",title:"语种",width:200},{key:"tag",dataKey:"tag",title:"标签",width:200},{key:"sc_price",dataKey:"sc_price",title:"SC曲目价格",width:200},{key:"operations",title:"操作",width:200,cellRenderer:({rowData:e})=>E(F,null,[E(n,{type:"success",icon:x,onClick:a=>re(e)},{default:()=>[$("编辑")]}),E(n,{type:"default",icon:V,onClick:a=>oe([e.id])},{default:()=>[$("删除")]})])}],re=e=>{te.value&&te.value.openDialog(e)},oe=e=>{C.confirm("是否删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>D.deletePlaylist({data:e})).then(a=>{const l=a.data;if(0!=l.code)return void r.warning(l.msg);r.success(l.msg);const t=new Set(e);ee.value=ee.value.filter(e=>!t.has(e.id))}).catch(e=>{"string"==typeof e&&"cancel"==e||r.error(e)})},ce=e=>{const a=ee.value.find(a=>a.id==e.id);a?Object.assign(a,e):ee.value.unshift(e)},ue=async(e,a)=>{if(O.value=!0,!e)return void(O.value=!1);const l=e.name.split(".");if("xlsx"!=l[l.length-1])return r.warning("请上传xlsx格式的表格"),void(O.value=!1);const t=await(e.raw?.arrayBuffer()),s=await J(ne,t);s.forEach(e=>{e.id=0,e.create_time=j()}),D.importPlaylist({data:s}).then(e=>{const a=e.data;0!=a.code?r.warning(a.msg):r.success(a.msg),O.value=!1,me()}).catch(e=>{r.error(e),O.value=!1})},ge=()=>{const e={};Object.assign(e,se),e.page=1,e.size=I.value,P.value=!0,D.getPlaylistList(e).then(e=>{const a=e.data;if(0!=a.code)return r.warning(a.msg),void(P.value=!1);const l=a.data.rows.map(e=>({song_name:e.song_name,singer:e.singer,is_sc:e.is_sc?"是":"否",sc_price:e.sc_price,language:e.language,tag:e.tag})),t=`歌单_${j()}`;M(ie,l,t),P.value=!1}).catch(e=>{r.error(e),P.value=!1})},pe=()=>{i.value=!0,D.getPlaylistList(se).then(e=>{const a=e.data;if(0!=a.code)return r.warning(a.msg),void(i.value=!1);I.value=a.data.total;const l=a.data.rows;l.forEach(e=>e.checked=!1),ee.value=l,i.value=!1}).catch(e=>{r.error(e),i.value=!1})},me=()=>{se.page=1,pe()},ye=A(()=>ee.value.filter(e=>e.checked).length>0);return G(()=>{const e=.9*window.innerHeight;ae.value?.$el.style.setProperty("overflow","hidden");const a=.6*e;le.value?.style.setProperty("height",`${a}px`),pe()}),(e,t)=>{const s=l,r=a,o=p,x=d,V=g,C=y,L=k,j=w,D=h,S=_,U=N,q=u,A=c,G=b;return K(),z(A,{class:"playlist-container"},{default:B(()=>[E(q,{class:"playlist-main"},{default:B(()=>[E(V,{class:"playlist-card"},{header:B(()=>[...t[5]||(t[5]=[H("div",{class:"card-header"},[H("span",null,"查询")],-1)])]),default:B(()=>[E(x,{model:R(se),"label-width":"auto",inline:"",class:"inline-form"},{default:B(()=>[E(r,{label:"关键词",prop:"keyword"},{default:B(()=>[E(s,{modelValue:R(se).keyword,"onUpdate:modelValue":t[0]||(t[0]=e=>R(se).keyword=e),type:"text"},null,8,["modelValue"])]),_:1}),E(r,null,{default:B(()=>[E(R(n),{type:"primary",onClick:me},{default:B(()=>[E(o,{class:"el-icon--left"},{default:B(()=>[E(R(m))]),_:1}),t[6]||(t[6]=$(" 搜索 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),E(C),H("div",Q,[E(R(n),{type:"primary",onClick:t[1]||(t[1]=e=>re())},{default:B(()=>[...t[7]||(t[7]=[$("新增歌曲",-1)])]),_:1}),E(R(n),{type:"danger",onClick:t[2]||(t[2]=e=>(()=>{const e=ee.value.filter(e=>e.checked).map(e=>e.id);oe(e)})()),disabled:!R(ye)},{default:B(()=>[...t[8]||(t[8]=[$("全部删除",-1)])]),_:1},8,["disabled"])]),T((K(),z(V,{class:"playlist-data-card",ref:"playlistDataCard"},{default:B(()=>[H("div",W,[E(j,null,{default:B(({width:e,height:a})=>[E(L,{columns:de,data:R(ee),width:e,height:a,fixed:""},null,8,["data","width","height"])]),_:1})],512)]),footer:B(()=>[H("div",X,[H("div",Y,[E(D,{background:"",layout:"prev, pager, next",total:R(I),"page-size":R(se).size,"onUpdate:pageSize":t[3]||(t[3]=e=>R(se).size=e),"current-page":R(se).page,"onUpdate:currentPage":t[4]||(t[4]=e=>R(se).page=e),onChange:pe},null,8,["total","page-size","current-page"])]),H("div",Z,[E(S,{action:"#","auto-upload":!1,"show-file-list":!1,"on-change":ue,accept:".xlsx"},{trigger:B(()=>[E(R(n),{type:"success",loading:R(O)},{default:B(()=>[t[9]||(t[9]=$(" 导入歌单 ",-1)),E(o,{class:"el-icon--right"},{default:B(()=>[E(R(f))]),_:1})]),_:1},8,["loading"])]),_:1}),E(R(n),{onClick:ge,loading:R(P)},{default:B(()=>[t[10]||(t[10]=$(" 导出歌单 ",-1)),E(o,{class:"el-icon--right"},{default:B(()=>[E(R(v))]),_:1})]),_:1},8,["loading"])])])]),_:1})),[[G,R(i)]]),E(U,{onSubmit:ce,ref:"addPlaylistDialogRef"},null,512)]),_:1})]),_:1})}}});export{ee as default};
