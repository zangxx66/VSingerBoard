import{L as e,y as a,A as l,B as s,C as t,r as o,E as i,K as n,M as u,v as r,j as d,N as m,O as c,P as _,u as p,Q as g,R as f,I as y,k as h,d as v,S as b,w as k,T as w,U as C,V as x,x as V}from"./vendor-element-plus-C1FTue0a.js";import{b as D,t as j,p as L,d as S}from"./index-MkrUeJyj.js";import"./vendor-exceljs-C-8i3j8b.js";import{u as I}from"./danmaku-HvQPPjH-.js";import{n as A,r as E,a1 as T,q as M,u as U,a as $,D as B,L as F,x as H,ao as R,K as O,I as P,t as J,c as K,y as N,J as q,E as G,H as Q,be as Y,U as z,V as W,G as X,Y as Z}from"./vendor-libs-HLQpMz2o.js";import{_ as ee,a as ae}from"./fansMedal-DD3jFonr.js";import{_ as le}from"./linkIcon-BtDKMFhS.js";import{e as se}from"./excel-CH2sLU4d.js";import{C as te}from"./vendor-vue-J6GVTi4e.js";const oe=A({__name:"addSingDialog",setup(u,{expose:r}){const d=E(!1),m=I(),c=T({msg_id:0,uid:0,uname:"",msg:"",send_time:0,source:"douyin",medal_level:0,medal_name:"",guard_level:0}),_=[{key:"抖音",value:"douyin"},{key:"B站",value:"bilibili"}],p=()=>{c.uname="",c.msg="",c.source="douyin"};return r({openDialog:()=>{d.value=!0}}),(u,r)=>{const g=s,f=l,y=n,h=t,v=o,b=a,k=e;return J(),M(k,{modelValue:U(d),"onUpdate:modelValue":r[4]||(r[4]=e=>$(d)?d.value=e:null),title:"手动点歌",width:"720",onClose:p},{default:B(()=>[F(b,{model:U(c),"label-width":"auto"},{default:B(()=>[F(f,{label:"用户昵称",prop:"uname"},{default:B(()=>[F(g,{modelValue:U(c).uname,"onUpdate:modelValue":r[0]||(r[0]=e=>U(c).uname=e),placeholder:"用户昵称",type:"text"},null,8,["modelValue"])]),_:1}),F(f,{label:"点歌内容",prop:"msg"},{default:B(()=>[F(g,{modelValue:U(c).msg,"onUpdate:modelValue":r[1]||(r[1]=e=>U(c).msg=e),placeholder:"点歌内容",type:"text"},null,8,["modelValue"])]),_:1}),F(f,{label:"点歌平台",prop:"source"},{default:B(()=>[F(h,{modelValue:U(c).source,"onUpdate:modelValue":r[2]||(r[2]=e=>U(c).source=e),placeholder:"请选择点歌平台"},{default:B(()=>[(J(),H(O,null,R(_,e=>F(y,{label:e.key,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),F(f,null,{default:B(()=>[F(v,{type:"primary",onClick:r[3]||(r[3]=e=>{""!=c.msg?(c.msg_id=D(),c.send_time=D(),m.pushDanmakuList([{...c}]),d.value=!1):i.error("点歌内容不能为空")})},{default:B(()=>[...r[5]||(r[5]=[P("保存",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),ie={class:"platform-status-container"},ne=["src","alt"],ue=A({__name:"platformStatus",props:{platform:{},roomId:{},wsStatus:{}},setup(e){const a=e,l=E(!1),s=()=>{l.value=!0;try{"bilibili"==a.platform?window.pywebview.api.restart_bilibili_ws():window.pywebview.api.restart_douyin_ws(),i.success("刷新成功，请等待操作完成")}catch(e){i.error(e)}finally{setTimeout(()=>{l.value=!1},5e3)}},t={bilibili:new Map([[-1,{color:"#F56C6C",icon:m,message:"未配置或出现错误"}],[0,{color:"#E6A23C",icon:c,message:"初始化"}],[1,{color:"#E6A23C",icon:c,message:"连接建立中"}],[2,{color:"#67C23A",icon:_,message:"已连接"}],[3,{color:"#E6A23C",icon:c,message:"断开连接中"}],[4,{color:"#F56C6C",icon:m,message:"已断开"}],[5,{color:"#F56C6C",icon:m,message:"出现错误"}]]),douyin:new Map([[-1,{color:"#F56C6C",icon:m,message:"未配置或出现错误"}],[0,{color:"#E6A23C",icon:c,message:"未连接"}],[1,{color:"#67C23A",icon:_,message:"已连接"}],[2,{color:"#E6A23C",icon:c,message:"已断开"}],[3,{color:"#F56C6C",icon:m,message:"出现错误"}]])},n=K(()=>t[a.platform].get(a.wsStatus));return(a,t)=>{const i=d,m=o,c=u,_=r;return J(),H("div",ie,[N("img",{src:`/images/${e.platform}.png`,class:"source-img",alt:e.platform,width:"24"},null,8,ne),P("："+q(e.roomId)+"   ",1),F(c,{placement:"top"},{content:B(()=>[N("span",null,"当前状态："+q(U(n).message)+"，如有异常点击重新连接",1)]),default:B(()=>[G((J(),M(m,{text:"",onClick:s},{default:B(()=>[F(i,{color:U(n).color,class:"status-img"},{default:B(()=>[(J(),M(Q(U(n).icon)))]),_:1},8,["color"])]),_:1})),[[_,U(l)]])]),_:1})])}}}),re={class:"card-header"},de={class:"chat-infinite-list",ref:"infiniteList"},me={class:"chat-infinite-list-item"},ce=["src","alt"],_e=["onClick"],pe={class:"chat-close"},ge=["onClick"],fe={class:"chat-card-footer"},ye={class:"card-footer-right"},he=A({name:"home",setup(e){const a=T({douyin_romm_id:0,bilibili_room_id:0,douyin_ws_status:-1,bilibili_ws_status:-1}),l=I(),s=Y("infiniteList"),t=Y("chat-main"),n=Y("singDialogRef");let r;const m=()=>{},c=()=>{b.confirm("是否清空点歌列表","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{l.clearDanmakuList(),r('{"type":"clear","data":""}')}).catch(e=>{"string"==typeof e&&"cancel"==e||i.error(e)})},_=()=>{const e=Q.value.map(e=>({date:j(e.send_time),uname:e.uname,song:e.msg,source:"bilibili"==e.source?"B站":"抖音"})),a=`点歌列表_${D()}`;se([{header:"日期",key:"date",width:50},{header:"昵称",key:"uname",width:50},{header:"歌名",key:"song",width:50},{header:"平台",key:"source",width:50}],e,a)},A={echo:()=>{},del:e=>{const a=Q.value.filter(a=>!e.some(e=>e.msg_id===a.msg_id));l.setDanmakuList(a)},add:e=>{const a=[...Q.value,...L(e)];l.setDanmakuList(a)},live_config:e=>{Object.assign(a,e)},bili_room_change:e=>{a.bilibili_room_id=e},bili_status_change:e=>{a.bilibili_ws_status=e},douyin_room_change:e=>{a.douyin_romm_id=e},douyin_status_change:e=>{a.douyin_ws_status=e}},E=async()=>{const e=document.createElement("a");e.href="http://127.0.0.1:5173/danmaku",e.target="_blank",e.click(),e.remove()},$=()=>{n.value&&n.value.openDialog()},Q=K(()=>l.getDanmakuList());return z(Q,async()=>{await Z(),s.value&&s.value.scrollTo({behavior:"smooth",top:s.value.scrollHeight})}),W(()=>{const e=.9*window.innerHeight;t.value?.$el.style.setProperty("overflow","hidden");const a=.8*e;s.value?.style.setProperty("height",`${a}px`),(()=>{const{send:e}=te("ws://127.0.0.1:8080",{autoReconnect:!0,autoClose:!0,heartbeat:{message:'{"type":"echo","data":"heartbeat"}',interval:5e3,pongTimeout:1e4},onMessage:(e,a)=>{const l=JSON.parse(a.data),s=A[l.type];s&&s(l.data)}});r=e,e('{"type":"live_config","data":""}')})()}),(e,s)=>{const t=le,b=ee,D=ae,j=k,L=d,I=u,A=o,T=ue,K=p,Y=oe,z=h,W=v,Z=V;return J(),M(W,{class:"chat-container"},{default:B(()=>[F(z,{class:"chat-main",ref:"chat-main"},{default:B(()=>[F(K,{class:"chat-card"},{header:B(()=>[N("div",re,[N("span",null,[s[0]||(s[0]=P(" 点歌列表 ",-1)),F(t,{style:{cursor:"pointer"},onClick:E})])])]),footer:B(()=>[N("div",fe,[F(A,{type:"primary",onClick:$},{default:B(()=>[s[4]||(s[4]=P(" 手动点歌 ",-1)),F(L,null,{default:B(()=>[F(U(g))]),_:1})]),_:1}),F(A,{type:"danger",disabled:0==U(Q).length,onClick:c},{default:B(()=>[s[5]||(s[5]=P(" 清空点歌列表 ",-1)),F(L,{class:"el-icon--right"},{default:B(()=>[F(U(f))]),_:1})]),_:1},8,["disabled"]),F(A,{type:"success",disabled:0==U(Q).length,onClick:_},{default:B(()=>[s[6]||(s[6]=P(" 导出点歌列表 ",-1)),F(L,{class:"el-icon--right"},{default:B(()=>[F(U(y))]),_:1})]),_:1},8,["disabled"]),N("div",ye,[U(a).douyin_romm_id>0?(J(),M(T,{key:0,platform:"douyin",roomId:U(a).douyin_romm_id,wsStatus:U(a).douyin_ws_status},null,8,["roomId","wsStatus"])):X("",!0),U(a).bilibili_room_id>0?(J(),M(T,{key:1,platform:"bilibili",roomId:U(a).bilibili_room_id,wsStatus:U(a).bilibili_ws_status},null,8,["roomId","wsStatus"])):X("",!0)])])]),default:B(()=>[G((J(),H("div",de,[(J(!0),H(O,null,R(U(Q),e=>(J(),H("div",me,[N("img",{src:`/images/${e.source}.png`,class:"source-img",alt:e.source,width:"24"},null,8,ce),F(j,{tag:"span",class:"chat-tag"},{default:B(()=>[e.medal_level>0?(J(),H(O,{key:0},["bilibili"==e.source?(J(),M(b,{key:0,medal_name:e.medal_name,medal_level:e.medal_level,guard_level:e.guard_level},null,8,["medal_name","medal_level","guard_level"])):X("",!0),"douyin"==e.source?(J(),M(D,{key:1,medal_name:e.medal_name,medal_level:e.medal_level,guard_level:e.guard_level},null,8,["medal_name","medal_level","guard_level"])):X("",!0)],64)):X("",!0),null!=e.html&&e.html.length>0?(J(),H(O,{key:1},[P(q(e.uname)+"； ",1),F(j,{style:{display:"flex"},innerHTML:e.html},null,8,["innerHTML"])],64)):(J(),H(O,{key:2},[P(q(e.uname)+"： "+q(e.msg),1)],64))]),_:2},1024),0==e.status?(J(),M(I,{key:0,placement:"bottom"},{content:B(()=>[...s[1]||(s[1]=[N("span",null,"复制点歌",-1)])]),default:B(()=>[N("span",{class:"chat-close",onClick:a=>{return s=e.msg_id,t=e.msg,S(t),l.updateDanmakuStatus(s,1),void i.success("拷贝成功");var s,t}},[F(L,null,{default:B(()=>[F(U(w))]),_:1})],8,_e)]),_:2},1024)):X("",!0),1==e.status?(J(),M(I,{key:1,placement:"bottom"},{content:B(()=>[...s[2]||(s[2]=[N("span",null,"已复制",-1)])]),default:B(()=>[N("span",pe,[F(L,null,{default:B(()=>[F(U(C))]),_:1})])]),_:1})):X("",!0),F(I,{placement:"bottom"},{content:B(()=>[...s[3]||(s[3]=[N("span",null,"移除点歌",-1)])]),default:B(()=>[N("span",{class:"chat-close",onClick:a=>{return s=e,l.removeDanmakuList(s),void r(`{"type":"delete","data":${s.msg_id}}`);var s}},[F(L,null,{default:B(()=>[F(U(x))]),_:1})],8,ge)]),_:2},1024)]))),256))])),[[Z,m]])]),_:1}),F(Y,{ref_key:"singDialogRef",ref:n},null,512)]),_:1},512)]),_:1})}}});export{he as default};
