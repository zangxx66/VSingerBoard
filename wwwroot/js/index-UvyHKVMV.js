import{E as e,a,b as t,c as l,F as s,G as n,H as i,f as o,g as r,l as d,m as u,i as c,B as g,C as m,I as p,J as y,x as _,K as f,L as h,v as w,y as v,t as k,u as x,z as b}from"./vendor-element-plus-HZbGYrKl.js";import{n as V,r as C,a1 as S,bd as j,q as K,t as P,u as D,a as U,D as E,L as F,G as q,I as B,bc as z,ba as I,c as L,V as R,y as T,E as $,K as G}from"./vendor-libs-7289s0cb.js";import{a as H,b as N,d as O,i as J}from"./request-BsWu63JD.js";import{g as M}from"./times-Cw5rdMqO.js";import{e as A,i as Q}from"./excel-g-lxlBLo.js";import{b as W}from"./route-block-B_A1xBdJ.js";import"./vendor-vue-Cl2YAQzn.js";import"./vendor-exceljs-C-8i3j8b.js";const X=V({__name:"add-playlist-dialog",emits:["submit"],setup(d,{expose:u,emit:c}){const g=c,m=C(!1),p=C(!1),y=S({id:0,song_name:"",singer:"",is_sc:!1,sc_price:0,language:"",tag:"",create_time:0}),_=()=>{m.value=!1,y.id=0,y.song_name="",y.singer="",y.is_sc=!1,y.sc_price=0,y.language="",y.tag=""},f=j({mutationFn:async e=>await H({data:e}),onSuccess:a=>{if(p.value=!1,0!=a.code)e.warning(a.msg);else{const e={id:a.data,song_name:y.song_name,singer:y.singer,is_sc:y.is_sc,sc_price:y.sc_price,language:y.language,tag:y.tag,create_time:y.create_time};h(e)}}}),h=e=>{g("submit",e),_()};return u({openDialog:e=>{e&&Object.assign(y,e),m.value=!0}}),(d,u)=>{const c=l,g=t,h=n,w=s,v=i,k=o,x=r,b=a;return P(),K(b,{modelValue:D(m),"onUpdate:modelValue":u[8]||(u[8]=e=>U(m)?m.value=e:null),title:"新增歌曲",width:"450","destroy-on-close":"","before-close":_},{default:E(()=>[F(x,{model:D(y),"label-width":"auto"},{default:E(()=>[F(g,{label:"歌名",prop:"song_name"},{default:E(()=>[F(c,{modelValue:D(y).song_name,"onUpdate:modelValue":u[0]||(u[0]=e=>D(y).song_name=e),type:"text"},null,8,["modelValue"])]),_:1}),F(g,{label:"歌手",prop:"singer"},{default:E(()=>[F(c,{modelValue:D(y).singer,"onUpdate:modelValue":u[1]||(u[1]=e=>D(y).singer=e),type:"text"},null,8,["modelValue"])]),_:1}),F(g,{label:"语种",prop:"language"},{default:E(()=>[F(c,{modelValue:D(y).language,"onUpdate:modelValue":u[2]||(u[2]=e=>D(y).language=e),type:"text"},null,8,["modelValue"])]),_:1}),F(g,{label:"标签",prop:"tag"},{default:E(()=>[F(c,{modelValue:D(y).tag,"onUpdate:modelValue":u[3]||(u[3]=e=>D(y).tag=e),type:"text"},null,8,["modelValue"])]),_:1}),F(g,{label:"是否SC歌曲",prop:"is_sc"},{default:E(()=>[F(w,{modelValue:D(y).is_sc,"onUpdate:modelValue":u[4]||(u[4]=e=>D(y).is_sc=e)},{default:E(()=>[F(h,{value:!0},{default:E(()=>[...u[9]||(u[9]=[B("是",-1)])]),_:1}),F(h,{value:!1},{default:E(()=>[...u[10]||(u[10]=[B("否",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),D(y).is_sc?(P(),K(g,{key:0,label:"SC价格",prop:"sc_price"},{default:E(()=>[F(v,{modelValue:D(y).sc_price,"onUpdate:modelValue":u[5]||(u[5]=e=>D(y).sc_price=e),min:30,controls:!1},null,8,["modelValue"])]),_:1})):q("",!0),F(g,null,{default:E(()=>[F(k,{loading:D(p),type:"primary",onClick:u[6]||(u[6]=a=>{y.song_name?y.singer?!y.is_sc||y.sc_price?(p.value=!0,y.create_time=M(),f.mutate(y)):e.warning("请输入SC价格"):e.warning("请输入歌手"):e.warning("请输入歌名")})},{default:E(()=>[...u[11]||(u[11]=[B("保存",-1)])]),_:1},8,["loading"]),F(k,{onClick:u[7]||(u[7]=e=>_())},{default:E(()=>[...u[12]||(u[12]=[B("取消",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),Y={class:"h-[40px] flex"},Z={class:"flex"},ee={class:"w-full flex-row-reverse flex gap-[10px]"},ae=V({name:"playlist",__name:"index",setup(a){const s=C(!1),n=C(!1),i=C(0),V=I("playlistDataCard"),U=I("playlistInfiniteList"),q=I("addPlaylistDialogRef"),H=S({keyword:"",size:20}),{data:W,refetch:ae,fetchNextPage:te,isFetching:le}=(se=H,z({queryKey:[N.name,se],queryFn:async a=>{const t=await N({...a.queryKey[1],page:a.pageParam});return 0!=t.code?(e.warning(t.msg||"请求失败"),{total:0,rows:[]}):{total:t.data.total,rows:t.data.rows}},getNextPageParam:(e,a)=>{const t=D(D(se).size)??20;return e.total>=t?a.length+1:void 0},staleTime:1e4,initialPageParam:1}));var se;const ne=L(()=>W.value?.pages.flatMap(e=>(i.value=e.total,e.rows)).filter(Boolean)),ie=[{header:"歌曲名",key:"song_name",width:50},{header:"歌手",key:"singer",width:50},{header:"语种",key:"language",width:25},{header:"标签",key:"tag",width:50},{header:"是否SC曲目",key:"is_sc",width:25},{header:"SC曲目价格",key:"sc_price",width:25}],oe=[{header:"歌曲名",key:"song_name",type:"string"},{header:"歌手",key:"singer",type:"string"},{header:"语种",key:"language",type:"string"},{header:"标签",key:"tag",type:"string"},{header:"是否SC曲目",key:"is_sc",type:"boolean"},{header:"SC曲目价格",key:"sc_price",type:"number"}],re=[{key:"song_name",dataKey:"song_name",title:"歌名",width:200},{key:"singer",dataKey:"singer",title:"歌手",width:200},{key:"language",dataKey:"language",title:"语种",width:200},{key:"tag",dataKey:"tag",title:"标签",width:200},{key:"sc_price",dataKey:"sc_price",title:"SC曲目价格",width:200},{key:"operations",title:"操作",width:200,cellRenderer:({rowData:e})=>F(G,null,[F(o,{type:"success",icon:k,onClick:a=>ge(e)},{default:()=>[B("编辑")]}),F(o,{type:"default",icon:x,onClick:a=>me([e.id])},{default:()=>[B("删除")]})])}],de=j({mutationKey:[O.name],mutationFn:async e=>await O({data:e}),onSuccess:a=>{0!=a.code?e.warning(a.msg):ae()},onError:a=>{e.error(a.message)}}),ue=j({mutationFn:async e=>await J({data:e}),onSuccess:a=>{0!=a.code?e.warning(a.msg):ae(),n.value=!1},onError:a=>{e.error(a.message)}}),ce=j({mutationFn:async e=>await N(e),onSuccess:a=>{if(0!=a.code)e.warning(a.msg||"请求失败");else{const e=a.data.rows.map(e=>({song_name:e.song_name,singer:e.singer,is_sc:e.is_sc?"是":"否",sc_price:e.sc_price,language:e.language,tag:e.tag})),t=`歌单_${M()}`;A(ie,e,t)}s.value=!1},onError:a=>{e.error(a.message)}}),ge=e=>{q.value&&q.value.openDialog(e)},me=a=>{b.confirm("是否删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{de.mutate(a)}).catch(a=>{"string"==typeof a&&"cancel"==a||e.error(a)})},pe=e=>{ae()},ye=async(a,t)=>{if(n.value=!0,!a)return void(n.value=!1);const l=a.name.split(".");if("xlsx"!=l[l.length-1])return e.warning("请上传xlsx格式的表格"),void(n.value=!1);const s=await(a.raw?.arrayBuffer()),i=await Q(oe,s);i.forEach(e=>{e.id=0,e.create_time=M()}),ue.mutate(i)},_e=()=>{const e={};Object.assign(e,H),e.page=1,e.size=i.value,s.value=!0,ce.mutate(e)},fe=()=>{ae()},he=e=>{ne.value&&ne.value.length<i.value&&te()};return R(()=>{const e=.9*window.innerHeight-60;V.value?.$el.style.setProperty("overflow","hidden");const a=.6*e;U.value?.style.setProperty("height",`${a}px`)}),(e,a)=>{const i=l,k=t,x=c,b=r,V=u,C=m,S=h,j=f,z=p,I=X,L=d,R=v,G=w;return P(),K(R,{class:"playlist-container"},{default:E(()=>[F(L,{class:"playlist-main"},{default:E(()=>[F(V,{class:"playlist-card"},{header:E(()=>[...a[3]||(a[3]=[T("div",{class:"card-header"},[T("span",null,"查询")],-1)])]),default:E(()=>[F(b,{model:D(H),"label-width":"auto",inline:"",class:"inline-form"},{default:E(()=>[F(k,{label:"关键词",prop:"keyword"},{default:E(()=>[F(i,{modelValue:D(H).keyword,"onUpdate:modelValue":a[0]||(a[0]=e=>D(H).keyword=e),type:"text"},null,8,["modelValue"])]),_:1}),F(k,null,{default:E(()=>[F(D(o),{type:"primary",onClick:fe},{default:E(()=>[F(x,{class:"el-icon--left"},{default:E(()=>[F(D(g))]),_:1}),a[4]||(a[4]=B(" 搜索 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),F(C),T("div",Y,[F(D(o),{type:"primary",onClick:a[1]||(a[1]=e=>ge())},{default:E(()=>[...a[5]||(a[5]=[B("新增歌曲",-1)])]),_:1}),F(D(o),{type:"danger",disabled:0==D(ne)?.length,onClick:a[2]||(a[2]=e=>(()=>{const e=ne.value?.map(e=>e.id);e&&me(e)})())},{default:E(()=>[...a[6]||(a[6]=[B("全部删除",-1)])]),_:1},8,["disabled"])]),$((P(),K(V,{ref:"playlistDataCard",class:"playlist-data-card"},{default:E(()=>[T("div",{ref_key:"playlistInfiniteList",ref:U,class:"chat-infinite-list"},[F(j,null,{default:E(({width:e,height:a})=>[F(S,{columns:re,data:D(ne)||[],width:e,height:a,fixed:"",onEndReached:he},null,8,["data","width","height"])]),_:1})],512)]),footer:E(()=>[T("div",Z,[T("div",ee,[F(z,{action:"#","auto-upload":!1,"show-file-list":!1,"on-change":ye,accept:".xlsx"},{trigger:E(()=>[F(D(o),{type:"success",loading:D(n)},{default:E(()=>[a[7]||(a[7]=B(" 导入歌单 ",-1)),F(x,{class:"el-icon--right"},{default:E(()=>[F(D(y))]),_:1})]),_:1},8,["loading"])]),_:1}),F(D(o),{loading:D(s),onClick:_e},{default:E(()=>[a[8]||(a[8]=B(" 导出歌单 ",-1)),F(x,{class:"el-icon--right"},{default:E(()=>[F(D(_))]),_:1})]),_:1},8,["loading"])])])]),_:1})),[[G,D(le)]]),F(I,{ref_key:"addPlaylistDialogRef",ref:q,onSubmit:pe},null,512)]),_:1})]),_:1})}}});"function"==typeof W&&W(ae);export{ae as default};
