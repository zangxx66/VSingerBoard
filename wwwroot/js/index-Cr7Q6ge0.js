import{E as e,d as a,e as t,b as l,h as s,i as n,j as i,k as o,l as r,m as d,c as u,n as m,s as c,o as p,p as g,q as _,f as h,r as v,v as f}from"./vendor-element-plus-DfIrH9Kr.js";import{r as y,p as b,t as w,g as x,a as k}from"./index-CqzKlsTq.js";import{e as V}from"./excel-CH2sLU4d.js";import{n as j,r as z,bf as L,a1 as C,V as U,q as D,D as H,t as M,L as Y,E as $,u as I,x as P,K as q,ao as B,a as E,I as T,y as G,G as J,J as K}from"./vendor-libs-DGcKXZQv.js";import"./vendor-vue-lxJqvpcP.js";import"./vendor-exceljs-C-8i3j8b.js";const O={class:"chat-infinite-list",ref:"chatInfiniteList"},R={class:"chat-infinite-list-item"},S=["src","alt"],X={tag:"span",class:"chat-tag"},A={style:{width:"15%"}},F={style:{display:"flex"}},N={style:{width:"50%"}},Q={style:{width:"50%","text-align":"right"}},W=j({__name:"index",setup(j){const W=z(!1),Z=z(!1),ee=z(0),ae=z(),te=z(),le=L("historyDataCard"),se=L("chatInfiniteList"),ne=C({uname:"",song_name:"",source:"all",start_time:0,end_time:0,page:1,size:20}),ie=[{key:"全部",value:"all"},{key:"抖音",value:"douyin"},{key:"B站",value:"bilibili"}],oe=e=>{if(!e)return ne.start_time=0,void(ne.end_time=0);ne.start_time=e[0],ne.end_time=x(e[1])},re=()=>{const a=[{header:"日期",key:"date",width:50},{header:"昵称",key:"uname",width:50},{header:"歌名",key:"song",width:50},{header:"平台",key:"source",width:50}],t={};Object.assign(t,ne),t.page=1,t.size=ee.value,Z.value=!0,y.getHistoryList(t).then(t=>{const l=t.data;if(0!=l.code)return e.warning(l.msg),void(Z.value=!1);const s=l.data.rows.map(e=>({date:w(e.create_time),uname:e.uname,song:e.song_name,source:"bilibili"==e.source?"B站":"抖音"})),n=`点歌历史记录_${k()}`;V(a,s,n),Z.value=!1}).catch(a=>{e.error(a),Z.value=!1})},de=()=>{W.value=!0,y.getHistoryList(ne).then(a=>{const t=a.data;if(0!=t.code)return e.warning(t.msg),void(W.value=!1);ee.value=t.data.total;const l=t.data.rows,s=l.map(e=>({msg_id:e.id,uid:e.uid,uname:e.uname,msg:e.song_name,send_time:e.create_time,source:e.source,medal_name:"",medal_level:0,guard_level:0})),n=b(s);te.value=l.map((e,a)=>({...e,song_name:n[a].html||e.song_name,create_time_str:w(e.create_time)})),W.value=!1}).catch(a=>{e.error(a),W.value=!1})},ue=()=>{ne.page=1,de()};return U(()=>{const e=.9*window.innerHeight;le.value?.$el.style.setProperty("overflow","hidden");const a=.6*e;se.value?.style.setProperty("height",`${a}px`),de()}),(e,y)=>{const b=i,w=n,x=r,k=o,V=d,j=m,z=u,L=s,C=l,U=p,le=h,se=v,me=g,ce=t,pe=a,ge=f;return M(),D(pe,{class:"history-container"},{default:H(()=>[Y(ce,{class:"history-main"},{default:H(()=>[Y(C,{class:"history-card"},{header:H(()=>[...y[6]||(y[6]=[G("div",{class:"card-header"},[G("span",null,"查询")],-1)])]),default:H(()=>[Y(L,{model:I(ne),"label-width":"auto",inline:"",class:"inline-form"},{default:H(()=>[Y(w,{label:"歌名",prop:"song_name"},{default:H(()=>[Y(b,{modelValue:I(ne).song_name,"onUpdate:modelValue":y[0]||(y[0]=e=>I(ne).song_name=e),type:"text"},null,8,["modelValue"])]),_:1}),Y(w,{label:"昵称",prop:"uname"},{default:H(()=>[Y(b,{modelValue:I(ne).uname,"onUpdate:modelValue":y[1]||(y[1]=e=>I(ne).uname=e),type:"text"},null,8,["modelValue"])]),_:1}),Y(w,{label:"点歌平台",prop:"source"},{default:H(()=>[Y(k,{modelValue:I(ne).source,"onUpdate:modelValue":y[2]||(y[2]=e=>I(ne).source=e),placeholder:"请选择点歌平台"},{default:H(()=>[(M(),P(q,null,B(ie,e=>Y(x,{label:e.key,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),Y(w,{label:"时间范围",prop:"dateRange",style:{width:"350px"}},{default:H(()=>[Y(V,{modelValue:I(ae),"onUpdate:modelValue":y[3]||(y[3]=e=>E(ae)?ae.value=e:null),type:"daterange","value-format":"X",format:"YYYY-MM-DD",onChange:oe},null,8,["modelValue"])]),_:1}),Y(w,null,{default:H(()=>[Y(z,{type:"primary",onClick:ue},{default:H(()=>[Y(j,{class:"el-icon--left"},{default:H(()=>[Y(I(c))]),_:1}),y[7]||(y[7]=T(" 搜索 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),Y(U),$((M(),D(C,{class:"history-data-card",ref:"historyDataCard"},{default:H(()=>[G("div",O,[(M(!0),P(q,null,B(I(te),e=>(M(),P("div",R,[G("img",{src:`/images/${e.source}.png`,class:"source-img",alt:e.source,width:"24"},null,8,S),G("text",X,[T(K(e.uname)+"：",1),Y(le,{style:{display:"flex"},innerHTML:e.song_name},null,8,["innerHTML"])]),G("span",A,K(e.create_time_str),1)]))),256)),0==I(te)?.length?(M(),D(se,{key:0,description:"没有数据"})):J("",!0)],512)]),footer:H(()=>[G("div",F,[G("div",N,[Y(me,{background:"",layout:"prev, pager, next",total:I(ee),"page-size":I(ne).size,"onUpdate:pageSize":y[4]||(y[4]=e=>I(ne).size=e),"current-page":I(ne).page,"onUpdate:currentPage":y[5]||(y[5]=e=>I(ne).page=e),onChange:de},null,8,["total","page-size","current-page"])]),G("div",Q,[Y(z,{type:"success",disabled:0==I(te)?.length,onClick:re,loading:I(Z)},{default:H(()=>[y[8]||(y[8]=T(" 导出历史记录 ",-1)),Y(j,{class:"el-icon--right"},{default:H(()=>[Y(I(_))]),_:1})]),_:1},8,["disabled","loading"])])])]),_:1})),[[ge,I(W)]])]),_:1})]),_:1})}}});export{W as default};
