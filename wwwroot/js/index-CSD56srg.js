import{n as e,h as a,c as l,d as n,g as t,i,q as d,M as o,N as r,O as s,p as u,E as c,v as m,P as p,Q as f,R as _,C as g,H as v,K as y,L as h,b as w,S as b,u as k,y as x,F as V,G as C,z as S,m as U,T as F,U as B}from"./vendor-element-plus-CjYS7DoP.js";import{_ as T,a as q}from"./fans-medal-CsE8w-96.js";import{o as D,M as j,a2 as E,r as K,W as L,y as O,v as z,L as R,t as H,E as I,z as M,u as W,J as A,b as G,ap as N,K as Q,H as J,I as P,bd as $,aj as X,V as Y,F as Z,bi as ee,bb as ae}from"./vendor-libs-Kq5ll9xE.js";import{c as le,r as ne}from"./api-BnBC17YJ.js";import{u as te}from"./theme-DiWkF22v.js";import{u as ie,t as de}from"./dark-vtBTDSxL.js";import{u as oe}from"./danmaku-C9rbl5dd.js";import"./vendor-vue-QPsD10U7.js";import"./vendor-exceljs-C-8i3j8b.js";const re=D({name:"lineHeader",props:{title:{type:String,required:!0}},setup:e=>()=>j("div",{class:"line-header"},[j("div",{class:"line-header-title"},[e.title])])}),se={class:"obs-container"},ue={class:"obs-splitter",style:{"margin-top":"1rem"}},ce={class:"css-editor"},me={class:"css-editor-preview"},pe={class:"danmaku-container"},fe={class:"danmaku-list"},_e={class:"danmaku-list-item"},ge={class:"danmaku-sing"},ve={class:"danmaku-uname"},ye={class:"danmaku-fans"},he=D({__name:"obs-setting",setup(m){const p=E({url:`${window.location.origin}/danmaku`}),f=K("/* 弹幕列表CSS */\n.danmaku-container {\n    height: 600px;\n    width: 800px;\n    background: transparent;\n    overflow: hidden;\n}\n.danmaku-list {\n  padding: 0;\n  margin-left: 1%;\n  list-style: none;\n  overflow-y: auto;\n}\n.danmaku-list-item {\n    width: 450px;\n    display: flex;\n    align-items: center;\n    height: 50px;\n    text-align: left;\n    color: #000;\n    font-size: 16px;\n    font-weight: bold;\n    overflow: hidden;\n}\n.danmaku-source-img {\n    margin: 1px;\n    height: 24px;\n}\n.danmaku-sing {\n    width: 200px;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    overflow: hidden;\n}\n\n.danmaku-uname {\n  width: 180px;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  margin-left: 1rem;\n}\n\n.danmaku-fans {\n  width: 200px;\n  margin: 0 auto;\n}\n\n.fans-club-img {\n  margin-left: 10px;\n}\n\n.fans-club-member-img {\n  margin-left: 10px;\n}\n\n.fans-medal-container {\n  margin-left: 10px;\n}\n\n.fans-club-container {\n  width: fit-content;\n  display: flex;\n  align-items: center;\n  margin-right: 1%;\n}\n\n.fans-club-name-container {\n  display: flex;\n  align-items: center;\n  font-size: 12px;\n  border-radius: 15px;\n  width: fit-content;\n  margin-left: 10px;\n}\n\n.fans-club-name-bg {\n  display: block;\n  height: 20px;\n}\n\n.fans-club-name {\n  color: #fff;\n  font-weight: 500;\n  width: 100%;\n  margin-left: -12%;\n}\n/* 弹幕列表CSS END */"),_=K(Array()),g=()=>{le(p.url),c.success("拷贝成功")};return L(()=>{(()=>{for(let e=0;e<10;e++){const a=e%2==0?"bilibili":"douyin",l="bilibili"==a?0:e%3==0?1:2;_.value.push({msg_id:e,uid:e,msg:"点歌弹幕",uname:"username",medal_level:e,medal_name:"粉丝团",guard_level:l,source:a,send_time:Date.now()})}})()}),(c,m)=>{const v=i,y=t,h=n,w=l,b=a,k=o,x=re,V=s,C=u,S=T,U=q,F=r,B=e;return z(),O(R,null,[j(B,null,{header:I(()=>[...m[2]||(m[2]=[M("span",null,"OBS设置",-1)])]),default:I(()=>[M("div",se,[j(b,{model:W(p),"label-width":"auto"},{default:I(()=>[j(w,{label:"OBS地址",prop:"url"},{default:I(()=>[j(h,{modelValue:W(p).url,"onUpdate:modelValue":m[0]||(m[0]=e=>W(p).url=e),type:"text",disabled:""},{append:I(()=>[j(y,{type:"primary",onClick:g},{default:I(()=>[j(v,null,{default:I(()=>[j(W(d))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),j(w,null,{default:I(()=>[j(y,{type:"primary",onClick:g},{default:I(()=>[...m[3]||(m[3]=[A(" 复制地址 ",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),j(k,{title:"在OBS新建一个浏览器源，在地址栏输入上面复制的地址，即可实现与观众同步点歌板信息，如需使用自定义css样式，请到下方编辑，然后复制到OBS浏览器源中",closable:!1,type:"primary"}),M("div",ue,[j(F,null,{default:I(()=>[j(V,{resizable:!1},{default:I(()=>[M("div",ce,[j(x,{title:"样式编辑器"}),j(h,{modelValue:W(f),"onUpdate:modelValue":m[1]||(m[1]=e=>G(f)?f.value=e:null),rows:20,type:"textarea",placeholder:"css样式在这里编辑"},null,8,["modelValue"])])]),_:1}),j(V,{resizable:!1},{default:I(()=>[M("div",me,[j(x,{title:"样式预览"}),M("div",pe,[M("div",fe,[(z(!0),O(R,null,N(W(_),e=>(z(),O("div",_e,[M("div",ge,[null!=e.html&&e.html.length>0?(z(),H(C,{key:0,innerHTML:e.html,style:{display:"flex"}},null,8,["innerHTML"])):(z(),O(R,{key:1},[A(Q(e.msg),1)],64))]),M("div",ve,Q(e.uname),1),M("div",ye,[e.medal_level>0?(z(),O(R,{key:0},["bilibili"==e.source?(z(),H(S,{key:0,medal_name:e.medal_name,medal_level:e.medal_level,guard_level:e.guard_level},null,8,["medal_name","medal_level","guard_level"])):J("",!0),"douyin"==e.source?(z(),H(U,{key:1,medal_name:e.medal_name,medal_level:e.medal_level,guard_level:e.guard_level},null,8,["medal_name","medal_level","guard_level"])):J("",!0)],64)):J("",!0)])]))),256))])])])]),_:1})]),_:1})])])]),_:1}),(z(),H(P("style"),null,{default:I(()=>[A(Q(W(f)),1)]),_:1}))],64)}}}),we=D({__name:"app-setting-tab",setup(n){const i=K(),d=K(!1),o=te(),r=E({id:0,dark_mode:!1,check_update:!1,startup:!1,notification:!1,navSideTour:!1,collapse:!1}),{data:s,isFetching:u}=ie(),v=$({mutationFn:async e=>await ne.addOrUpdateGlobalConfig({data:e}),onSuccess:e=>{0!=e.code?c.warning(e.msg||"请求失败"):(r.id=e.data,c.success(e.msg||"保存成功"),de(r.dark_mode),o.setDarkTheme(r.dark_mode)),d.value=!1},onError:e=>{c.error(e.message)}});return X(()=>{const e=o.getDarkTheme();r.dark_mode=e}),Y(u,()=>{s&&s.value&&(r.id=s.value.id,r.check_update=s.value.check_update,r.collapse=s.value.collapse,r.dark_mode=s.value.dark_mode,r.navSideTour=s.value.navSideTour,r.notification=s.value.notification,r.startup=s.value.startup)}),(n,o)=>{const s=p,c=l,y=t,h=a,w=e,b=g,k=he,x=m;return z(),O(R,null,[Z((z(),H(w,null,{header:I(()=>[...o[5]||(o[5]=[M("div",{class:"card-header"},[M("span",null,"应用设置")],-1)])]),default:I(()=>[j(h,{model:W(r),ref_key:"refForm",ref:i,"label-width":"auto",inline:""},{default:I(()=>[j(c,{label:"黑暗模式",prop:"dark_mode"},{default:I(()=>[j(s,{modelValue:W(r).dark_mode,"onUpdate:modelValue":o[0]||(o[0]=e=>W(r).dark_mode=e),"inline-prompt":"",style:{"--el-switch-off-color":"#ff4949"},"active-icon":W(_),"inactive-icon":W(f)},null,8,["modelValue","active-icon","inactive-icon"])]),_:1}),j(c,{label:"桌面通知",prop:"notification"},{default:I(()=>[j(s,{modelValue:W(r).notification,"onUpdate:modelValue":o[1]||(o[1]=e=>W(r).notification=e),"inline-prompt":"",style:{"--el-switch-off-color":"#ff4949"},"active-icon":W(_),"inactive-icon":W(f)},null,8,["modelValue","active-icon","inactive-icon"])]),_:1}),j(c,{label:"自动检查更新",prop:"check_update"},{default:I(()=>[j(s,{modelValue:W(r).check_update,"onUpdate:modelValue":o[2]||(o[2]=e=>W(r).check_update=e),"inline-prompt":"",style:{"--el-switch-off-color":"#ff4949"},"active-icon":W(_),"inactive-icon":W(f)},null,8,["modelValue","active-icon","inactive-icon"])]),_:1}),j(c,{label:"开机启动",prop:"startup"},{default:I(()=>[j(s,{modelValue:W(r).startup,"onUpdate:modelValue":o[3]||(o[3]=e=>W(r).startup=e),"inline-prompt":"",style:{"--el-switch-off-color":"#ff4949"},"active-icon":W(_),"inactive-icon":W(f)},null,8,["modelValue","active-icon","inactive-icon"])]),_:1}),j(c,null,{default:I(()=>[Z((z(),H(y,{type:"primary",onClick:o[4]||(o[4]=e=>(d.value=!0,void v.mutate(r)))},{default:I(()=>[...o[6]||(o[6]=[A("保存",-1)])]),_:1})),[[x,W(d)]])]),_:1})]),_:1},8,["model"])]),_:1})),[[x,W(u)]]),j(b),j(k)],64)}}}),be=D({__name:"dy-tab",setup(i){const d=K(),o=K(!1),r=E({id:0,room_id:0,sing_prefix:"点歌",sing_cd:0,fans_level:1}),s=oe(),{data:u,refetch:p,isFetching:f}=ee({queryKey:[ne.getDyConfig.name],queryFn:async()=>{const e=await ne.getDyConfig({});return 0!=e.code?(c.warning(e.msg||"请求失败"),{id:0,room_id:0,sing_prefix:"点歌",sing_cd:0,fans_level:1}):e.data.data}}),_=$({mutationFn:async e=>await ne.addOrUpdateDyConfig({data:e}),onSuccess:e=>{0!=e.code?c.warning(e.msg||"请求失败"):(c.success("操作成功"),p(),s.clearDanmakuList("douyin"),o.value=!1)},onError:e=>{c.error(e.message)}}),g=()=>{"number"!=typeof r.room_id||r.room_id<1?c.warning("请输入正确的房间号"):0!=r.sing_prefix.length?"number"!=typeof r.sing_cd||r.sing_cd<0?c.warning("请输入正确的点歌cd"):"number"!=typeof r.fans_level||r.fans_level<0?c.warning("请输入正确的粉团等级"):(o.value=!0,_.mutate(r)):c.warning("请输入正确的点歌指令")};return Y(f,()=>{u&&u.value&&(r.id=u.value.id,r.room_id=u.value.room_id,r.sing_prefix=u.value.sing_prefix,r.sing_cd=u.value.sing_cd,r.fans_level=u.value.fans_level)}),(i,s)=>{const u=v,c=l,p=n,_=t,y=a,h=e,w=m;return z(),H(h,null,{header:I(()=>[...s[4]||(s[4]=[M("div",{class:"card-header"},[M("span",null,"抖音设置")],-1)])]),default:I(()=>[Z((z(),H(y,{mode:W(r),ref_key:"refForm",ref:d,"label-width":"auto"},{default:I(()=>[j(c,{label:"房间号",prop:"room_id"},{default:I(()=>[j(u,{modelValue:W(r).room_id,"onUpdate:modelValue":s[0]||(s[0]=e=>W(r).room_id=e),min:1,controls:!1},null,8,["modelValue"])]),_:1}),j(c,{label:"点歌指令",prop:"sing_prefix"},{default:I(()=>[j(p,{modelValue:W(r).sing_prefix,"onUpdate:modelValue":s[1]||(s[1]=e=>W(r).sing_prefix=e),type:"text",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),j(c,{label:"点歌cd",prop:"sing_cd"},{default:I(()=>[j(u,{modelValue:W(r).sing_cd,"onUpdate:modelValue":s[2]||(s[2]=e=>W(r).sing_cd=e),placeholder:"点歌cd，单位：秒",min:0,controls:!1},null,8,["modelValue"])]),_:1}),j(c,{label:"粉团等级",prop:"fans_level"},{default:I(()=>[j(u,{modelValue:W(r).fans_level,"onUpdate:modelValue":s[3]||(s[3]=e=>W(r).fans_level=e),min:0,controls:!1},null,8,["modelValue"])]),_:1}),j(c,null,{default:I(()=>[Z((z(),H(_,{type:"primary",onClick:g},{default:I(()=>[...s[5]||(s[5]=[A("保存",-1)])]),_:1})),[[w,W(o)]])]),_:1})]),_:1},8,["mode"])),[[w,W(f)]])]),_:1})}}}),ke={class:"b-credential-card-header"},xe={class:"mb-4 flex items-center"},Ve={style:{height:"300px","padding-top":"1rem"}},Ce={class:"qcode-image-container"},Se=["src"],Ue={key:0,class:"qcode-bage"},Fe=D({__name:"bili-credential",setup(a){const l=K(!1),n=K(!1),i=K(0),d=K(""),r=K(""),s=K(Array()),f=[{key:"uid",dataKey:"uid",title:"uid",width:200,cellRenderer:({cellData:e})=>j(u,null,{default:()=>[e,A(" ")]})},{key:"uname",dataKey:"uname",title:"昵称",width:300,cellRenderer:({cellData:e})=>j(u,null,{default:()=>[e,A(" ")]})},{key:"enable",dataKey:"enable",title:"是否启用",width:150,cellRenderer:({rowData:e})=>j(p,{modelValue:e.enable,"inline-prompt":!0,style:"--el-switch-off-color: #ff4949; --el-switch-on-color: #13ce66",activeText:"启用",inactiveText:"禁用",onChange:a=>{V.mutate({id:e.id,enable:a})}},{default:()=>[" "]})},{key:"operations",title:"操作",width:200,maxWidth:1020,minWidth:100,cellRenderer:({rowData:e})=>j(R,null,[j(t,{type:"success",icon:b,loading:n.value,onClick:a=>T(e.id)},{default:()=>[A("刷新凭证")]}),j(t,{type:"danger",icon:k,onClick:a=>B(e.id)},{default:()=>[A("删除")]})])}],{data:_,refetch:g,isFetching:v}=ee({queryKey:[ne.getBiliCredentialList.name],queryFn:async()=>{const e=await ne.getBiliCredentialList({});return 0!=e.code?(c.warning(e.msg||"请求失败"),[]):e.data.rows},staleTime:1e4}),V=$({mutationFn:async e=>await ne.updateBiliCredential({data:e}),onSuccess:e=>{0!=e.code?c.warning(e.msg||"设置失败"):g()},onError:e=>{c.error(e.message)}}),C=$({mutationFn:async()=>await ne.checkQrCode({}),onSuccess:e=>{if(0!=e.code)c.warning(e.msg||"请求失败");else if("success"==e.msg&&(clearInterval(i.value),i.value=0,r.value="",c.success("登录成功"),g(),l.value=!1),"qr_state"==e.msg)switch(e.data.data){case"confirm":r.value="已扫码";break;case"timeout":r.value="二维码已过期";break;case"done":clearInterval(i.value),i.value=0,r.value="",c.success("登录成功"),g(),l.value=!1;break;default:r.value=""}},onError:e=>{c.error(e.message)}}),S=$({mutationFn:async()=>await ne.getBiliCredentialCode({}),onSuccess:e=>{0!=e.code?c.warning(e.msg||"获取失败"):(d.value=e.data.data,i.value=setInterval(C.mutate,3e3),l.value=!0)},onError:e=>{c.error(e.message)}}),U=$({mutationFn:async e=>await ne.deleteBiliCredential({id:e}),onSuccess:e=>{0!=e.code?c.warning(e.msg||"请求失败"):g()},onError:e=>{c.error(e.message)}}),F=$({mutationFn:async e=>await ne.refreshBiliCredential({id:e}),onSuccess:e=>{0!=e.code?c.warning(e.msg||"请求失败"):c.success("刷新完成"),n.value=!1},onError:e=>{c.error(e.message)}}),B=e=>{x.confirm("是否删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>U.mutate(e)).catch(e=>{"string"==typeof e&&"cancel"==e||c.error(e)})},T=e=>{n.value=!0,F.mutate(e)},q=()=>{clearInterval(i.value),i.value=0};return Y(v,()=>{_.value&&(s.value=_.value)}),(a,n)=>{const i=o,u=h,c=y,p=e,_=w,g=m;return z(),O(R,null,[j(p,null,{header:I(()=>[M("div",ke,[n[2]||(n[2]=M("span",null,"账号设置",-1)),j(i,{title:"未登录账号无法获取到弹幕用户昵称等信息，如有需要可添加一个小号",type:"warning",closable:!1,style:{"margin-top":"1rem"}})])]),default:I(()=>[M("div",xe,[j(W(t),{type:"primary",onClick:n[0]||(n[0]=e=>W(S).mutate())},{default:I(()=>[...n[3]||(n[3]=[A("新增",-1)])]),_:1})]),Z((z(),O("div",Ve,[j(c,null,{default:I(({width:e,height:a})=>[j(u,{columns:f,data:W(s),width:e,height:a,fixed:""},null,8,["data","width","height"])]),_:1})])),[[g,W(v)]])]),_:1}),j(_,{modelValue:W(l),"onUpdate:modelValue":n[1]||(n[1]=e=>G(l)?l.value=e:null),title:"新增",width:"720",onClose:q,"destroy-on-close":""},{default:I(()=>[M("div",Ce,[M("img",{src:W(d),alt:"qrcode",class:"qcode",referrerpolicy:"no-referrer"},null,8,Se),W(r).length>0?(z(),O("div",Ue,Q(W(r)),1)):J("",!0)])]),_:1},8,["modelValue"])],64)}}}),Be=D({__name:"bili-tab",setup(i){const d=K(),o=E({id:0,room_id:0,modal_level:1,user_level:0,sing_prefix:"点歌",sing_cd:0}),r=oe(),s=[{key:"普通用户",value:0},{key:"舰长",value:3},{key:"提督",value:2},{key:"总督",value:1}],{data:u,refetch:p,isFetching:f}=ee({queryKey:[ne.getBiliConfig.name],queryFn:async()=>{const e=await ne.getBiliConfig({});return 0!=e.code?(c.warning(e.msg||"请求失败"),{id:0,room_id:0,modal_level:1,user_level:0,sing_prefix:"点歌",sing_cd:0}):e.data.data}}),_=$({mutationFn:async e=>await ne.addOrUpdateBiliConfig({data:e}),onSuccess:e=>{0!=e.code?c.warning(e.msg||"请求失败"):(c.success("操作成功"),p(),r.clearDanmakuList("bilibili"))},onError:e=>{c.error(e.message)}});return Y(f,()=>{u&&u.value&&(o.id=u.value.id,o.room_id=u.value.room_id,o.modal_level=u.value.modal_level,o.user_level=u.value.user_level,o.sing_prefix=u.value.sing_prefix,o.sing_cd=u.value.sing_cd)}),(i,r)=>{const u=v,p=l,y=C,h=V,w=n,b=a,k=e,x=g,S=Fe,U=m;return z(),O(R,null,[j(k,null,{header:I(()=>[...r[6]||(r[6]=[M("div",{class:"card-header"},[M("span",null,"基础设置")],-1)])]),default:I(()=>[Z((z(),H(b,{model:W(o),ref_key:"refForm",ref:d,"label-width":"auto"},{default:I(()=>[j(p,{label:"房间号",prop:"room_id"},{default:I(()=>[j(u,{modelValue:W(o).room_id,"onUpdate:modelValue":r[0]||(r[0]=e=>W(o).room_id=e),placeholder:"B站直播间号",min:1,controls:!1},null,8,["modelValue"])]),_:1}),j(p,{label:"粉丝牌等级",prop:"modal_level"},{default:I(()=>[j(u,{modelValue:W(o).modal_level,"onUpdate:modelValue":r[1]||(r[1]=e=>W(o).modal_level=e),placeholder:"粉丝牌等级",min:0,controls:!1},null,8,["modelValue"])]),_:1}),j(p,{label:"用户等级",prop:"user_level"},{default:I(()=>[j(h,{modelValue:W(o).user_level,"onUpdate:modelValue":r[2]||(r[2]=e=>W(o).user_level=e)},{default:I(()=>[(z(),O(R,null,N(s,e=>j(y,{value:e.value},{default:I(()=>[A(Q(e.key),1)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"])]),_:1}),j(p,{label:"点歌指令",prop:"sing_prefix"},{default:I(()=>[j(w,{modelValue:W(o).sing_prefix,"onUpdate:modelValue":r[3]||(r[3]=e=>W(o).sing_prefix=e),placeholder:"点歌指令",type:"text",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),j(p,{label:"点歌cd",prop:"sing_cd"},{default:I(()=>[j(u,{modelValue:W(o).sing_cd,"onUpdate:modelValue":r[4]||(r[4]=e=>W(o).sing_cd=e),placeholder:"点歌cd，单位：秒",min:0,controls:!1},null,8,["modelValue"])]),_:1}),j(p,null,{default:I(()=>[j(W(t),{type:"primary",onClick:r[5]||(r[5]=e=>{"number"!=typeof o.room_id||o.room_id<1?c.warning("请输入正确的房间号"):"number"!=typeof o.modal_level||o.modal_level<0?c.warning("请输入正确的粉丝牌等级"):0!=o.sing_prefix.length?"number"!=typeof o.sing_cd||o.sing_cd<0?c.warning("请输入正确的点歌cd"):_.mutate(o):c.warning("请输入正确的点歌指令")})},{default:I(()=>[...r[7]||(r[7]=[A("保存",-1)])]),_:1})]),_:1})]),_:1},8,["model"])),[[U,W(f)]])]),_:1}),j(x),j(S)],64)}}}),Te=D({name:"settings",__name:"index",setup(e){const a=K("1"),l=ae("appSettingRef"),n=(e,a)=>{};return(e,t)=>{const i=Be,d=B,o=be,r=we,s=F,u=U,c=S;return z(),H(c,{class:"settings-container"},{default:I(()=>[j(u,{class:"settings-main"},{default:I(()=>[j(s,{modelValue:W(a),"onUpdate:modelValue":t[0]||(t[0]=e=>G(a)?a.value=e:null),type:"border-card",class:"settings-tabs",onTabClick:n},{default:I(()=>[j(d,{label:"哔哩哔哩设置",name:"1"},{default:I(()=>[j(i)]),_:1}),j(d,{label:"抖音设置",name:"2",lazy:""},{default:I(()=>[j(o)]),_:1}),j(d,{label:"应用设置",name:"3"},{default:I(()=>[j(r,{ref_key:"appSettingRef",ref:l},null,512)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}}});export{Te as default};
