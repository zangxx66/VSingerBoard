import{u as e,y as a,A as t,B as l,C as s,D as n,r as i,j as r,F as o,G as d,v as u,H as m,I as c,J as p,k as g,d as h,E as _,K as v,w as y}from"./vendor-element-plus-C1FTue0a.js";import{g as f,r as b,t as w,b as x,p as k}from"./index-MkrUeJyj.js";import{e as V}from"./excel-CH2sLU4d.js";import{n as j,r as z,be as C,a1 as L,V as D,q as H,D as U,L as I,E as M,u as Y,x as $,ao as B,K as P,a as E,I as G,y as J,G as K,t as T,J as q}from"./vendor-libs-HLQpMz2o.js";import"./vendor-vue-J6GVTi4e.js";import"./vendor-exceljs-C-8i3j8b.js";const A={class:"chat-infinite-list",ref:"chatInfiniteList"},F={class:"chat-infinite-list-item"},O=["src","alt"],R={tag:"span",class:"chat-tag"},S={style:{width:"15%"}},X={style:{display:"flex"}},N={style:{width:"50%"}},Q={style:{width:"50%","text-align":"right"}},W=j({name:"history",setup(j){const W=z(!1),Z=z(!1),ee=z(0),ae=z(),te=z(),le=C("historyDataCard"),se=C("chatInfiniteList"),ne=L({uname:"",song_name:"",source:"all",start_time:0,end_time:0,page:1,size:20}),ie=[{key:"全部",value:"all"},{key:"抖音",value:"douyin"},{key:"B站",value:"bilibili"}],re=e=>{if(!e)return ne.start_time=0,void(ne.end_time=0);ne.start_time=e[0],ne.end_time=f(e[1])},oe=()=>{const e=[{header:"日期",key:"date",width:50},{header:"昵称",key:"uname",width:50},{header:"歌名",key:"song",width:50},{header:"平台",key:"source",width:50}],a={};Object.assign(a,ne),a.page=1,a.size=ee.value,Z.value=!0,b.getHistoryList(a).then(a=>{if(0!=a.code)return _.warning(a.msg),void(Z.value=!1);const t=a.data.rows.map(e=>({date:w(e.create_time),uname:e.uname,song:e.song_name,source:"bilibili"==e.source?"B站":"抖音"})),l=`点歌历史记录_${x()}`;V(e,t,l),Z.value=!1}).catch(e=>{_.error(e),Z.value=!1})},de=()=>{W.value=!0,b.getHistoryList(ne).then(e=>{if(0!=e.code)return _.warning(e.msg),void(W.value=!1);ee.value=e.data.total;const a=e.data.rows,t=a.map(e=>({msg_id:e.id,uid:e.uid,uname:e.uname,msg:e.song_name,send_time:e.create_time,source:e.source,medal_name:"",medal_level:0,guard_level:0})),l=k(t);te.value=a.map((e,a)=>({...e,song_name:l[a].html||e.song_name,create_time_str:w(e.create_time)})),W.value=!1}).catch(e=>{_.error(e),W.value=!1})},ue=()=>{ne.page=1,de()};return D(()=>{const e=.9*window.innerHeight;le.value?.$el.style.setProperty("overflow","hidden");const a=.6*e;se.value?.style.setProperty("height",`${a}px`),de()}),(_,f)=>{const b=l,w=t,x=v,k=s,V=n,j=r,z=i,C=a,L=e,D=d,le=y,se=p,me=m,ce=g,pe=h,ge=u;return T(),H(pe,{class:"history-container"},{default:U(()=>[I(ce,{class:"history-main"},{default:U(()=>[I(L,{class:"history-card"},{header:U(()=>[...f[6]||(f[6]=[J("div",{class:"card-header"},[J("span",null,"查询")],-1)])]),default:U(()=>[I(C,{model:Y(ne),"label-width":"auto",inline:"",class:"inline-form"},{default:U(()=>[I(w,{label:"歌名",prop:"song_name"},{default:U(()=>[I(b,{modelValue:Y(ne).song_name,"onUpdate:modelValue":f[0]||(f[0]=e=>Y(ne).song_name=e),type:"text"},null,8,["modelValue"])]),_:1}),I(w,{label:"昵称",prop:"uname"},{default:U(()=>[I(b,{modelValue:Y(ne).uname,"onUpdate:modelValue":f[1]||(f[1]=e=>Y(ne).uname=e),type:"text"},null,8,["modelValue"])]),_:1}),I(w,{label:"点歌平台",prop:"source"},{default:U(()=>[I(k,{modelValue:Y(ne).source,"onUpdate:modelValue":f[2]||(f[2]=e=>Y(ne).source=e),placeholder:"请选择点歌平台"},{default:U(()=>[(T(),$(P,null,B(ie,e=>I(x,{label:e.key,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),I(w,{label:"时间范围",prop:"dateRange",style:{width:"350px"}},{default:U(()=>[I(V,{modelValue:Y(ae),"onUpdate:modelValue":f[3]||(f[3]=e=>E(ae)?ae.value=e:null),type:"daterange","value-format":"X",format:"YYYY-MM-DD",onChange:re},null,8,["modelValue"])]),_:1}),I(w,null,{default:U(()=>[I(z,{type:"primary",onClick:ue},{default:U(()=>[I(j,{class:"el-icon--left"},{default:U(()=>[I(Y(o))]),_:1}),f[7]||(f[7]=G(" 搜索 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),I(D),M((T(),H(L,{class:"history-data-card",ref:"historyDataCard"},{default:U(()=>[J("div",A,[(T(!0),$(P,null,B(Y(te),e=>(T(),$("div",F,[J("img",{src:`/images/${e.source}.png`,class:"source-img",alt:e.source,width:"24"},null,8,O),J("text",R,[G(q(e.uname)+"：",1),I(le,{style:{display:"flex"},innerHTML:e.song_name},null,8,["innerHTML"])]),J("span",S,q(e.create_time_str),1)]))),256)),0==Y(te)?.length?(T(),H(se,{key:0,description:"没有数据"})):K("",!0)],512)]),footer:U(()=>[J("div",X,[J("div",N,[I(me,{background:"",layout:"prev, pager, next",total:Y(ee),"page-size":Y(ne).size,"onUpdate:pageSize":f[4]||(f[4]=e=>Y(ne).size=e),"current-page":Y(ne).page,"onUpdate:currentPage":f[5]||(f[5]=e=>Y(ne).page=e),onChange:de},null,8,["total","page-size","current-page"])]),J("div",Q,[I(z,{type:"success",disabled:0==Y(te)?.length,onClick:oe,loading:Y(Z)},{default:U(()=>[f[8]||(f[8]=G(" 导出历史记录 ",-1)),I(j,{class:"el-icon--right"},{default:U(()=>[I(Y(c))]),_:1})]),_:1},8,["disabled","loading"])])])]),_:1})),[[ge,Y(W)]])]),_:1})]),_:1})}}});export{W as default};
