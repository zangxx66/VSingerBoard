import{U as e,V as a,i as t,W as l,S as n,X as o,Y as s,Z as r,l as i,y as u,_ as c,$ as d,a0 as m,a1 as p,a2 as f,a3 as h,E as v,a4 as g,a5 as _,a6 as y,T as b}from"./vendor-element-plus-BNN58Tgt.js";import{n as k,r as x,c as w,L as S,a1 as T,bd as N,ba as C,U as j,V as R,q as V,D as $,u as E,x as D,ao as I,K as L,G as U,$ as q,a as F,am as H,bh as M,H as z,Y as A,t as O,I as W,J as Y,b8 as B}from"./vendor-libs-DLrArELd.js";import{u as G}from"./theme-DRqxjumM.js";import{y as J,z as K}from"./vendor-vue-D3OeNkI5.js";import{u as X,t as Z}from"./dark-CAXmGYzs.js";import{e as P}from"./request-BRje5s3q.js";import{c as Q,d as ee}from"./tool-7CWFlNCe.js";import"./vendor-exceljs-C-8i3j8b.js";const ae=((e,a)=>{const t=e.__vccOpts||e;for(const[l,n]of a)t[l]=n;return t})(k({name:"defaultLayout",__name:"default",setup(k){const ae=G(),te=J(),le=K(),ne={shadow:"always"},oe={alignCenter:!0,draggable:!0,overflow:!1,transition:"el-fade-in"},se={offset:70,plain:!0},re=x("/"),ie=x("0"),ue=x([]),ce=w(()=>ue.value.map(e=>e.componentName).filter(Boolean)),de=[{title:"点歌板",icon:S(c,null,null),routerName:"/",ref:"homeRef"},{title:"点歌记录",icon:S(d,null,null),routerName:"/history",ref:"historyRef"},{title:"歌单管理",icon:S(m,null,null),routerName:"/playlist",ref:"playlistRef"},{title:"更新日志",icon:S(p,null,null),routerName:"/changelog"},{title:"设置",icon:S(f,null,null),routerName:"/settings",ref:"settingsRef"},{title:"关于",icon:S(h,null,null),routerName:"/about"}],me=T({id:0,dark_mode:!1,check_update:!1,startup:!1,notification:!1,navSideTour:!1,collapse:!1}),{data:pe,isFetching:fe}=X(),he=N({mutationFn:async e=>await P({data:e}),onSuccess:e=>{0!=e.code?v.warning(e.msg||"请求异常"):me.id=e.data},onError:e=>{v.error(e.message)}}),ve=x(!1),ge=x(),_e=x(),ye=x(),be=x(),ke=C("mainRef"),xe=()=>{me.navSideTour=!0,he.mutate(me),ve.value=!1},we=async()=>{await A(),me.navSideTour||(me.navSideTour=!0,he.mutate(me),ve.value=!1)},Se=e=>{const a=de.findIndex(a=>a.routerName==e);ie.value=a.toString()},Te=e=>{const a=e.toString(),t=de.find(e=>e.routerName==a)?.title||te.path;let l=ue.value.find(e=>e.name===a);l||(l={name:a,title:t,path:a,closable:"/"!==a,componentName:"/"==a?"home":a.replaceAll("/","")},ue.value.push(l)),re.value=a,le.push({path:a}),Se(a)},Ne=e=>{const a=ue.value,t=e.toString();let l=re.value;l===t&&a.forEach((e,n)=>{if(e.name===t){const e=a[n+1]||a[n-1];l=e?e.name:"/"}}),ue.value=a.filter(e=>e.name!==t),re.value=l,le.push({path:l}),Se(l)},Ce=async e=>{e.preventDefault();const a=window.getSelection()?.toString(),t=document.activeElement,l=t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement;let n=!1;const o=await window.pywebview.api.check_clipboard();o&&o.length>0&&(n=!0);const s=[{label:"拷贝",disabled:!a,onClick:()=>{a&&(Q(a),v.success("拷贝成功"))}},{label:"粘贴",disabled:!l||!n,onClick:()=>{ee(t)}}];B.showContextMenu({x:e.x,y:e.y,theme:$e.value?"mac dark":"mac",zIndex:9999,minWidth:230,items:s})},je=()=>{me.dark_mode=!me.dark_mode,he.mutate(me),Z(me.dark_mode),ae.setDarkTheme(me.dark_mode)},Re=w(()=>({left:me.collapse?"64px":"200px"})),Ve=w(()=>({width:me.collapse?"64px":"200px"})),$e=w(()=>ae.getDarkTheme());return j(fe,()=>{pe.value&&(()=>{const e=pe.value;e?(Object.assign(me,e),Z(e.dark_mode),ae.setDarkTheme(e.dark_mode),e.navSideTour||(ve.value=!0)):ve.value=!0})()},{once:!0}),R(()=>{const e=de.find(e=>e.routerName==te.path)?.title||te.name;ue.value.push({name:te.path,title:e,path:te.path,closable:"/"!==te.path,componentName:te.name}),re.value=te.path}),(c,d)=>{const m=t,p=a,f=e,h=r,v=b,k=n,x=H("router-view"),w=s,T=o,N=l,C=i,j=u;return O(),V(j,{class:"layout-container-demo"},{default:$(()=>[S(h,{style:q(E(Ve))},{default:$(()=>[S(f,{"default-active":E(ie),collapse:E(me).collapse,class:"layout-aside-menu"},{default:$(()=>[(O(),D(L,null,I(de,(e,a)=>S(p,{key:a,ref_for:!0,ref:e.ref||void 0,index:a.toString(),onClick:a=>(e=>{if(te.path==e)return me.collapse=!me.collapse,void he.mutate(me);Te(e)})(e.routerName)},{title:$(()=>[W(Y(e.title),1)]),default:$(()=>[S(m,null,{default:$(()=>[(O(),V(z(e.icon)))]),_:2},1024)]),_:2},1032,["index","onClick"])),64)),S(p,{ref_key:"themeRef",ref:be,index:(de.length+1).toString(),onClick:je},{default:$(()=>[E($e)?U("",!0):(O(),V(m,{key:0},{default:$(()=>[S(E(g))]),_:1})),E($e)?(O(),V(m,{key:1},{default:$(()=>[S(E(_))]),_:1})):U("",!0)]),_:1},8,["index"])]),_:1},8,["default-active","collapse"])]),_:1},8,["style"]),S(C,{ref_key:"mainRef",ref:ke,style:q(E(Re)),onContextmenu:Ce},{default:$(()=>[S(N,{locale:E(y),card:ne,dialog:oe,message:se},{default:$(()=>[S(k,{modelValue:E(re),"onUpdate:modelValue":d[0]||(d[0]=e=>F(re)?re.value=e:null),type:"card",closable:"",onTabRemove:Ne,onTabChange:Te},{default:$(()=>[(O(!0),D(L,null,I(E(ue),e=>(O(),V(v,{key:e.name,label:e.title,name:e.name,closable:e.closable},null,8,["label","name","closable"]))),128))]),_:1},8,["modelValue"]),S(x,null,{default:$(({Component:e})=>[(O(),V(M,{include:E(ce)},[(O(),V(z(e)))],1032,["include"]))]),_:1}),S(T,{modelValue:E(ve),"onUpdate:modelValue":d[1]||(d[1]=e=>F(ve)?ve.value=e:null),"target-area-clickable":!1,"close-on-press-escape":!1,onClose:we,onFinish:xe},{default:$(()=>[S(w,{title:"提示",description:"欢迎使用点歌姬"}),S(w,{title:"提示",description:"这里是点歌，可以查看抖和破站的点歌列表",placement:"right",target:E(ge)?.$el},null,8,["target"]),S(w,{title:"提示",description:"这里是历史记录，可以查看历史点歌",placement:"right",target:E(_e)?.$el},null,8,["target"]),S(w,{title:"提示",description:"这里是设置，可以设置抖和破站的直播间监听",placement:"right",target:E(ye)?.$el},null,8,["target"]),S(w,{title:"提示",description:"这是主题开关，可以切换主题",placement:"right",target:E(be)?.$el},null,8,["target"]),S(w,{title:"提示",description:"这里是主界面",placement:"left",target:E(ke)?.$el},null,8,["target"])]),_:1},8,["modelValue"])]),_:1},8,["locale"])]),_:1},8,["style"])]),_:1})}}}),[["__scopeId","data-v-100ba110"]]);export{ae as default};
